import{j as e,r as c}from"./@radix-CFOkMR_E.js";import{P as V,a0 as L,a1 as R,ac as q,a2 as y,a3 as N,a4 as v,aj as D,ak as Q,al as W,E as G,k as K,l as Y,j as J,n as X,F as ee,Y as T,aw as C,ax as E,M as se,N as te,O as ae,S as m,A as P,b as M,B as re,h as g,r as A,z as p,D as ne,o as ce,ay as ie}from"./index-BczVOqUf.js";import{a as le}from"./plus-C8WOyCzt.js";import{C as b,R as oe}from"./CopyButton-Cr7xYEPb.js";import{a as de,S as xe,P as me}from"./Pagination-C6X-mifw.js";import{s as f,C as ue,p as z,c as he}from"./persist-D7HJNBWx.js";import{q as pe,a as h}from"./@tanstack-DYiOyJUL.js";import{L as H,c as fe}from"./@react-router-CO-OsFwI.js";import{D as je}from"./DisplayDate-DYgIjlDF.js";import{I as Ce}from"./InlineAvatar-xsrsIGE-.js";import{I as k}from"./Infobox-DSt0O-dm.js";import{C as u}from"./CodeSnippet-Dvkx_82E.js";import{C as ge}from"./CollapsibleCard-opiuBHHc.js";import{F as we}from"./chevron-right-double-CZBOf6JM.js";import{o as ye,s as Ne}from"./url-D7mAQGUM.js";import"./@reactflow-l_1hUr1S.js";import"./copy-BXNk6BjL.js";import"./index-rK_Wuy2W.js";import"./stack-detail-query-Cficsl6d.js";import"./database-1xWSgZfO.js";function ve(){return e.jsx(V,{children:e.jsx("h1",{className:"text-display-xs font-semibold",children:"Stacks"})})}const be=s=>c.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.2929 2.29295C17.788 0.797857 20.212 0.797859 21.7071 2.29295C23.2022 3.78805 23.2022 6.21207 21.7071 7.70717L18.7097 10.7045C18.7088 10.7054 18.708 10.7063 18.7071 10.7072C18.7062 10.708 18.7053 10.7089 18.7044 10.7098L8.50078 20.9134C8.48402 20.9302 8.46741 20.9468 8.45093 20.9633C8.20603 21.2086 7.99001 21.425 7.73334 21.5943C7.50768 21.7431 7.26295 21.8607 7.00578 21.9439C6.71327 22.0386 6.40936 22.0722 6.06483 22.1102C6.04165 22.1127 6.01829 22.1153 5.99474 22.1179L2.61038 22.4939C2.30845 22.5275 2.00765 22.422 1.79284 22.2072C1.57803 21.9924 1.47251 21.6916 1.50606 21.3896L1.8821 18.0053C1.88472 17.9817 1.8873 17.9583 1.88985 17.9352C1.92786 17.5906 1.96138 17.2867 2.05607 16.9942C2.13932 16.7371 2.25695 16.4923 2.40576 16.2667C2.57501 16.01 2.79138 15.794 3.03667 15.5491C3.05317 15.5326 3.06981 15.516 3.08657 15.4992L16.2929 2.29295ZM14 7.41427L4.50078 16.9134C4.17827 17.2359 4.1184 17.3025 4.07541 17.3677C4.02581 17.4429 3.9866 17.5245 3.95885 17.6102C3.9348 17.6845 3.92024 17.7728 3.86987 18.2261L3.63187 20.3681L5.77388 20.1301C6.22718 20.0798 6.3155 20.0652 6.3898 20.0412C6.47553 20.0134 6.5571 19.9742 6.63232 19.9246C6.69752 19.8816 6.76406 19.8217 7.08657 19.4992L16.5858 10.0001L14 7.41427ZM18 8.58584L15.4142 6.00006L17.7071 3.70716C18.4211 2.99312 19.5788 2.99312 20.2929 3.70717C21.0069 4.42121 21.0069 5.57891 20.2929 6.29295L18 8.58584Z"})),ke=s=>c.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.1615 1H12.8385C13.3657 0.999983 13.8205 0.999967 14.195 1.03057C14.5904 1.06287 14.9836 1.13419 15.362 1.32698C15.9265 1.6146 16.3854 2.07354 16.673 2.63803C16.8658 3.01641 16.9371 3.40963 16.9694 3.80497C16.9969 4.14075 16.9997 4.54097 17 5H21C21.5523 5 22 5.44772 22 6C22 6.55229 21.5523 7 21 7H20V17.2413C20 18.0463 20 18.7106 19.9558 19.2518C19.9099 19.8139 19.8113 20.3306 19.564 20.816C19.1805 21.5686 18.5686 22.1805 17.816 22.564C17.3306 22.8113 16.8139 22.9099 16.2518 22.9558C15.7106 23 15.0463 23 14.2413 23H9.75868C8.95372 23 8.28936 23 7.74817 22.9558C7.18608 22.9099 6.66937 22.8113 6.18404 22.564C5.43139 22.1805 4.81947 21.5686 4.43597 20.816C4.18868 20.3306 4.09012 19.8139 4.04419 19.2518C3.99998 18.7106 3.99999 18.0463 4 17.2413L4 7H3C2.44772 7 2 6.55229 2 6C2 5.44772 2.44772 5 3 5H7.00003C7.00031 4.54097 7.00314 4.14075 7.03057 3.80497C7.06287 3.40963 7.13419 3.01641 7.32698 2.63803C7.6146 2.07354 8.07354 1.6146 8.63803 1.32698C9.01641 1.13419 9.40963 1.06287 9.80497 1.03057C10.1795 0.999967 10.6343 0.999983 11.1615 1ZM6 7V17.2C6 18.0566 6.00078 18.6389 6.03755 19.089C6.07337 19.5274 6.1383 19.7516 6.21799 19.908C6.40973 20.2843 6.71569 20.5903 7.09202 20.782C7.24842 20.8617 7.47262 20.9266 7.91104 20.9625C8.36113 20.9992 8.94342 21 9.8 21H14.2C15.0566 21 15.6389 20.9992 16.089 20.9625C16.5274 20.9266 16.7516 20.8617 16.908 20.782C17.2843 20.5903 17.5903 20.2843 17.782 19.908C17.8617 19.7516 17.9266 19.5274 17.9624 19.089C17.9992 18.6389 18 18.0566 18 17.2V7H6ZM14.9999 5H9.00007C9.00051 4.5349 9.00357 4.21698 9.02393 3.96784C9.04612 3.69617 9.0838 3.59546 9.10899 3.54601C9.20487 3.35785 9.35785 3.20487 9.54601 3.109C9.59545 3.0838 9.69617 3.04612 9.96784 3.02393C10.2512 3.00078 10.6234 3 11.2 3H12.8C13.3766 3 13.7488 3.00078 14.0322 3.02393C14.3038 3.04612 14.4045 3.0838 14.454 3.109C14.6422 3.20487 14.7951 3.35785 14.891 3.54601C14.9162 3.59546 14.9539 3.69617 14.9761 3.96784C14.9964 4.21698 14.9995 4.5349 14.9999 5ZM10 10.5C10.5523 10.5 11 10.9477 11 11.5V16.5C11 17.0523 10.5523 17.5 10 17.5C9.44772 17.5 9 17.0523 9 16.5V11.5C9 10.9477 9.44772 10.5 10 10.5ZM14 10.5C14.5523 10.5 15 10.9477 15 11.5V16.5C15 17.0523 14.5523 17.5 14 17.5C13.4477 17.5 13 17.0523 13 16.5V11.5C13 10.9477 13.4477 10.5 14 10.5Z"})),w=c.forwardRef((s,t)=>{const{triggerChildren:a,children:r,onSelect:n,onOpenChange:i,icon:l,open:x,...o}=s;return e.jsxs(L,{open:x,onOpenChange:i,children:[e.jsx(R,{asChild:!0,children:e.jsx(q,{...o,className:"hover:cursor-pointer",icon:s.icon,ref:t,onSelect:d=>{d.preventDefault(),n&&n()},children:a})}),r]})});w.displayName="DialogItem";const F=c.forwardRef(({closeModal:s,name:t,...a},r)=>e.jsxs(y,{...a,ref:r,children:[e.jsx(N,{children:e.jsx(v,{children:"Update Stack"})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(B,{action:"update"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Update a stack"}),e.jsx(u,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack update ${t} -o NEW_ORCHESTRATOR_NAME`})]})]})]}));F.displayName="UpdateStackDialog";const O=c.forwardRef(({closeModal:s,name:t,...a},r)=>e.jsxs(y,{...a,ref:r,children:[e.jsx(N,{children:e.jsx(v,{children:"Delete Stack"})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(B,{action:"delete"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Delete a stack"}),e.jsx(u,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack delete ${t}`})]})]})]}));O.displayName="DeleteStackDialog";function B({action:s}){function t(){switch(s){case"delete":return"delete";case"update":return"update";case"describe":return"get details of"}}return e.jsx(k,{children:e.jsx("div",{className:"flex w-full flex-wrap justify-between gap-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-text-sm font-semibold",children:"We are working on the new Stacks experience."}),e.jsxs("p",{className:"truncate text-text-sm",children:["Meanwhile you can use the CLI to ",t()," your stack."]})]})})})}function Se({name:s}){const[t,a]=c.useState(!1),[r,n]=c.useState(!1),i=c.useRef(null),l=c.useRef(null);function x(){l.current=i.current}function o(d){a(d),d===!1&&n(!1)}return e.jsx(D,{open:r,onOpenChange:n,children:e.jsxs(D,{children:[e.jsx(Q,{className:"z-10",ref:i,children:e.jsx(de,{className:"h-5 w-5 fill-theme-text-secondary"})}),e.jsxs(W,{hidden:t,onCloseAutoFocus:d=>{l.current&&(l.current.focus(),l.current=null,d.preventDefault())},className:"z-10",align:"end",sideOffset:1,children:[e.jsx(w,{onSelect:x,onOpenChange:o,icon:e.jsx(be,{className:"h-3 w-3 !fill-neutral-400"}),triggerChildren:"Update",children:e.jsx(F,{name:s,className:"lg:min-w-[600px]",closeModal:()=>o(!1)})}),e.jsx(w,{onSelect:x,onOpenChange:o,icon:e.jsx(ke,{className:"h-3  w-3 !fill-neutral-400"}),triggerChildren:"Delete",children:e.jsx(O,{name:s,className:"lg:min-w-[600px]",closeModal:()=>o(!1)})})]})]})})}function De(){return e.jsx("div",{className:"flex h-9 items-center border-b border-theme-border-moderate bg-theme-surface-primary px-4 py-3",children:e.jsxs(G,{className:"focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(we,{className:"h-5 w-5 fill-neutral-500"}),e.jsx("span",{className:"sr-only",children:"Close"})]})})}async function Ee(s){const t=K(Y.flavors.all)+(s?`?${ye(s)}`:""),a=await J(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(a.status===404&&X(),!a.ok){const r=await a.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>"Error while fetching flavors");throw new ee({status:a.status,statusText:a.statusText,message:r})}return a.json()}const $={all:["flavors"],flavorList:s=>pe({queryKey:[...$.all,s],queryFn:async()=>Ee(s)})};function Ie(s){if(!s)return[];const t=[];for(const a in s)Array.isArray(s[a])&&t.push(...s[a]);return t}const _=c.forwardRef(({name:s,children:t,type:a,...r},n)=>e.jsxs(L,{children:[e.jsx(R,{asChild:!0,children:t}),e.jsxs(y,{className:"w-fit max-w-fit",...r,ref:n,children:[e.jsx(N,{children:e.jsx(v,{children:T(a||"")})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(Le,{type:a}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Describe your ",C(a)]}),e.jsx(u,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml ${E(a)} describe ${s}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Update your ",C(a)]}),e.jsx(u,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml ${E(a)} update ${s}`})]})]})]})]}));_.displayName="ComponentFallbackDialog";function Le({type:s}){return e.jsx(k,{children:e.jsx("div",{className:"flex w-full flex-wrap justify-between gap-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-text-sm font-semibold",children:"We are working on the new Stacks experience."}),e.jsxs("p",{className:"truncate text-text-sm",children:["Meanwhile you can use the CLI to manage your ",C(s),"."]})]})})})}const U=c.createContext(null);function Re({children:s}){const[t,a]=c.useState([]);return e.jsx(U.Provider,{value:{integrations:t,setIntegrations:a},children:s})}function Z(){const s=c.useContext(U);if(s===null)throw new Error("useIntegrationsContext must be used within an AuthProvider");return s}function Te({children:s,stackId:t,stackName:a}){return e.jsxs(se,{children:[e.jsx(te,{children:s}),e.jsx(ae,{className:"w-[1000px] overflow-y-auto",children:e.jsxs(Re,{children:[e.jsx(De,{}),e.jsx(Pe,{stackId:t}),e.jsx(He,{name:a}),e.jsx(Me,{stackId:t})]})})]})}function Pe({stackId:s}){const t=h({...f.stackDetail(s)});return t.isError?null:t.isPending?e.jsx("div",{className:"p-5",children:e.jsx(m,{className:"h-6 w-full"})}):e.jsxs("div",{className:"flex items-center space-x-2 border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:[e.jsx(P,{type:"square",size:"lg",children:e.jsx(M,{size:"lg",children:t.data.name[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"mb-0.5 text-text-sm text-theme-text-secondary",children:t.data.id}),e.jsx(b,{copyText:t.data.id})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-display-xs font-semibold",children:t.data.name})})]})]})}function Me({stackId:s}){var r;const t=h({...f.stackDetail(s)});if(t.isError)return null;if(t.isPending)return e.jsx("div",{className:"p-5",children:e.jsx(m,{className:"h-[300px] w-full"})});const a=Ie((r=t.data.metadata)==null?void 0:r.components);return e.jsx("ul",{className:"space-y-5 p-5",children:a.map(n=>e.jsx("li",{children:e.jsx(Ae,{component:n})},n.id))})}function Ae({component:s}){var t,a,r,n,i;return e.jsxs(re,{className:"flex items-center justify-between p-5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ze,{flavor:((t=s.body)==null?void 0:t.flavor)||"",type:((a=s.body)==null?void 0:a.type)||"orchestrator"}),e.jsxs("div",{children:[e.jsx(_,{type:((r=s.body)==null?void 0:r.type)||"orchestrator",name:s.name,children:e.jsx("button",{className:"text-text-xl",children:s.name})}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:s.id.split("-")[0]}),e.jsx(b,{copyText:s.id})]})]})]}),e.jsx(ue,{type:((n=s.body)==null?void 0:n.type)||"orchestrator",children:T(((i=s.body)==null?void 0:i.type)||"")})]})}function ze({flavor:s,type:t}){var n;const{setIntegrations:a}=Z(),r=h({...$.flavorList({name:s,type:t})});return c.useEffect(()=>{var i,l,x;(l=(i=r.data)==null?void 0:i.items)!=null&&l.length&&((x=r.data.items[0].body)!=null&&x.integration)&&r.data.items[0].body.integration!=="built-in"&&a(o=>{var S;const d=((S=r.data.items[0].body)==null?void 0:S.integration)||"";return Array.from(new Set([...o,d])).filter(Boolean)})},[a,r.data]),r.isError?null:r.isPending?e.jsx(m,{className:"h-6 w-6"}):e.jsx("img",{width:32,height:32,alt:`${s} logo`,src:Ne(((n=r.data.items[0].body)==null?void 0:n.logo_url)??"")})}function He({name:s}){const{integrations:t}=Z();return e.jsx("section",{className:"px-5 pt-5",children:e.jsx(ge,{title:e.jsx("span",{className:"text-text-lg",children:"Set this stack"}),children:e.jsxs("ul",{className:"space-y-5",children:[e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{children:"1"}),e.jsx("p",{className:"font-semibold",children:"Set your stack"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Set the stack as active on your client"}),e.jsx(u,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack set ${s}`})]})]}),t.length>=1&&e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{children:"2"}),e.jsx("p",{className:"font-semibold",children:"Install the integrations"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Install the required integrations to run pipelines in your stack"}),e.jsx(u,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml integration install ${t.join(" ")}`})]})]})]})})})}function I({children:s}){return e.jsx("div",{className:"flex h-7 w-7 items-center justify-center rounded-sm bg-primary-100 text-text-lg font-semibold text-theme-text-brand",children:s})}function Fe(){return[{id:"name",header:"Stack",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{name:t,id:a}=s();return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(P,{type:"square",size:"md",children:e.jsx(M,{size:"md",children:t[0]})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(Te,{stackName:t,stackId:a,children:e.jsx("h2",{className:"text-text-md font-semibold",children:t})})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:a.split("-")[0]}),e.jsx(b,{copyText:a})]})]})]})}},{id:"created",header:"Created at",accessorFn:s=>{var t;return(t=s.body)==null?void 0:t.created},cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(je,{dateString:s()})})},{id:"author",header:"Author",accessorFn:s=>{var t;return{author:(t=s.body)==null?void 0:t.user}},cell:({getValue:s})=>{const{author:t}=s();return t?e.jsx(Ce,{username:t.name}):null}},{id:"actions",header:"",accessorKey:"name",cell:({getValue:s})=>e.jsx(Se,{name:s()})}]}function Oe({setHasResumeableStack:s}){const{success:t,data:a}=z(),r=h({...f.stackDeploymentStack({provider:(a==null?void 0:a.provider)||"aws",stack_name:(a==null?void 0:a.stackName)||"",date_start:a==null?void 0:a.timestamp}),enabled:t,throwOnError:!0});return c.useEffect(()=>{r.data&&(he(),s(!1))},[r.data]),!t||r.isError?null:r.isPending?e.jsx(m,{className:"h-[70px] w-full"}):e.jsx(k,{className:"w-full",children:e.jsxs("section",{className:"flex flex-wrap items-center justify-between gap-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"font-semibold",children:"You have a Stack provision incomplete"}),e.jsx("p",{className:"text-text-sm",children:"Return to the setup and finish the configuration on your cloud provider"})]}),e.jsx("div",{children:e.jsx(g,{className:"w-fit bg-theme-surface-primary",intent:"primary",emphasis:"subtle",asChild:!0,children:e.jsx(H,{to:A.stacks.create.newInfra,children:e.jsx("span",{children:"Review Stack"})})})})]})})}const j=1,Be=p.object({page:p.coerce.number().min(j).optional().default(j).catch(j),name:p.string().optional(),operator:p.enum(["and","or"]).optional()});function $e(){const[s]=fe(),{page:t,name:a,operator:r}=Be.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:t,name:a,logical_operator:r}}function _e(){const[s,t]=c.useState(z().success),a=$e(),{refetch:r,data:n}=h({...f.stackList({...a,sort_by:"desc:updated"}),throwOnError:!0});return e.jsx("section",{className:"p-5",children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx(xe,{searchParams:a}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(g,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>r(),children:[e.jsx(oe,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),e.jsx(g,{size:"md",asChild:!0,children:e.jsxs(H,{to:A.stacks.create.index,children:[e.jsx(le,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Stack"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[s&&e.jsx(Oe,{setHasResumeableStack:t}),e.jsx("div",{className:"w-full",children:n?e.jsx(ne,{columns:Fe(),data:n.items}):e.jsx(m,{className:"h-[500px] w-full"})}),n?n.total_pages>1&&e.jsx(me,{searchParams:a,paginate:n}):e.jsx(m,{className:"h-[36px] w-[300px]"})]})]})})}function os(){const{setCurrentBreadcrumbData:s}=ce(),{setTourState:t,tourState:{tourActive:a}}=ie();return c.useEffect(()=>{a&&t(r=>({...r,run:!0,stepIndex:r.stepIndex}))},[a]),c.useEffect(()=>{s({segment:"stacks",data:null})},[]),e.jsxs("div",{children:[e.jsx(ve,{}),e.jsx(_e,{})]})}export{os as default};
