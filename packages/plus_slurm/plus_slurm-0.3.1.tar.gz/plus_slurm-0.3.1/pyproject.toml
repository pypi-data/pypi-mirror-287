[project]
name = "plus_slurm"
dynamic = ["version"]
description = "Convenient Python Abstraction for the Slurm based cluster at the PLUS"
authors = [{name = "Thomas Hartmann", email = "thomas.hartmann@th-ht.de"}]
requires-python = ">= 3.9"
readme = "README.md"
license = { text = "GPL-3.0" }
homepage = "https://gitlab.com/thht/plus-slurm"
dependencies = ['jinja2',
    'future',
    'humanfriendly',
    'six',
    'numpy',
    'psutil']
classifiers=[
    'Development Status :: 5 - Production/Stable',
    'Intended Audience :: Science/Research',
    'License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)',
    'Operating System :: OS Independent',
    'Programming Language :: Python',
]
keywords = ["slurm", "cluster"]

[build-system]
requires = ["hatchling", "hatch-regex-commit"]
build-backend = "hatchling.build"

[tool.pixi.project]
channels = ["conda-forge"]
platforms = ["linux-64", "osx-64", "win-64", "osx-arm64"]

[tool.pixi.pypi-dependencies]
plus-slurm = { path = ".", editable = true }
id = "*"
types-humanfriendly = ">=10.0.1.11,<11"

[tool.pixi.dependencies]
hatch = ">=1.12.0,<1.13"
hatch-vcs = ">=0.4.0,<0.5"
ruff = ">=0.4.9,<0.5"
pre-commit = ">=3.7.1,<3.8"
pytest = ">=8.2.2,<8.3"
pytest-cov = ">=5.0.0,<5.1"
sphinx = ">=7.4.7,<8"
sphinx-autobuild = ">=2024.4.16,<2025"
sphinx_rtd_theme = ">=2.0.0,<3"
myst-parser = ">=3.0.1,<4"
mypy = ">=1.10.1,<2"
types-six = ">=1.16.21.20240513,<2"
types-psutil = ">=5.9.5.6,<6"

[tool.pixi.feature]
py39 = {dependencies = {python="3.9.*"}}
py310 = {dependencies = {python="3.10.*"}}
py311 = {dependencies = {python="3.11.*"}}
py312 = {dependencies = {python="3.12.*"}}

[tool.pixi.environments]
testpy39 = ['py39']
testpy310 = ['py310']
testpy311 = ['py311']
testpy312 = ['py312']

[tool.pixi.tasks]
test = "pytest --cov=plus_slurm --cov-report=lcov"
lint = "ruff format && ruff check --fix"
lint_ci = "ruff check"
build = { cmd = "hatch build", depends-on = ["lint_ci", "test"] }
doc_dev = "sphinx-autobuild doc/source doc/build"
build_docs = "cd doc; make clean; make html"
check_types = "mypy plus_slurm tests"
version_minor = "hatch version minor && hatch version dev"
version_fix = "hatch version fix && hatch version dev"

[tool.hatch.version]
source = "regex_commit"
path = "plus_slurm/__version__.py"
tag_sign = false

[tool.ruff]
line-length = 120

[tool.ruff.lint]
extend-select = [
    'E',
    'W',
    'I',
    'UP',
    'C90',
    'N',
    'PTH',
    'SIM',
    'TCH',
    'PL'
]

[tool.ruff.format]
quote-style = 'single'

[tool.mypy]
disable_error_code = "import-untyped"
disallow_untyped_defs = false

[[tool.mypy.overrides]]
module = "plus_slurm.*"
disallow_untyped_defs = true

[[tool.mypy.overrides]]
module = "plus_slurm.jinja2_templates.*"
disable_error_code = "import-untyped, name-defined, operator"
