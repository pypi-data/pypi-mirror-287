import{d as Q,u as W,N as $,M as X,b3 as ae,o as b,n as P,w as r,a as i,Q as Y,b as F,f as y,V as d,d8 as Z,cD as _,O as ee,dH as de,q as ne,p as R,c as C,F as D,r as J,m as q,c2 as H,dI as ue,ct as me,dJ as j,aV as K,dK as ce}from"./index-DCXcuAJz.js";const ge=Q({__name:"ExportDialog",props:{model:{type:Boolean,required:!1,default:!0},project:{type:Boolean,required:!1,default:!0}},emits:["closeDialog"],setup(E,{emit:B}){const V=W(),m=E,w=$(()=>V.currentSimulator.stores.modelDBStore),e=$(()=>V.currentSimulator.stores.projectDBStore),n=X({items:[],selected:[]}),U=[{title:"Name",value:"name"},{title:"Created at",key:"props.createdAt"}],A=B;function v(a){A("closeDialog",a)}const S=()=>{de(JSON.stringify(n.selected.map(a=>a.props))),n.selected=[]},x=()=>{n.selected=[],n.items=[],m.model&&w.value.state.models.forEach(a=>{const s={name:a.label,props:a.toJSON()};m.project&&(s.group="model"),n.items.push(s)}),m.project&&e.value.state.projects.forEach(a=>{const s={name:a.name,props:a.doc?a.toJSON():a};m.model&&(s.group="project"),n.items.push(s)})};return ae(()=>{x()}),(a,s)=>(b(),P(ee,null,{default:r(()=>[i(Y,{class:"d-flex justify-space-between align-center"},{default:r(()=>[i(F,{icon:"mdi:mdi-export",size:"small"}),y(" Export "),i(d,{onClick:s[0]||(s[0]=g=>v()),flat:"",icon:"mdi:mdi-close",size:"small"})]),_:1}),i(Z,{"group-by":[{key:"group",order:"asc"}],headers:U,items:n.items,"item-selectable":"valid","item-value":"name","return-object":"","show-select":"",modelValue:n.selected,"onUpdate:modelValue":s[1]||(s[1]=g=>n.selected=g)},{"item.valid":r(({value:g})=>[i(F,{color:g?"success":"error",icon:g?"mdi:mdi-check":"mdi:mdi-close"},null,8,["color","icon"])]),_:1},8,["items","modelValue"]),i(_,null,{default:r(()=>[i(d,{disabled:n.selected.length===0,onClick:s[2]||(s[2]=()=>{S(),v()}),"prepend-icon":"mdi:mdi-export",size:"small",text:"export selected",variant:"outlined"},null,8,["disabled"]),i(d,{onClick:s[3]||(s[3]=g=>x()),"prepend-icon":"mdi:mdi-reload",size:"small",text:"Reload",variant:"outlined"}),i(d,{onClick:s[4]||(s[4]=g=>v()),size:"small",text:"close",variant:"outlined"})]),_:1})]),_:1}))}}),be=Q({__name:"ImportDialog",emits:["closeDialog"],setup(E,{emit:B}){const V=W(),m=$(()=>V.currentSimulator.stores.modelDBStore),w=$(()=>V.currentSimulator.stores.projectDBStore),e=X({githubFiles:[],githubGroup:"project",githubSelectedFile:{path:""},githubSelectedTree:{path:""},githubTag:"v3",githubTrees:[],items:[],selected:[],source:"",url:""}),n=[{icon:"network:network",title:"Import projects",value:"projects"},{icon:"nest:logo",title:"Import models",value:"models"}],U=[{icon:"mdi:mdi-paperclip",title:"Import from drive",value:"drive"},{icon:"mdi:mdi-github",title:"Import from GitHub",value:"github"},{icon:"mdi:mdi-web",title:"Import from URL",value:"url"}],A=[{title:"Name",value:"name"},{title:"Created at",key:"props.createdAt"},{title:"Version",key:"props.version"},{title:"Valid",key:"valid"}],v=o=>`https://api.github.com/repos/nest-desktop/nest-desktop-${e.githubGroup}/git/trees/`,S=o=>`https://raw.githubusercontent.com/nest-desktop/nest-desktop-${o||e.githubGroup}/${e.githubTag}/`,x=o=>{if(o==null)return;(Array.isArray(o)?o:[o]).forEach(l=>{var M,L;let c=!1;const u="elementType"in l?"model":"network"in l?"project":void 0;if(u===void 0)return;const f=[];let k,I,z="";switch(u){case"model":I=l,z=I.label||"",c=m.value.validateModel(I);break;case"project":k=l,z=k.name||"",c=w.value.validateProject(k);const T=k.network;T&&ce(T)&&((M=T.models)==null||M.forEach(p=>{p.existing&&!m.value.hasModel(p.existing)&&!f.includes(p.existing)&&f.push(p.existing)})),(L=T.nodes)==null||L.forEach(p=>{if(!("model"in p))return;const h=p;h.model&&!m.value.hasModel(h.model)&&!f.includes(h.model)&&f.push(h.model)}),j.get(S("models")+"index.json").then(p=>{p.data&&f.forEach(h=>{const O=p.data[h];O&&g(O,h)})});break}e.items.push({group:u,name:z,props:l,valid:c})})},a=B;function s(o){a("closeDialog",o)}const g=(o,t)=>{j.get(S("models")+o).then(l=>{if(!l.data)return;const u=(Array.isArray(l.data)?l.data:[l.data]).find(k=>k.id===t);if(!u)return;const f=m.value.validateModel(u);e.items.push({group:"model",name:u.label||"",props:u,valid:f})})},te=o=>{e.githubSelectedFile={path:""},e.githubFiles=[],j.get(v()+o.sha).then(t=>{e.githubFiles=t.data.tree.filter(l=>l.type==="blob"&&l.path.endsWith(".json"))})},le=()=>{e.githubSelectedTree={path:""},e.githubSelectedFile={path:""},e.githubFiles=[],e.githubTrees=[],K(()=>{j.get(v()+`${e.githubTag}?recursive=true`).then(o=>{e.githubTrees=o.data.tree.filter(t=>t.type==="tree")})})},G=o=>{e.url.length!==0&&j.get(e.url).then(t=>x(t.data))},oe=()=>{ie(),se()},ie=()=>{const o=e.selected.filter(t=>t.group==="model").map(t=>t.props);m.value.importModels(o)},se=()=>{const o=e.selected.filter(t=>t.group==="project").map(t=>t.props);w.value.importProjects(o)},N=o=>{const t=Array.isArray(o)?o[0]:o;if(!t)return;const l=new FileReader;l.readAsText(t),l.addEventListener("load",c=>{var u;return x(JSON.parse((u=c.target)==null?void 0:u.result))})},re=()=>{K(()=>{const o=e.githubSelectedTree;!o&&!Object.keys(o).includes("path")||(e.url=S()+`${o.path}/${e.githubSelectedFile.path}`)})};return(o,t)=>(b(),P(ee,null,{default:r(()=>[i(Y,{class:"d-flex justify-space-between align-center"},{default:r(()=>[i(F,{icon:"mdi:mdi-import",size:"small"}),y(" Import "),i(d,{onClick:t[0]||(t[0]=l=>s()),flat:"",icon:"mdi:mdi-close",size:"small"})]),_:1}),i(ne,{class:"px-2",color:"transparent",density:"compact"},{default:r(()=>[i(R,{class:"mr-1",density:"compact",mandatory:"",modelValue:e.source,"onUpdate:modelValue":t[1]||(t[1]=l=>e.source=l),variant:"outlined"},{default:r(()=>[(b(),C(D,null,J(U,(l,c)=>i(d,q({key:c,style:{"min-width":"40px"},ref_for:!0},l),null,16)),64))]),_:1},8,["modelValue"]),e.source==="github"?(b(),C(D,{key:0},[i(R,{"onUpdate:modelValue":[t[2]||(t[2]=l=>le()),t[3]||(t[3]=l=>e.githubGroup=l)],class:"mx-1",density:"compact",mandatory:"",modelValue:e.githubGroup,variant:"outlined"},{default:r(()=>[(b(),C(D,null,J(n,(l,c)=>i(d,q({key:c,style:{"min-width":"40px"},ref_for:!0},l),null,16)),64))]),_:1},8,["modelValue"]),i(H,{disabled:e.githubTrees.length===0,items:e.githubTrees,label:e.githubGroup+" path","onUpdate:modelValue":[te,t[4]||(t[4]=l=>e.githubSelectedTree=l)],class:"mx-1",density:"compact",flat:"","hide-details":"","item-title":"path","prepend-icon":"mdi:mdi-github","return-object":"",modelValue:e.githubSelectedTree,variant:"outlined"},null,8,["disabled","items","label","modelValue"]),i(H,{disabled:e.githubFiles.length===0,items:e.githubFiles,"onUpdate:modelValue":[re,t[5]||(t[5]=l=>e.githubSelectedFile=l)],class:"mx-1",density:"compact",flat:"","hide-details":"","item-title":"path",label:"File","return-object":"",modelValue:e.githubSelectedFile,variant:"outlined"},null,8,["disabled","items","modelValue"]),i(d,{onClick:t[6]||(t[6]=l=>G()),flat:"","prepend-icon":"mdi:mdi-download",variant:"outlined"},{default:r(()=>[y(" Fetch ")]),_:1})],64)):e.source==="drive"?(b(),P(ue,{key:1,"onUpdate:modelValue":N,density:"compact",flat:"","hide-details":"",label:"File","show-size":"",title:"Click to select a file","truncate-length":"100",variant:"outlined"},{append:r(()=>[i(d,{onUpload:N,flat:"","prepend-icon":"mdi:mdi-upload",variant:"outlined"},{default:r(()=>[y(" Upload ")]),_:1})]),_:1})):e.source==="url"?(b(),P(me,{key:2,class:"ma-0 pa-0",clearable:"",density:"compact",flat:"","full-width":"","hide-details":"",label:"URL","prepend-icon":"mdi:mdi-web",title:"Please enter the project's URL",modelValue:e.url,"onUpdate:modelValue":t[8]||(t[8]=l=>e.url=l),variant:"outlined"},{append:r(()=>[i(d,{onClick:t[7]||(t[7]=l=>G()),flat:"","prepend-icon":"mdi:mdi-download",variant:"outlined"},{default:r(()=>[y(" Fetch ")]),_:1})]),_:1},8,["modelValue"])):(b(),C(D,{key:3},[i(F,{icon:"mdi:mdi-arrow-left-thin"}),y(" Please select one source of files to import. ")],64))]),_:1}),i(Z,{"group-by":[{key:"group",order:"asc"}],headers:A,items:e.items,"show-expand":!1,"item-selectable":"valid","item-value":"name","return-object":"","show-select":"",modelValue:e.selected,"onUpdate:modelValue":t[9]||(t[9]=l=>e.selected=l)},{"item.valid":r(({value:l})=>[i(F,{color:l?"success":"error",icon:l?"mdi:mdi-check":"mdi:mdi-close"},null,8,["color","icon"])]),_:1},8,["items","modelValue"]),i(_,null,{default:r(()=>[i(d,{disabled:e.selected.length===0,onClick:t[10]||(t[10]=()=>{oe(),s()}),"prepend-icon":"mdi:mdi-import",size:"small",text:"import selected",variant:"outlined"},null,8,["disabled"]),i(d,{onClick:t[11]||(t[11]=l=>e.items=[]),"prepend-icon":"mdi:mdi-delete-empty-outline",size:"small",text:"Clear",variant:"outlined"}),i(d,{onClick:t[12]||(t[12]=l=>s()),size:"small",text:"close",variant:"outlined"})]),_:1})]),_:1}))}});export{ge as _,be as a};
