import{d as $,dL as P,M as C,b3 as j,D as R,o as g,n as h,w as l,a as t,b as Q,f as v,V as T,Q as W,K as A,c2 as _,P as L,cD as F,O as U,aV as x,dJ as M,cj as G,bj as X,j as Y,s as J,t as N,c as Z,v as I,i as D,m as ee,dM as te,b$ as q,e as w,dN as le,N as H,bT as K,l as se,q as ae,dO as z,cC as oe,cw as de,cR as ne,cv as ie,L as B,ct as O}from"../../../js/index-DCXcuAJz.js";const E="https://api.github.com/repos/nest/nestml",me="https://raw.githubusercontent.com/nest/nestml",ue=$({__name:"NESTMLScriptDialog",props:{elementType:{}},emits:["closeDialog"],setup(V,{emit:c}){var f;const s=P(),u=V,e=C({elementType:"",elementTypes:[],githubTag:((f=s.state.response.data)==null?void 0:f.nestml)||"",githubTags:[],model:"",models:[],script:""}),n=c;function m(i){n("closeDialog",i)}const d=async()=>{e.elementType="",e.model="",e.models=[],x(()=>{M.get(`${E}/git/trees/${e.githubTag}`).then(i=>{const o=r(i.data.tree,"models");o&&M.get(`${E}/git/trees/${o.sha}`).then(S=>{e.elementTypes=S.data.tree||[]})})})},p=async()=>(e.elementType="",e.model="",M.get(`${E}/tags`).then(i=>{i.status===200&&(e.githubTags=i.data||[])})),b=()=>{x(()=>{const i=r(e.elementTypes,e.elementType);i&&M.get(i.url).then(o=>{e.models=o.data.tree})})},a=()=>{x(()=>{const i=`${me}/${e.githubTag}/models/${e.elementType}/${e.model}`;M.get(i).then(o=>{o.status===200&&o.data&&(e.script=o.data)})})},r=(i,o)=>i.find(S=>S.path===o),k=()=>{const i=e.elementType.slice(0,e.elementType.length-1);m({script:e.script,elementType:i})};return j(()=>{p().then(()=>{e.elementType=u.elementType+"s",d()})}),(i,o)=>{const S=R("codemirror");return g(),h(U,null,{default:l(()=>[t(W,{class:"d-flex justify-space-between align-center"},{default:l(()=>[t(Q,{icon:"mdi:mdi-cloud-arrow-down-outline",size:"small"}),v(" Fetch NESTML script from GitHub "),t(T,{onClick:o[0]||(o[0]=y=>m()),flat:"",icon:"mdi:mdi-close",size:"small"})]),_:1}),t(L,null,{default:l(()=>[t(A,{class:"mb-2"},{default:l(()=>[t(_,{disabled:e.githubTags.length===0,items:e.githubTags,"model-value":e.githubTag,"onUpdate:modelValue":o[1]||(o[1]=y=>d()),class:"mx-2",density:"compact","hide-details":"","item-title":"name","item-value":"name",label:"Select a tag",variant:"outlined"},null,8,["disabled","items","model-value"]),t(_,{disabled:e.elementTypes.length===0,items:e.elementTypes,"model-value":e.elementType,"onUpdate:modelValue":o[2]||(o[2]=y=>b()),class:"mx-2",density:"compact","hide-details":"","item-title":"path","item-value":"path",label:"Select an element type",variant:"outlined"},null,8,["disabled","items","model-value"]),t(_,{disabled:e.models.length===0,items:e.models,"model-value":e.model,"onUpdate:modelValue":a,class:"mx-2",density:"compact","hide-details":"","item-title":"path","item-value":"path",label:"Select a nestml file",variant:"outlined"},null,8,["disabled","items","model-value"])]),_:1}),t(S,{disabled:"",modelValue:e.script,"onUpdate:modelValue":o[3]||(o[3]=y=>e.script=y)},null,8,["modelValue"])]),_:1}),t(F,null,{default:l(()=>[t(T,{disabled:!e.script,onClick:o[4]||(o[4]=y=>k()),size:"small",text:"load",title:"Load nestml script",variant:"outlined"},null,8,["disabled"]),t(T,{onClick:o[5]||(o[5]=y=>m()),size:"small",text:"close",variant:"outlined"})]),_:1})]),_:1})}}}),re={key:0},ce=J("kbd",null,"+",-1),pe=$({__name:"NESTModuleCombobox",setup(V){const c=G(),s=C({search:"nestmlmodule",exist:!0,valid:!1}),u=[n=>(s.valid=typeof n=="string"?n.endsWith("module"):!0,s.valid||"The module name must ends with `module`.")],e=()=>{const n=c.moduleNames();s.exist=n.includes(s.search)};return(n,m)=>(g(),h(le,{"append-inner-icon":s.valid&&!s.exist?"mdi:mdi-plus":"","hide-no-data":!1,items:w(c).state.modules,rules:u,"onClick:appendInner":m[0]||(m[0]=d=>s.valid?w(c).addModule(s.search):""),"onUpdate:search":[m[1]||(m[1]=d=>e()),m[3]||(m[3]=d=>s.search=d)],"onUpdate:modelValue":m[2]||(m[2]=d=>e()),density:"compact","hide-details":"auto",label:"Module","prepend-inner-icon":"mdi:mdi-memory","item-title":"name","item-value":"name",search:s.search,variant:"outlined"},{append:l(()=>[X(n.$slots,"append")]),"no-data":l(()=>[t(D,null,{default:l(()=>[t(Y,null,{default:l(()=>[v(' No results matching " '),J("strong",null,N(s.search),1),v('". '),s.valid?(g(),Z("span",re,[v(" Click "),ce,v(" to create a new one. ")])):I("",!0)]),_:1})]),_:1})]),item:l(({index:d,item:p,props:b})=>[(g(),h(D,ee({key:d,class:"module-item"},b,{title:""}),{prepend:l(()=>[t(te,{class:"text-uppercase",size:"small",start:""},{default:l(()=>[v(N(p.title.slice(0,2)),1)]),_:2},1024)]),append:l(()=>[t(T,{onClick:q(a=>w(c).removeModule(p.title),["stop"]),class:"icon",flat:"",icon:"mdi:mdi-close",size:"x-small"},null,8,["onClick"])]),default:l(()=>[v(" "+N(p.title),1)]),_:2},1040))]),_:3},8,["append-inner-icon","items","search"]))}}),ve=$({__name:"NESTMLModelEditor",props:{model:{}},setup(V){const c=G(),s=P(),u=V,e=H(()=>u.model),n=C({selectedModules:c.state.modules.filter(a=>a.models.includes(e.value.id))}),m=()=>{s.axiosInstance().post("getParams",{element_type:e.value.elementType,script:e.value.nestmlScript}).then(a=>{switch(a.status){case 200:alert(JSON.stringify(a.data.params,null,2));break;case 400:z("Failed to get params for model.");break}}).catch(a=>{z(a.message)})},d=()=>{oe({title:"",text:"",customComponent:{component:ue,props:{elementType:e.value.elementType}},dialogOptions:{width:"1280px"}}).then(a=>{a&&(e.value.nestmlScript=a.script,e.value.elementType=a.elementType)})},p=()=>{c.state.modules.forEach(a=>{x(()=>{n.selectedModules.includes(a)&&!a.models.includes(e.value.id)&&e.value.nestmlScript.length>0?a.models.push(e.value.id):!n.selectedModules.includes(a)&&a.models.includes(e.value.id)&&a.models.splice(a.models.indexOf(e.value.id),1),de()})})},b=()=>{n.selectedModules=c.state.modules.filter(a=>a.models.includes(e.value.id))};return j(b),K(()=>u.model,b),(a,r)=>{const k=R("codemirror");return g(),h(U,{class:"my-2",flat:""},{default:l(()=>[t(ae,{color:"transparent",density:"compact"},{append:l(()=>[t(pe,{onClick:r[1]||(r[1]=q(()=>{},["stop"])),"onUpdate:modelValue":[r[2]||(r[2]=f=>p()),r[3]||(r[3]=f=>n.selectedModules=f)],chips:"",width:"400",multiple:"",modelValue:n.selectedModules},null,8,["modelValue"])]),default:l(()=>[t(T,{onClick:r[0]||(r[0]=f=>d()),"prepend-icon":"mdi:mdi-cloud-arrow-down-outline",text:"Load nestml script",variant:"outlined"}),t(T,{onClick:m,class:"mx-1",variant:"outlined"},{default:l(()=>[v(" get params ")]),_:1}),t(se)]),_:1}),t(L,null,{default:l(()=>[t(k,{modelValue:e.value.nestmlScript,"onUpdate:modelValue":r[4]||(r[4]=f=>e.value.nestmlScript=f)},null,8,["modelValue"])]),_:1})]),_:1})}}}),ge=$({__name:"ModelEditor",setup(V){const c=ne(),s=ie(),u=H(()=>s.model),e=C({modelId:s.state.modelId}),n=()=>{u.value.id=e.modelId,s.state.modelId=e.modelId,s.saveModel(),c.push({name:"nestModelEditor",params:{modelId:s.state.modelId}})};return K(()=>s.state.modelId,()=>{e.modelId=s.state.modelId}),(m,d)=>u.value?(g(),h(U,{key:0,flat:"",title:"Model editor"},{default:l(()=>[t(L,null,{default:l(()=>[t(A,null,{default:l(()=>[t(B,{cols:"6"},{default:l(()=>[t(O,{density:"compact",disabled:"","hide-details":"",label:"Model id",modelValue:e.modelId,"onUpdate:modelValue":d[0]||(d[0]=p=>e.modelId=p),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(B,{cols:"6"},{default:l(()=>[t(O,{density:"compact","hide-details":"",label:"Model label",modelValue:u.value.label,"onUpdate:modelValue":d[1]||(d[1]=p=>u.value.label=p),variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),u.value.custom?(g(),h(ve,{key:0,model:u.value},null,8,["model"])):I("",!0)]),_:1}),t(F,null,{default:l(()=>[t(T,{onClick:d[2]||(d[2]=p=>n())},{default:l(()=>[v("save")]),_:1})]),_:1})]),_:1})):I("",!0)}});export{ge as default};
