"use strict";(self.webpackChunkjupyterlab_gallery=self.webpackChunkjupyterlab_gallery||[]).push([[906],{906:(e,t,s)=>{s.r(t),s.d(t,{default:()=>_});var a=s(605),r=s(765),i=s(586),n=s(360),o=s(345),l=s(988),c=s(355),d=s(602),h=s(74),p=s(465);async function m(e,t,s={}){const a=p.ServerConnection.makeSettings(),r=h.URLExt.join(a.baseUrl,t,e);let i;try{i=await p.ServerConnection.makeRequest(r,s,a)}catch(e){throw new p.ServerConnection.NetworkError(e)}let n=await i.text();if(n.length>0)try{n=JSON.parse(n)}catch(e){console.log("Not a JSON response body.",i)}if(!i.ok)throw new p.ServerConnection.ResponseError(i,n.message||n);return n}const u=new c.LabIcon({name:"jupyterlab-gallery:gallery",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="jp-icon3" fill="rgb(97,97,97)" d="M1 3V21H23V3H1M21 5V14H3V5H21M11 16V19H8V16H11M3 16H6V19H3V16M13 19V16H16V19H13M18 19V16H21V19H18Z" /></svg>'}),g=new c.LabIcon({name:"jupyterlab-gallery:repository",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="jp-icon3" fill="rgb(97,97,97)"  d="M6,2H18A2,2 0 0,1 20,4V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M12.75,13.5C15.5,13.5 16.24,11.47 16.43,10.4C17.34,10.11 18,9.26 18,8.25C18,7 17,6 15.75,6C14.5,6 13.5,7 13.5,8.25C13.5,9.19 14.07,10 14.89,10.33C14.67,11 14,12 12,12C10.62,12 9.66,12.35 9,12.84V8.87C9.87,8.56 10.5,7.73 10.5,6.75C10.5,5.5 9.5,4.5 8.25,4.5C7,4.5 6,5.5 6,6.75C6,7.73 6.63,8.56 7.5,8.87V15.13C6.63,15.44 6,16.27 6,17.25C6,18.5 7,19.5 8.25,19.5C9.5,19.5 10.5,18.5 10.5,17.25C10.5,16.32 9.94,15.5 9.13,15.18C9.41,14.5 10.23,13.5 12.75,13.5M8.25,16.5A0.75,0.75 0 0,1 9,17.25A0.75,0.75 0 0,1 8.25,18A0.75,0.75 0 0,1 7.5,17.25A0.75,0.75 0 0,1 8.25,16.5M8.25,6A0.75,0.75 0 0,1 9,6.75A0.75,0.75 0 0,1 8.25,7.5A0.75,0.75 0 0,1 7.5,6.75A0.75,0.75 0 0,1 8.25,6M15.75,7.5A0.75,0.75 0 0,1 16.5,8.25A0.75,0.75 0 0,1 15.75,9A0.75,0.75 0 0,1 15,8.25A0.75,0.75 0 0,1 15.75,7.5Z" /></svg>'});class b extends l.ReactWidget{constructor(e){super(),this.options=e,this._reloadOnFinish=async(e,t)=>{"finished"===t.phase&&(await this._load(),await this.options.refreshFileBrowser())},this._update=new d.Signal(this),this._exhibits=null,this._stream=new d.Stream(this);const{trans:t,fileChanged:s}=e;this._trans=t,this._status=t.__("Gallery loading..."),this._actions={open:async t=>{e.openPath(t.localPath)},download:async e=>{const t=new Promise(((t,s)=>{const a=(r,i)=>{i.exhibit_id===e.id&&("finished"===i.phase?(t(),this._stream.disconnect(a)):"error"===i.phase&&(s(),this._stream.disconnect(a)))};this._stream.connect(a)})),s=document.cookie.match("\\b_xsrf=([^;]*)\\b"),a={exhibit_id:e.id};s&&(a._xsrf=s[1]),await m("pull",this.options.serverAPI,{method:"POST",body:JSON.stringify(a)}),await t}},s.connect(((e,t)=>{"delete"===t.type&&this._load()})),this._eventSource=function(e="",t,s,a){const r=p.ServerConnection.makeSettings();let i=h.URLExt.join(r.baseUrl,a,e);const n=document.cookie.match("\\b_xsrf=([^;]*)\\b");if(n){const e=new URL(i);e.searchParams.append("_xsrf",n[1]),i=e.toString()}const o=new EventSource(i);return o.addEventListener("message",(e=>{const s=JSON.parse(e.data);t(s)})),o.addEventListener("error",(e=>{s(e)})),window.addEventListener("beforeunload",(()=>{o.close()})),o}("pull",(e=>{this._stream.emit(e)}),(e=>{console.error(e)}),this.options.serverAPI),this._stream.connect(this._reloadOnFinish),this._load()}dispose(){super.dispose(),this._eventSource.close(),this._stream.disconnect(this._reloadOnFinish)}async _load(){try{const e=await m("exhibits",this.options.serverAPI);this.exhibits=e.exhibits,this.exhibits.every((e=>!e.isCloned||"boolean"==typeof e.updatesAvailable))||setTimeout((()=>this._load()),1e3)}catch(e){this._status=`jupyterlab_gallery server failed:\n${e}`}this.update()}get exhibits(){return this._exhibits}set exhibits(e){this._exhibits=e}update(){super.update(),this._update.emit()}render(){return o.createElement(c.UseSignal,{signal:this._update},(()=>this.exhibits?o.createElement(y,{exhibits:this.exhibits,actions:this._actions,progressStream:this._stream,trans:this._trans}):o.createElement("div",{className:"jp-Gallery jp-mod-loading"},this._status)))}}function y(e){return o.createElement("div",{className:"jp-Gallery"},e.exhibits.map((t=>o.createElement(w,{trans:e.trans,key:t.repository,exhibit:t,actions:e.actions,progressStream:e.progressStream}))))}function w(e){const{exhibit:t,actions:s}=e,[a,r]=o.useState(null),[i,n]=o.useState("");o.useEffect((()=>{const s=(e,s)=>{var a;if(s.exhibit_id===t.id)switch(s.phase){case"error":(0,l.showErrorMessage)("Could not download",null!==(a=s.output)&&void 0!==a?a:"Unknown error");break;case"progress":r(s.output),n(s.output.message);break;case"finished":r(null);break;default:console.warn("Unhandled message",s)}};return e.progressStream.connect(s),()=>{e.progressStream.disconnect(s)}}));const d="boolean"==typeof t.updatesAvailable;return o.createElement("div",{className:"jp-Exhibit"},o.createElement("h4",{className:"jp-Exhibit-title"},t.title),o.createElement("div",{className:"jp-Exhibit-middle"},o.createElement("div",{className:"jp-Exhibit-icon"},t.icon?o.createElement("img",{src:t.icon,alt:t.title}):o.createElement(g.react,{className:"jp-exhibitPlaceholder"})),o.createElement("div",{className:"jp-Exhibit-buttons"},t.isCloned?o.createElement(o.Fragment,null,o.createElement(c.Button,{minimal:!0,title:e.trans.__("Open"),onClick:()=>{s.open(t)}},o.createElement(c.folderIcon.react,null)),o.createElement(c.Button,{disabled:!t.updatesAvailable,minimal:!0,title:d?e.trans.__("Fetch latest changes"):e.trans.__("Checking upstream status"),onClick:async()=>{n("Refreshing"),r({progress:.25,message:"Refreshing"});try{await s.download(t),r(null)}catch(e){r({...a,state:"error"}),n("")}}},d?o.createElement(c.downloadIcon.react,null):o.createElement(c.refreshIcon.react,{className:"jp-spinningIcon"}))):o.createElement(c.Button,{minimal:!0,title:e.trans.__("Set up"),onClick:async()=>{n("Downloading"),r({progress:0,message:"Initializing"});try{await s.download(t)}catch(e){r({...a,state:"error"}),n("")}}},o.createElement(c.downloadIcon.react,null)))),o.createElement("div",{className:"jp-Exhibit-bottom"},a?o.createElement("div",{className:"jp-Exhibit-progressbar"+("error"===a.state?" jp-Exhibit-progressbar-error":"")},o.createElement("div",{className:"jp-Exhibit-progressbar-filler",style:{width:100*a.progress+"%"}}),o.createElement("div",{className:"jp-Exhibit-progressMessage"},i)):null,o.createElement("div",{className:"jp-Exhibit-description"},t.description)))}const x={id:"jupyterlab-gallery:plugin",description:"A JupyterLab gallery extension for presenting and downloading examples from remote repositories",autoStart:!0,requires:[r.ISettingRegistry],optional:[i.IFileBrowserCommands,a.ITranslator,n.ILauncher],activate:async(e,t,s,r,i)=>{let n;console.log("JupyterLab extension jupyterlab-gallery is activated!");try{n=await t.load(x.id),console.log("jupyterlab-gallery settings loaded:",n.composite)}catch(e){return void console.error("Failed to load settings for jupyterlab-gallery.",e)}const o=n.composite.endpoint,l=(r=null!=r?r:a.nullTranslator).load("jupyterlab-gallery"),c=new b({trans:l,openPath:t=>{if(!s)throw Error("filebrowser not available");e.commands.execute(s.openPath,{path:t})},fileChanged:e.serviceManager.contents.fileChanged,refreshFileBrowser:()=>e.commands.execute("filebrowser:refresh"),serverAPI:o}),d=await m("gallery",o);"1.0"!==d.apiVersion&&console.warn(`jupyter-gallery API version out of sync, expected 1.0, got ${d.apiVersion}`);const h="Gallery"===d.title?l.__("Gallery"):d.title;!d.hideGalleryWithoutExhibits||d.exhibitsConfigured?i&&function(e){return"addSection"in e}(i)?i.addSection({title:h,className:"jp-Launcher-openExample",icon:u,id:"gallery",rank:2.5,render:()=>c.render()}):(c.id="jupyterlab-gallery:sidebar",c.title.icon=u,c.title.caption=h,c.show(),e.shell.add(c,"left",{rank:850})):console.log("Gallery extension will not add any UI elements because no exhibits are configured")}},_=x}}]);