"use strict";(self.webpackChunkjupyterlab_forum=self.webpackChunkjupyterlab_forum||[]).push([[18],{18:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var o=n(607),s=n(256),i=n(74);function a(e,t,n,o){const s=e.node.querySelector("#themes-container");if(!s)return;const i=o.filter((e=>e.Sticky)),a=o.filter((e=>!e.Sticky));i.sort(((e,t)=>new Date(e.CreationTime).getTime()-new Date(t.CreationTime).getTime())),a.sort(((e,t)=>new Date(t.CreationTime).getTime()-new Date(e.CreationTime).getTime()));const r=(t-1)*n,l=r+n,c=[...i,...a].slice(r,l);s.innerHTML=c.map((e=>`\n\n        <div class="subforum-row ${e.Sticky?"sticky":""}">\n            ${e.Sticky?'<div class="sticky-symbol">ðŸ“Œ</div>':""}\n            <div class="subforum-description subforum-column">\n                <h4><a href="#" class="description-link" data-description-id="${e.ThemeID}">${e.Title}</a></h4>\n                <p>Created at ${new Date(e.CreationTime).toLocaleString()}</p>\n            </div>\n            <div class="subforum-info subforum-column">\n                <p>\n                  Posted by ${e.Author}\n                </p>\n                <p class="status-indicator">\n                  <span class="status-circle ${"Open"===e.Status?"status-open":"status-closed"}"></span>\n                  Status: ${e.Status}\n                </p>\n            </div>\n        </div>\n        <hr class="subforum-devider" />\n\n    `)).join("")}function r(e,t,n){const o=e.node.querySelector("#pagination-controls");if(!o)return;const s=Math.ceil(t/n);let i="";for(let e=1;e<=s;e++)i+=`<button class="page-link" data-page="${e}">${e}</button>`;o.innerHTML=i}async function l(e,t){const n=i.PageConfig.getToken();try{const o=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`token ${n}`}});if(!o.ok)throw new Error("Network response was not ok");const s=await o.json();e.allThemes=s.themes,e.showThemes=s.themes}catch(t){console.error("Error fetching themes:",t);const n=[{ThemeID:1,Title:"Example Theme 1",Author:"Admin",CreationTime:"2024-07-01T10:00:00",Status:"Open",Sticky:!0,Commentable:!1},{ThemeID:2,Title:"Example Theme 2",Author:"User123",CreationTime:"2024-07-15T15:30:00",Status:"Closed",Sticky:!1,Commentable:!0},{ThemeID:3,Title:"Example Theme 3",Author:"User123",CreationTime:"2024-07-15T15:30:00",Status:"Closed",Sticky:!1,Commentable:!0},{ThemeID:4,Title:"Example Theme 4",Author:"User123",CreationTime:"2024-07-15T15:30:00",Status:"Closed",Sticky:!1,Commentable:!0},{ThemeID:5,Title:"Example Theme 5",Author:"User123",CreationTime:"2024-07-15T15:30:00",Status:"Closed",Sticky:!1,Commentable:!0},{ThemeID:6,Title:"Example Theme 6",Author:"User123",CreationTime:"2024-07-15T15:30:00",Status:"Closed",Sticky:!1,Commentable:!0},{ThemeID:7,Title:"Example Theme 7",Author:"User123",CreationTime:"2024-07-15T15:30:00",Status:"Closed",Sticky:!1,Commentable:!0}];e.showThemes=n,e.allThemes=n}a(e,1,e.themesPerPage,e.showThemes),r(e,e.allThemes.length,e.themesPerPage)}var c=n(960),d=n.n(c);function h(e){return new(d())("#themeDescription",{theme:"snow",modules:{toolbar:[[{header:[1,2,!1]}],["bold","italic","underline"],["link","image"],[{list:"ordered"},{list:"bullet"}]]}})}async function u(e,t,n,o){const s={Title:"Example Theme",Description:"This is an example theme description.",Author:"User123",CreationTime:"2024-07-24T10:08",Status:"Open",Sticky:!0,Commentable:!1,Replies:[{Author:"Example Author2",Content:"This is an example reply to the theme2.",CreationTime:"2024-07-22T10:08"},{Author:"Example Author",Content:"This is an example reply to the theme.",CreationTime:"2024-07-24T10:08"}]},a=i.PageConfig.getToken();try{const s=await async function(e){const t=new URL(e);t.pathname="/jupyterhub/hub/api/groups/dozent";const n=i.PageConfig.getToken();if(!n)throw new Error("API token is not available from PageConfig.");let o;try{const e=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`token ${n}`}});if(!e.ok)throw new Error(`Network response was not ok: ${e.statusText}`);o=await e.json(),console.log("Response Data:",o)}catch(e){console.error("Error fetching data:",e),o={users:[e]}}return o.users}(n),r=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`token ${a}`},body:JSON.stringify({ThemeID:t})}),c=await r.json();e.node.innerHTML=`\n          <div class="topic">\n            <div class="topic-header">\n              <h2 class="topic-title">${c.Title}</h2>\n              <div class="topic-meta">\n                <span class="topic-author">by ${c.Author}</span>\n                <span class="topic-date">${new Date(c.CreationTime).toLocaleString()}</span>\n              </div>\n            </div>\n\n            <div class="topic-body">\n              <div class="topic-content">${c.Description}</div>\n              <div class="topic-stats">\n                <span>${c.Replies.length} Replies</span> â€¢\n              </div>\n            </div>\n\n            <div class="topic-replies">\n              <h3>Replies:</h3>\n              <div class="replies-container">  </div>\n            </div>\n\n            ${c.Commentable?'\n              <div class="form-group">\n                <label for="themeDescription">Your Reply:</label>\n                <div id="themeDescription" name="quill-editor"></div>\n                <button id="reply-to-theme" class="btn btn-reply">Commit Reply</button>\n              </div>\n            ':""}\n\n            <button id="back-to-forum" class="btn btn-primary">Back to Forum</button>\n            ${o!==c.Author&&!s.includes(o)||c.Sticky?"":`\n              <button id="toggle-status" class="btn btn-secondary">${"Open"===c.Status?"Close":"Open"} Theme</button>\n              <button id="delete-theme" class="btn btn-danger">Delete Theme</button>\n            `}\n          </div>\n        `;const d=e.node.querySelector(".replies-container");c.Replies.forEach((e=>{const t=document.createElement("div");t.className="reply",t.innerHTML=`\n              <div class="reply-header">\n                <span class="reply-author">${e.Author}</span>\n                <span class="reply-date">${new Date(e.CreationTime).toLocaleString()}</span>\n              </div>\n              <div class="reply-content">${e.Content}</div>\n            `,null==d||d.appendChild(t)}));const m=h(),p=e.node.querySelector("#toggle-status");p&&p.addEventListener("click",(async()=>{try{const s="Open"===c.Status?"Closed":"Open",i=await fetch(`${n}/togglestatus`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`token ${a}`},body:JSON.stringify({ThemeID:t,Status:s})});i.ok?u(e,t,n,o):console.error("Failed to toggle status:",i.status)}catch(e){console.error("Error toggling status:",e)}}));const T=e.node.querySelector("#back-to-forum");null==T||T.addEventListener("click",(()=>{e.node.innerHTML=e.originalHTML,l(e,n)}));const b=e.node.querySelector("#reply-to-theme");null==b||b.addEventListener("click",(()=>{!async function(e,t,n,o,s){const a=i.PageConfig.getToken(),r=e.node.querySelector("#submitReplyButton");r&&r.addEventListener("click",(async()=>{const i={Content:s,Author:t,ThemeID:n};try{const s=await fetch(o+"replytheme",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json",Authorization:`token ${a}`}});if(s.ok){const i=(await s.json()).ReplyID;u(e,n,o,t),console.log("Reply sent successfully with ID:",i)}else console.error("Failed to send reply:",s.status),u(e,n,o,t)}catch(e){console.error("Error sending reply:",e)}}))}(e,o,t,n,m.root.innerHTML)}));const y=e.node.querySelector("#delete-theme");y&&y.addEventListener("click",(async()=>{if(window.confirm("Are you sure you want to delete this theme?"))try{const o=await fetch(`${n}/deletetheme`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`token ${a}`},body:JSON.stringify({ThemeID:t})});o.ok?(e.node.innerHTML=e.originalHTML,l(e,n)):console.error("Failed to delete theme:",o.status)}catch(e){console.error("Error deleting theme:",e)}}))}catch(i){console.error("Error fetching theme details:",i);const r=s;e.node.innerHTML=`\n          <div class="topic">\n            <div class="topic-header">\n              <h2 class="topic-title">${r.Title}</h2>\n              <div class="topic-meta">\n                <span class="topic-author">by ${r.Author}</span>\n                <span class="topic-date">${new Date(r.CreationTime).toLocaleString()}</span>\n              </div>\n            </div>\n\n            <div class="topic-body">\n              <div class="topic-content">${r.Description}</div>\n              <div class="topic-stats">\n                <span>${r.Replies.length} Replies</span> â€¢\n              </div>\n            </div>\n\n            <div class="topic-replies">\n              <h2>Replies:</h2>\n              <div class="replies-container">  </div>\n            </div>\n\n            ${r.Commentable?'\n              <div class="form-group">\n                <label for="themeDescription">Your Reply:</label>\n                <div id="themeDescription" name="quill-editor"></div>\n                <button id="reply-to-theme" class="btn btn-reply">Commit Reply</button>\n              </div>\n            ':""}\n\n            <button id="back-to-forum" class="btn btn-primary">Back to Forum</button>\n\n\n            ${r.Sticky?"":`\n              <button id="delete-theme" class="btn btn-danger">Delete Theme</button>\n              <button id="toggle-status" class="btn btn-secondary">${"Open"===r.Status?"Close":"Open"} Theme</button>\n            `}\n\n          </div>\n        `;const c=e.node.querySelector("#back-to-forum");null==c||c.addEventListener("click",(()=>{e.node.innerHTML=e.originalHTML,l(e,n)}));const d=e.node.querySelector(".replies-container");r.Replies.forEach((e=>{const t=document.createElement("div");t.className="reply",t.innerHTML=`\n              <div class="reply-header">\n                <span class="reply-author">${e.Author}</span> â€¢\n                <span class="reply-date">${new Date(e.CreationTime).toLocaleString()}</span>\n              </div>\n              <div class="reply-content">${e.Content}</div>\n            `,null==d||d.appendChild(t)}));const h=e.node.querySelector("#toggle-status");h&&h.addEventListener("click",(async()=>{try{const s="Open"===r.Status?"Closed":"Open",i=await fetch(`${n}/togglestatus`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({ThemeID:t,Status:s})});i.ok?u(e,t,n,o):console.error("Failed to toggle status:",i.status)}catch(e){console.error("Error toggling status:",e)}}));const m=e.node.querySelector("#delete-theme");m&&m.addEventListener("click",(async()=>{if(window.confirm("Are you sure you want to delete this theme?"))try{const o=await fetch(`${n}/deletetheme`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`token ${a}`},body:JSON.stringify({ThemeID:t})});o.ok?(e.node.innerHTML=e.originalHTML,l(e,n)):console.error("Failed to delete theme:",o.status)}catch(e){console.error("Error deleting theme:",e)}}))}}n(131);class m extends s.Widget{constructor(e,t){super(),this.username=e,this.forumEndpointUrl=t,this.activeTab="all",this.currentPage=1,this.themesPerPage=5,this.allThemes=[],this.showThemes=[],this.addClass("forumWidget"),this.originalHTML='\n\n            <div class="subforum">\n              <div class="subforum-title">\n                <h2>Current Themes </h2>\n                <div class="tabs">\n                  <div class="tab-group">\n                    <button class="tab" data-tab="All">All</button>\n                    <button class="tab" data-tab="Open">Open</button>\n                    <button class="tab" data-tab="Closed">Closed</button>\n                  </div>\n                </div>\n\n                <div class="search-container">\n                  <input type="text" id="searchBox" placeholder="Search themes...">\n                </div>\n\n                <div class="actions-container">\n                  <button class="create-theme-button" id="createThemeButton"><strong>+</strong> New Theme</button>\n                </div>\n              </div>\n              <div id="themes-container"></div>\n              <div id="pagination-controls" class="pagination-controls"></div>\n            </div>\n\n            ',this.node.innerHTML=this.originalHTML,l(this,t),this.node.addEventListener("click",(t=>{var n,o;const s=t.target;if(s.classList.contains("create-theme-button")&&async function(e,t,n){e.node.innerHTML='\n\n  <div class="create-theme-form">\n    <div class="form-group">\n      <label for="themeTitle">Title:</label>\n      <input type="text" id="themeTitle" name="themeTitle" required>\n    </div>\n    <div class="form-group">\n      <label for="themeDescription">Description:</label>\n      <div id="themeDescription" name="quill-editor"></div>\n    </div>\n    <button id="submitThemeButton" class="btn btn-secondary"">\n      <strong>+</strong> Create Theme\n    </button>\n    <button id="back-to-forum" class="btn btn-primary">Back to Forum</button>\n  </div>\n  ';const o=h(),s=e.node.querySelector("#back-to-forum");null==s||s.addEventListener("click",(()=>{e.node.innerHTML=e.originalHTML,l(e,n)}));const a=e.node.querySelector("#submitThemeButton");a&&a.addEventListener("click",(async()=>{const s=e.node.querySelector("#themeTitle"),a=o.root.innerHTML,r=i.PageConfig.getToken(),l={Title:s.value,Description:a,Author:t,Status:"Open",Sticky:!1,Commentable:!0};try{const o=await fetch(n+"createtheme",{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json",Authorization:`token ${r}`}});if(o.ok){const s=(await o.json()).ThemeID;u(e,s,n,t)}else console.error("Failed to create theme:",o.status)}catch(e){console.error("Error creating theme:",e)}}))}(this,this.username,this.forumEndpointUrl),s.classList.contains("tab")&&(this.activeTab=null!==(n=s.dataset.tab)&&void 0!==n?n:"Open",this.currentPage=1,this.updateTabDisplay()),s.classList.contains("description-link")){const n=s.getAttribute("data-description-id");t.preventDefault(),u(this,n,this.forumEndpointUrl,e)}s.classList.contains("page-link")&&(this.currentPage=parseInt(null!==(o=s.dataset.page)&&void 0!==o?o:"1",10),a(this,this.currentPage,this.themesPerPage,this.showThemes))}))}updateTabDisplay(){this.showThemes=this.allThemes.filter((e=>"All"===this.activeTab||e.Status===this.activeTab)),a(this,this.currentPage,this.themesPerPage,this.showThemes),r(this,this.allThemes.length,this.themesPerPage)}}const p={id:"jupyterlab_forum:plugin",description:"A JupyterLab extension for databrix forum frontend",autoStart:!0,requires:[o.ICommandPalette],activate:function(e,t){console.log("JupyterLab extension forum is activated!");const n=e.serviceManager.user,s=i.PageConfig.getBaseUrl(),a=new URL(s).pathname,r=window.location.origin;let l;l=a.includes("/user/")?`${r}${a.split("/user/")[0]}`:`${r}`;const c=`${l}/services/forum/`;console.log("JupyterHub Base URL:",c);const d=()=>{const e=new m(n.identity?n.identity.name:"Unknown User",c),t=new o.MainAreaWidget({content:e});return t.id="forum-jupyterlab",t.title.label="Forum",t.title.closable=!0,t};let h=d();const u="forum:open";e.commands.addCommand(u,{label:"Databrix Forum",execute:()=>{h.isDisposed&&(h=d()),h.isAttached||e.shell.add(h,"main"),e.shell.activateById(h.id)}}),t.addItem({command:u,category:"Forum"})}}}}]);