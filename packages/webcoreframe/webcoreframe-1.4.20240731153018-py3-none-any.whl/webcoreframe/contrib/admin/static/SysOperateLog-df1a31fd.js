import{_ as G,M as P,A as u,S as d,E as V,r,o as p,c as _,a as i,b as t,w as h,F as g,s as v,d as x,I as C,J as D,x as f}from"./index-b85cf3e9.js";import{P as I,a as k}from"./pageUtils-acf5de9e.js";const T={components:{ElMessageBox:P},data(){return{TableData:[],TablePage:0,currentPage:1,userOption:"",userDataOption:[],ipOption:"",codeOption:"",codeDataOption:[{label:"200",value:200},{label:"302",value:302},{label:"401",value:401},{label:"403",value:403},{label:"404",value:404},{label:"429",value:429},{label:"500",value:500}]}},computed:{operate(o){return this.$route.params.sys_log_operate}},watch:{operate(o,e){this.GetSysLogs(),this.GetSysLogSize()},userOption(o,e){this.GetSysLogs(),this.GetSysLogSize()},ipOption(o,e){this.GetSysLogs(),this.GetSysLogSize()},codeOption(o,e){this.GetSysLogs(),this.GetSysLogSize()}},created(){this.GetSysLogs(),this.GetSysLogSize()},methods:{getQueryArgs(o){let e={};return o!==void 0&&(e.get_count=!0),e._page=this.currentPage,e._page_size=I,this.operate==="sys_log_intercept"?e.code=400:this.operate==="sys_log_error"?e.code=500:this.operate==="sys_log_throttling"?e.code=429:this.operate==="sys_log_other"&&(e.code="200,400,429,500",e._op_code="not in"),this.userOption!==""&&(e.user_id=this.userOption),this.ipOption!==""&&(e.user_ip=this.ipOption,e._op_user_ip="regexp"),this.codeOption!==""&&(e.code=this.codeOption),e},GetSysLogs(){u.get(d.sys_system_logs,this.getQueryArgs()).then(({data:o})=>{this.TableData=o.data})},GetSysLogSize(){u.get(d.sys_system_logs,this.getQueryArgs(!0)).then(({data:o})=>{this.TablePage=k(o.data)})},handleTableDelete(o,e){u.delete(d.sys_system_logs,{id:e.id}).then(({data:n})=>{n.code===200?this.BlackTableData.splice(o,1):V.error("删除任务失败")})},GetUserList(o){this.userDataOption=[{label:"游客",value:0}],o&&u.get(d.sys_system_users,{}).then(({data:e})=>{e.code===200&&e.data.forEach(n=>{this.userDataOption.push({label:n.username,value:n.id})})})},ClearSearchArgs(){this.userOption="",this.ipOption="",this.codeOption=""}}},b=o=>(C("data-v-949d0381"),o=o(),D(),o),z={class:"search"},A={class:"sub-search"},B=b(()=>i("span",{class:"lable"},"用户名 ",-1)),U={class:"sub-search"},E=b(()=>i("span",{class:"lable"},"IP ",-1)),M={class:"sub-search"},N=b(()=>i("span",{class:"lable"},"响应码 ",-1)),Q={class:"sub-search"},F={class:"logs"},J={class:"page"};function j(o,e,n,q,a,c){const w=r("el-option"),m=r("el-select"),y=r("el-input"),O=r("el-button"),s=r("el-table-column"),S=r("el-table"),L=r("el-pagination");return p(),_(g,null,[i("div",z,[i("div",A,[B,t(m,{onVisibleChange:c.GetUserList,modelValue:a.userOption,"onUpdate:modelValue":e[0]||(e[0]=l=>a.userOption=l),filterable:"",placeholder:"需要查询的用户",style:{width:"240px"}},{default:h(()=>[(p(!0),_(g,null,v(a.userDataOption,l=>(p(),f(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["onVisibleChange","modelValue"])]),i("div",U,[E,t(y,{modelValue:a.ipOption,"onUpdate:modelValue":e[1]||(e[1]=l=>a.ipOption=l),placeholder:"需要查询的IP",style:{width:"240px"}},null,8,["modelValue"])]),i("div",M,[N,t(m,{modelValue:a.codeOption,"onUpdate:modelValue":e[2]||(e[2]=l=>a.codeOption=l),filterable:"",placeholder:"需要查询的接口状态码",style:{width:"240px"}},{default:h(()=>[(p(!0),_(g,null,v(a.codeDataOption,l=>(p(),f(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),i("div",Q,[t(O,{type:"primary",onClick:c.ClearSearchArgs},{default:h(()=>[x("清 空")]),_:1},8,["onClick"])])]),i("div",F,[t(S,{data:a.TableData,style:{width:"100%"}},{default:h(()=>[t(s,{prop:"id",label:"ID","min-width":"100"}),t(s,{prop:"createtime",label:"创建时间","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"endpoint",label:"请求端点","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"method",label:"请求方法","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"pre_args",label:"预处理前查询参数","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"pre_forms",label:"预处理前请求体参数","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"pre_path",label:"预处理前请求路径","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"args",label:"查询参数","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"forms",label:"请求体参数","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"path",label:"预处理前请求路径","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"ua",label:"用户代理头","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"user_id",label:"用户ID","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"user_ip",label:"用户IP","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"time",label:"处理时长","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"code",label:"响应码","min-width":"100","show-overflow-tooltip":"true"}),t(s,{prop:"body",label:"响应体","min-width":"100","show-overflow-tooltip":"true"})]),_:1},8,["data"]),i("div",J,[t(L,{background:"",layout:"prev, pager, next","page-count":a.TablePage,"hide-on-single-page":"true","current-page":a.currentPage,"onUpdate:currentPage":e[3]||(e[3]=l=>a.currentPage=l),onCurrentChange:c.GetSysLogs},null,8,["page-count","current-page","onCurrentChange"])])])],64)}const R=G(T,[["render",j],["__scopeId","data-v-949d0381"]]);export{R as default};
