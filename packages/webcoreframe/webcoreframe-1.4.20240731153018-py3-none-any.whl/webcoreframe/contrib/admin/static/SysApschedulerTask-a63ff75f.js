import{_ as z,M as B,N as F,A as _,S as m,E as V,r as i,o as r,c as p,b as s,w as o,a as n,F as T,d as g,s as D,v as U,t as M,x,I as H,J}from"./index-b85cf3e9.js";import{d as S}from"./dateUtils-a37efffc.js";import{P as O,a as q}from"./pageUtils-acf5de9e.js";const K={components:{ElMessageBox:B,Timer:F},data(){return{TablePage:0,currentPage:1,dialogVisible:!1,taskValue:"",taskType:"",taskName:"",taskArgs:"",run_date:"",interval_week:0,interval_day:0,interval_hour:0,interval_minute:0,interval_second:0,interval_date:"",taskList:[],TaskTableData:[],apschedulerTypesDate:!1,apschedulerTypesInterval:!1,apschedulerTypes:[{value:"date",label:"日期"},{value:"interval",label:"间隔"}],defaultTime:new Date}},created(){this.GetApschedulerTask(),this.GetSysApschedulerTaskList(),this.GetSysApschedulerTaskListSize()},watch:{taskType(a,l){a==="date"&&(this.apschedulerTypesDate=!0,this.apschedulerTypesInterval=!1),a==="interval"&&(this.apschedulerTypesInterval=!0,this.apschedulerTypesDate=!1)}},methods:{handleStr(a){return a.trim().trim(`
`)},GetApschedulerTask(){_.get(m.sys_apscheduler,{get_apscheduler_handler_info:!0}).then(({data:a})=>{Object.keys(a.data).forEach(u=>{let c=this.handleStr(a.data[u]);this.taskList.push({value:u,label:c})})})},GetSysApschedulerTaskList(){_.get(m.sys_apscheduler,{_page:this.currentPage,_page_size:O}).then(({data:a})=>{this.TaskTableData=a.data})},GetSysApschedulerTaskListSize(){_.get(m.sys_apscheduler,{get_count:!0}).then(({data:a})=>{this.TablePage=q(a.data)})},CreateApschedulerTaskHandler(){this.dialogVisible=!1;let a={types:this.taskType,name:this.taskName,func:this.taskValue,args:this.taskArgs};this.apschedulerTypesDate===!0?a.run_date=S.formatDateStr2Format(this.run_date):(a.weeks=this.interval_week,a.days=this.interval_day,a.hours=this.interval_hour,a.minutes=this.interval_minute,a.seconds=this.interval_second,a.start_date=S.formatDateStr2Format(this.interval_date[0]),a.end_date=S.formatDateStr2Format(this.interval_date[1])),_.post(m.sys_apscheduler,a).then(({data:l})=>{l.code===200?this.TaskTableData.unshift(l.data[0]):V.error(l.msg)})},handleTableEdit(a,l){let u={action:"resume"};l.pending!==!0&&(u.action="pause"),_.put(m.sys_apscheduler,u,{job_id:l.job_id}).then(({data:c})=>{c.code===200?this.TaskTableData[a]=c.data[0]:V.error("操作任务失败")})},handleTableDelete(a,l){_.delete(m.sys_apscheduler,void 0,{job_id:l.job_id}).then(({data:u})=>{u.code===200?this.TaskTableData.splice(a,1):V.error("删除任务失败")})}}},d=a=>(H("data-v-31bfaa9d"),a=a(),J(),a),Q={class:"apscheduler-info"},R={class:"apscheduler-config-info"},W={class:"apscheduler-config-detail"},X={key:0,class:"apscheduler-config-detail-args"},Y=d(()=>n("span",null,"任务执行时间 ",-1)),Z=d(()=>n("span",null,"任务参数 ",-1)),$={key:1,class:"apscheduler-config-detail-args"},ee=d(()=>n("span",null,"开始时间&结束时间 ",-1)),le=d(()=>n("span",null,"间隔：周 ",-1)),te=d(()=>n("span",null,"间隔：日 ",-1)),ae=d(()=>n("span",null,"间隔：小时 ",-1)),se=d(()=>n("span",null,"间隔：分钟 ",-1)),ne=d(()=>n("span",null,"间隔：秒 ",-1)),oe=d(()=>n("span",null,"任务参数 ",-1)),ie={class:"dialog-footer"},re={class:"table-data"},de={style:{display:"flex","align-items":"center"}},ue={key:0,style:{"margin-left":"10px"}},pe={key:1,style:{"margin-left":"10px"}},_e={class:"page"};function me(a,l,u,c,t,k){const w=i("el-option"),A=i("el-select"),y=i("el-col"),b=i("el-input"),P=i("el-row"),C=i("el-date-picker"),h=i("el-input-number"),f=i("el-button"),I=i("el-dialog"),v=i("el-table-column"),L=i("timer"),N=i("el-icon"),j=i("el-table"),E=i("el-pagination");return r(),p(T,null,[s(I,{modelValue:t.dialogVisible,"onUpdate:modelValue":l[13]||(l[13]=e=>t.dialogVisible=e),title:"创建定时任务",width:"50%"},{footer:o(()=>[n("span",ie,[s(f,{onClick:l[12]||(l[12]=e=>t.dialogVisible=!1)},{default:o(()=>[g("取 消")]),_:1}),s(f,{type:"primary",onClick:k.CreateApschedulerTaskHandler},{default:o(()=>[g(" 确 认 ")]),_:1},8,["onClick"])])]),default:o(()=>[n("div",Q,[n("div",R,[s(P,null,{default:o(()=>[s(y,{span:8},{default:o(()=>[s(A,{modelValue:t.taskValue,"onUpdate:modelValue":l[0]||(l[0]=e=>t.taskValue=e),filterable:"",placeholder:"选择任务"},{default:o(()=>[(r(!0),p(T,null,D(t.taskList,e=>(r(),x(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(y,{span:8},{default:o(()=>[s(A,{modelValue:t.taskType,"onUpdate:modelValue":l[1]||(l[1]=e=>t.taskType=e),class:"m-2",placeholder:"选择定时类型"},{default:o(()=>[(r(!0),p(T,null,D(t.apschedulerTypes,e=>(r(),x(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(y,{span:8},{default:o(()=>[s(b,{modelValue:t.taskName,"onUpdate:modelValue":l[2]||(l[2]=e=>t.taskName=e),placeholder:"定时任务别名"},null,8,["modelValue"])]),_:1})]),_:1})]),n("div",W,[t.apschedulerTypesDate?(r(),p("div",X,[n("li",null,[Y,s(C,{modelValue:t.run_date,"onUpdate:modelValue":l[3]||(l[3]=e=>t.run_date=e),type:"datetime",placeholder:"任务执行时间","default-time":t.defaultTime},null,8,["modelValue","default-time"])]),n("li",null,[Z,s(b,{modelValue:t.taskArgs,"onUpdate:modelValue":l[4]||(l[4]=e=>t.taskArgs=e),placeholder:"多个参数使用&隔开"},null,8,["modelValue"])])])):U("",!0),t.apschedulerTypesInterval?(r(),p("div",$,[n("li",null,[ee,s(C,{modelValue:t.interval_date,"onUpdate:modelValue":l[5]||(l[5]=e=>t.interval_date=e),type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间","default-time":t.defaultTime},null,8,["modelValue","default-time"])]),n("li",null,[le,s(h,{modelValue:t.interval_week,"onUpdate:modelValue":l[6]||(l[6]=e=>t.interval_week=e),min:0},null,8,["modelValue"])]),n("li",null,[te,s(h,{modelValue:t.interval_day,"onUpdate:modelValue":l[7]||(l[7]=e=>t.interval_day=e),min:0},null,8,["modelValue"])]),n("li",null,[ae,s(h,{modelValue:t.interval_hour,"onUpdate:modelValue":l[8]||(l[8]=e=>t.interval_hour=e),min:0},null,8,["modelValue"])]),n("li",null,[se,s(h,{modelValue:t.interval_minute,"onUpdate:modelValue":l[9]||(l[9]=e=>t.interval_minute=e),min:0},null,8,["modelValue"])]),n("li",null,[ne,s(h,{modelValue:t.interval_second,"onUpdate:modelValue":l[10]||(l[10]=e=>t.interval_second=e),min:0},null,8,["modelValue"])]),n("li",null,[oe,s(b,{modelValue:t.taskArgs,"onUpdate:modelValue":l[11]||(l[11]=e=>t.taskArgs=e),placeholder:"多个参数使用&隔开"},null,8,["modelValue"])])])):U("",!0)])])]),_:1},8,["modelValue"]),n("div",re,[s(j,{data:t.TaskTableData,style:{width:"100%"}},{default:o(()=>[s(v,{prop:"job_id",label:"任务id","min-width":"100"}),s(v,{prop:"job_name",label:"任务名称","min-width":"100"}),s(v,{label:"任务状态","min-width":"100"},{default:o(e=>[n("div",de,[s(N,null,{default:o(()=>[s(L)]),_:1}),e.row.pending?(r(),p("span",pe,"已暂停")):(r(),p("span",ue,"已启动"))])]),_:1}),s(v,{align:"right"},{header:o(()=>[s(f,{type:"primary",plain:"",onClick:l[14]||(l[14]=e=>t.dialogVisible=!0)},{default:o(()=>[g(" 创建定时任务 ")]),_:1})]),default:o(e=>[s(f,{size:"small",onClick:G=>k.handleTableEdit(e.$index,e.row)},{default:o(()=>[g(M(e.row.pending===!0?"启 动":"暂 停"),1)]),_:2},1032,["onClick"]),s(f,{size:"small",type:"danger",onClick:G=>k.handleTableDelete(e.$index,e.row)},{default:o(()=>[g("删 除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),n("div",_e,[s(E,{background:"",layout:"prev, pager, next","page-count":t.TablePage,"hide-on-single-page":"true","current-page":t.currentPage,"onUpdate:currentPage":l[15]||(l[15]=e=>t.currentPage=e),onCurrentChange:k.GetSysApschedulerTaskList},null,8,["page-count","current-page","onCurrentChange"])])])],64)}const ge=z(K,[["render",me],["__scopeId","data-v-31bfaa9d"]]);export{ge as default};
