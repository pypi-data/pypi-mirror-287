"use strict";(self.webpackChunk_secretflow_secretnote=self.webpackChunk_secretflow_secretnote||[]).push([[47],{30651:function(Yi,ln,m){m.r(ln),m.d(ln,{default:function(){return Ji}});var Gi=m(24352),Fr=m(35252),Pr=m(67147),Ze=m(85100),Mr=m(63778),Ir=m(79102),E=m(40897),we=m(19859),Lr=m(90819),f=m.n(Lr),$r=m(89933),y=m.n($r),Ar=m(78796),D=m.n(Ar),Rr=m(4977),z=m.n(Rr),Zr=m(10154),h=m.n(Zr),O=m(37637),Te=Symbol("SQLCellModelFactory"),Dr=m(73193),j=m.n(Dr),zr=m(26336),q=m.n(zr),Hr=m(41553),C=m.n(Hr),Vr=m(78846),cn=m.n(Vr),xr=m(54088),dn=m.n(xr),Wr=m(49488),de=m.n(Wr),Qr=m(84047),fe=m.n(Qr),Ur=m(62055),_=m.n(Ur),Ki=m(23202),$=m(73004),me=m(15063),ie=m(97754),De=m(30393),ge=m(68280),ee=m(44194),Br=m(83743),Jr=m(65583),fn=m(60373),ze=m(80042),R=m(99959),F=m(26281),Yr=m(98612),Gr=m(86919),I=m(17),je=null,Ne={},mn=function(){var e=location.pathname.split("/");return e[e.length-1]},vn=function(){var o=y()(f()().mark(function e(){return f()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!je){r.next=4;break}return r.next=3,je;case 3:return r.abrupt("return",r.sent);case 4:return je=new Promise(function(n,i){(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getDataTables",project_id:mn()})}).then(function(a){var s=a.map(function(c){return{name:c.table_name,owner:c.table_owner,columns:c.columns}});n(s)}).catch(function(a){i(a)})}),r.next=7,je;case 7:return r.abrupt("return",r.sent);case 8:case"end":return r.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),He=function(){var o=y()(f()().mark(function e(t){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!Ne[t]){n.next=4;break}return n.next=3,Ne[t];case 3:return n.abrupt("return",n.sent);case 4:return Ne[t]=new Promise(function(i,a){(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getTableCCL",project_id:mn(),table_name:t})}).then(function(s){var c=[];s.forEach(function(l){var p=l.col.column_name,d=l.party_code,b=l.constraint,v=c.find(function(T){return T.column===p});v?v[d]=b:c.push(h()({column:p},d,b))}),i(c)}).catch(function(s){a(s)})}),n.next=7,Ne[t];case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}},e)}));return function(t){return o.apply(this,arguments)}}(),Ve=function(e){return e.length<1?"":`
  <table border="1" class="dataframe">
    <thead>
      <tr>
        `.concat(Object.keys(e[0]).map(function(t){return"<th>".concat(t,"</th>")}).join(`
`),`
      </tr>
    </thead>
    <tbody>
      `).concat(e.map(function(t){return`<tr>
              `.concat(Object.keys(t).map(function(r){return"<td>".concat(t[r],"</td>")}).join(`
`),`
            </tr>`)}).join(`
`),`
    </tbody>
  </table>
  `)},Kr=function(){var o=y()(f()().mark(function e(){var t;return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,vn();case 2:return t=n.sent,n.abrupt("return",t.map(function(i){return{label:i.name,insertText:i.name,sortText:"A".concat(i.name),kind:R.Mj.CompletionItemKind.Folder,detail:i.owner}}));case 4:case"end":return n.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),Oe=function(){var o=y()(f()().mark(function e(t){var r,n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r=I.Z(t,"tableName.value",""),a.next=3,vn();case 3:if(n=a.sent.find(function(s){return s.name===r}),n){a.next=6;break}return a.abrupt("return",[]);case 6:return a.abrupt("return",n.columns.map(function(s){return{label:s.name,insertText:s.name,sortText:"B".concat(s.name),kind:R.Mj.CompletionItemKind.Field,detail:s.dtype}}));case 7:case"end":return a.stop()}},e)}));return function(t){return o.apply(this,arguments)}}(),pn=function(e){return Promise.resolve(["SUM","COUNT","AVG"].map(function(t){return{label:t,insertText:t,sortText:"C".concat(t),kind:R.Mj.CompletionItemKind.Function}}))},Xr=function(e){return{label:e,insertText:e,sortText:"D".concat(e),kind:R.Mj.CompletionItemKind.Folder}},qr=function(){var o=y()(f()().mark(function e(){var t,r,n,i,a,s=arguments;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:for(t=s.length,r=new Array(t),n=0;n<t;n++)r[n]=s[n];if(i=I.Z(r,"[0].tableInfo.tableName.value",""),i){l.next=4;break}return l.abrupt("return",[]);case 4:return l.next=6,He(i);case 6:if(a=l.sent,a&&a.length){l.next=9;break}return l.abrupt("return",[]);case 9:return l.abrupt("return",[{value:Ve(a),supportHtml:!0,isTrusted:!0}]);case 10:case"end":return l.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),hn=function(){var o=y()(f()().mark(function e(){var t,r,n,i,a,s=arguments;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s.length!==2){l.next=23;break}if(t=s.length<=0?void 0:s[0],r=s.length<=1?void 0:s[1],!t){l.next=23;break}if(r!==null){l.next=13;break}return l.next=7,He(t);case 7:if(n=l.sent,n&&n.length){l.next=10;break}return l.abrupt("return",[]);case 10:return l.abrupt("return",[{value:Ve(n),supportHtml:!0,isTrusted:!0}]);case 13:if(!(r&&r.groupPickerName)){l.next=23;break}return l.next=16,He(r.groupPickerName);case 16:if(i=l.sent,i&&i.length){l.next=19;break}return l.abrupt("return",[]);case 19:if(a=i.find(function(p){return p.column===t}),a){l.next=22;break}return l.abrupt("return",[]);case 22:return l.abrupt("return",[{value:Ve([a]),supportHtml:!0,isTrusted:!0}]);case 23:return l.abrupt("return",[]);case 24:case"end":return l.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),_r=function(){return Promise.resolve([])},ea=m(12689),na=m(83788),ta=m(67876);function xe(o,e){return We.apply(this,arguments)}function We(){return We=y()(f()().mark(function o(e,t){var r,n,i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e){s.next=2;break}return s.abrupt("return",null);case 2:if(r=I.Z(e,t),n=t.slice().pop(),i=I.Z(e,t.slice(0,t.length-1)),i){s.next=7;break}return s.abrupt("return",null);case 7:return s.next=9,gn(i,function(){var c=y()(f()().mark(function l(p){return f()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:b.t0=p,b.next=b.t0==="identifier.tableName"?3:b.t0==="identifier.column"?4:b.t0==="identifier.columnAfterGroup"?7:b.t0==="function"?8:9;break;case 3:return b.abrupt("return",{type:"tableName",variant:n,token:r,tableInfo:i});case 4:if(n!=="name"){b.next=6;break}return b.abrupt("return",{type:"tableField",token:r});case 6:return b.abrupt("return",null);case 7:return b.abrupt("return",{type:"tableFieldAfterGroup",token:r,groupName:i.groupName.value});case 8:return b.abrupt("return",{type:"functionName",token:r});case 9:case"end":return b.stop()}},l)}));return function(l){return c.apply(this,arguments)}}());case 9:return s.abrupt("return",s.sent);case 10:case"end":return s.stop()}},o)})),We.apply(this,arguments)}function Qe(o,e,t){if(!o||e.length===0)return null;var r=I.Z(o,e);if(!r)throw Error("Path not found from ast!");if(!r.token&&r.type==="statement")if(t){if(t(r)===!0)return r}else return r;return e.length>1?Qe(o,e.slice(0,e.length-1),t):null}function Ue(o,e,t){return Be.apply(this,arguments)}function Be(){return Be=y()(f()().mark(function o(e,t,r){var n,i,a,s;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,xe(e,t);case 2:if(n=l.sent,i=Qe(e,t),!(!n||!i)){l.next=6;break}return l.abrupt("return",[]);case 6:l.t0=i.variant,l.next=l.t0==="select"?9:l.t0==="join"?10:16;break;case 9:return l.abrupt("return",Fe(i,I.Z(i,"from.sources",[]),n,r));case 10:if(a=t.slice(),a.pop(),s=Qe(e,a,function(p){return p.variant==="select"}),s){l.next=15;break}return l.abrupt("return",[]);case 15:return l.abrupt("return",Fe(s,I.Z(s,"from.sources",[]),n,r));case 16:return l.abrupt("return",[]);case 17:case"end":return l.stop()}},o)})),Be.apply(this,arguments)}function Fe(o,e,t,r){return Je.apply(this,arguments)}function Je(){return Je=y()(f()().mark(function o(e,t,r,n){var i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Promise.all(t.map(function(c){return Ye(e,c,r,n)}));case 2:return i=s.sent,s.abrupt("return",ea.Z(i).filter(function(c){return!!c}));case 4:case"end":return s.stop()}},o)})),Je.apply(this,arguments)}function Ye(o,e,t,r){return Ge.apply(this,arguments)}function Ge(){return Ge=y()(f()().mark(function o(e,t,r,n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",gn(t,function(){var s=y()(f()().mark(function c(l){var p,d,b,v,T,k,S,W,A,Q,he;return f()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:w.t0=l,w.next=w.t0==="statement.tableSource"?3:w.t0==="statement.join"?15:w.t0==="identifier.table"?16:w.t0==="statement.select"?26:34;break;case 3:return w.next=5,Ye(e,t.source,r,n);case 5:if(p=w.sent,!na.Z(t.joins)){w.next=12;break}return w.next=9,Fe(e,I.Z(t,"joins",[]),r,n);case 9:w.t1=w.sent,w.next=13;break;case 12:w.t1=[];case 13:return d=w.t1,w.abrupt("return",p.concat(d));case 15:return w.abrupt("return",Ye(e,t.join,r,n));case 16:return b=t,w.next=19,n(b.name,r.token.value,e);case 19:return v=w.sent,T=I.Z(b,"name.tableNames",[]),k=null,S=I.Z(b,"alias.value"),S?k=S:(W=0,T.forEach(function(M){var P=I.Z(b,"name.".concat(M,".value"));P&&(W++,k=P)}),W>1&&(k=null)),v=v.map(function(M){return j()(j()({},M),{},{tableInfo:b.name,groupPickerName:k||"",originFieldName:M.label})}),w.abrupt("return",v);case 26:return A=t,Q=[],w.next=30,Fe(A,A.from.sources,r,n);case 30:return he=w.sent,A.result.length===1&&A.result[0].name.value==="*"?Q=he.slice():Q=he.map(function(M){var P=A.result.find(function(V){return I.Z(V.name,"token")===!0?V.name.value===M.label:I.Z(V.name,"type")==="identifier"&&I.Z(V.name,"variant")==="columnAfterGroup"?I.Z(V.name,"name.value")===M.label:I.Z(V.name,"type")==="identifier"&&I.Z(V.name,"variant")==="groupAll"?I.Z(V.name,"groupName.value")===M.groupPickerName:!1});return P?P.alias?j()(j()({},M),{},{label:P.alias.value}):M:null}).filter(function(M){return M!==null}).slice(),ta.Z(A,"alias.value")&&(Q=Q.map(function(M){return j()(j()({},M),{},{groupPickerName:I.Z(A,"alias.value")})})),w.abrupt("return",Q);case 34:return w.abrupt("return",null);case 35:case"end":return w.stop()}},c)}));return function(c){return s.apply(this,arguments)}}()));case 1:case"end":return a.stop()}},o)})),Ge.apply(this,arguments)}function gn(o,e){return Ke.apply(this,arguments)}function Ke(){return Ke=y()(f()().mark(function o(e,t){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",null);case 2:if(!e.variant){n.next=4;break}return n.abrupt("return",t("".concat(e.type,".").concat(e.variant)));case 4:return n.abrupt("return",t(e.type));case 5:case"end":return n.stop()}},o)})),Ke.apply(this,arguments)}function bn(o,e,t,r){return Xe.apply(this,arguments)}function Xe(){return Xe=y()(f()().mark(function o(e,t,r,n){var i,a;return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Ue(e,n,r);case 2:if(i=c.sent,a=i.find(function(l){return l.label===t.token.value}),a){c.next=6;break}return c.abrupt("return",null);case 6:return c.abrupt("return",a);case 7:case"end":return c.stop()}},o)})),Xe.apply(this,arguments)}var u=m(32033),ra=(0,u.createLexer)([{type:"whitespace",regexes:[/^(\s+)/],ignore:!0},{type:"comment",regexes:[/^((?:#|--).*?(?:\n|$))/,/^(\/\*[^]*?(?:\*\/|$))/],ignore:!0},{type:"number",regexes:[/^([0-9]+(\.[0-9]+)?|0x[0-9a-fA-F]+|0b[01]+)\b/]},{type:"word",regexes:[/^([a-zA-Z0-9_]+)/,/^(\$\{[a-zA-Z0-9_]+\})/]},{type:"string",regexes:[/^((?=")(?:"[^"\\]*(?:\\[\s\S][^"\\]*)*"))/,/^((?=')(?:'[^'\\]*(?:\\[\s\S][^'\\]*)*'))/,/^((?=`)(?:`[^`\\]*(?:\\[\s\S][^`\\]*)*`))/]},{type:"special",regexes:[/^(\(|\))/,/^(!=|<>|==|<=|>=|!<|!>|\|\||::|->>|->|~~\*|~~|!~~\*|!~~|~\*|!~\*|!~|.)/]}]);function aa(o){var e=function(){return(0,u.chain)(r,t)(function(l){return l[0]})},t=function c(){return(0,u.chain)((0,u.optional)(a,r,c))()},r=function(){return(0,u.chain)(s,n)(function(l){return l[0]})},n=function c(){return(0,u.chain)((0,u.optional)(i,s,c))()},i=function(){return(0,u.chain)(["*","/","%"])(function(l){return l[0]})},a=function(){return(0,u.chain)(["+","-"])(function(l){return l[0]})},s=function(){return(0,u.chain)([(0,u.chain)("(",e,")")(function(l){return l[1]}),o])(function(l){return l[0]})};return e}var ia=["select","create","insert","from","where","order","limit","by","sounds","like","is","in","between","regexp","isnull","lateral","left","right","inner","outer","join"],yn=function(){return(0,u.chain)([(0,u.chain)(["char","varchar","tinytext","text","mediumtext","longtext"])(function(e){return e[0]}),(0,u.chain)(["tinyint","smallint","mediumint","int","integer","bigint"])(function(e){return e[0]}),(0,u.chain)(["real","double","float"])(function(e){return e[0]}),(0,u.chain)(["decimal","numberic"])(function(e){return e[0]}),(0,u.chain)(["date","tinyblob","blob","mediumblob","longblob","bool","boolean"])(function(e){return e[0]}),(0,u.chain)(["bit","time","timestamp","datetime","binary","varbinary","year"])(function(e){return e[0]}),(0,u.chain)(["enum","set"])(function(e){return e[0]}),(0,u.chain)("geometrycollection","linestring","multilinestring","multipoint","multipolygon","point","polygon")(function(e){return e[0]})])(function(e){return e[0]})},Cn=function(){return(0,u.chain)(x,"=",[J,ne])()},oa=function(){return(0,u.chain)(Cn,(0,u.many)(",",Cn))()},x=function(){return(0,u.chain)([(0,u.matchTokenType)("cursor"),(0,u.matchTokenType)("word",{excludes:ia})])(function(e){return e[0]})},J=function(){return(0,u.chain)((0,u.matchTokenType)("string"))(function(e){return e[0]})},ne=function(){return(0,u.chain)((0,u.matchTokenType)("number"))(function(e){return e[0]})},ve=function(){return(0,u.chain)([x,J])(function(e){return e[0]})},ua=function(){return(0,u.chain)([x,J,sa])(function(e){return e[0]})},sa=function(){return(0,u.chain)((0,u.optional)(["-","+"]),ne)()},la=function(){return(0,u.chain)(["and","&&","xor","or","||"])(function(e){return e[0]})},ca=function(){return(0,u.chain)(["&&","||"])(function(e){return e[0]})},da=function(){return(0,u.chain)(["=",">","<","<=",">=","<>","!=","<=>"])(function(e){return e[0]})},fa=function(){return(0,u.chain)(["not","!"])(function(e){return e[0]})},ma=function(){return(0,u.chain)(["all","distinct","distinctrow","high_priority","straight_join","sql_small_result","sql_big_result","sql_buffer_result","sql_cache","sql_no_cache","sql_calc_found_rows"])(function(e){return e[0]})};function va(o){return o!=null}function Se(o){return o.filter(function(e){return va(e)}).reduce(function(e,t){return e.concat(t)},[])}function Sn(o){var e={type:"identifier",variant:"tableName"};return Object.keys(o).forEach(function(t){e[t]=o[t]}),e.tableNames=Object.keys(o),e}var pa=function(){return(0,u.chain)(ha,(0,u.optional)(";"))(function(e){return e[0]})},ha=function(){return(0,u.chain)(En,(0,u.many)((0,u.chain)(";",En)(function(e){return e[1]})))(Se)},En=function(){return(0,u.chain)([be,ka,Fa,Oa,Wa,Ka,ei,ni])(function(e){return e[0]})},be=function o(){return(0,u.chain)("select",ya,(0,u.optional)(ba),(0,u.optional)(Fn),(0,u.optional)(Za),(0,u.optional)(ga,o))(function(e){var t={type:"statement",variant:"select",result:e[1],from:e[2]};return e[5]&&(t.union=e[5]),t})},ga=function(){return(0,u.chain)("union",["all","distinct"])()},ba=function(){return(0,u.chain)("from",Sa,(0,u.optional)(Pe),(0,u.optional)(Ia),(0,u.optional)(Na))(function(e){return{sources:e[1],where:e[2],group:e[3],having:e[4]}})},ya=function(){return(0,u.chain)(kn,(0,u.many)(Ca))(Se)},Ca=function(){return(0,u.chain)(",",kn)(function(e){return e[1]})},kn=function(){return(0,u.chain)([(0,u.chain)((0,u.many)("not"),[(0,u.chain)(Y,(0,u.optional)(Aa))(function(e){return e[0]}),(0,u.chain)("(",Y,")")()],(0,u.optional)(_e))(function(e){return{type:"identifier",variant:"column",name:e[1],alias:e[2]}}),"*"])(function(e){return e[0]})},Pe=function(){return(0,u.chain)("where",oe)(function(e){return e[1]})},wn=function(){return(0,u.chain)(ue,(0,u.many)(",",ue))()},Sa=function(){return(0,u.chain)(Tn,(0,u.many)((0,u.chain)(",",Tn)(function(e){return e[1]})))(Se)},Tn=function(){return(0,u.chain)(qe,(0,u.many)(Ea))(function(e){return{source:e[0],joins:e[1],type:"statement",variant:"tableSource"}})},qe=function(){return(0,u.chain)([(0,u.chain)(On,(0,u.optional)(_e))(function(e){return{type:"identifier",variant:"table",name:e[0],alias:e[1]}}),(0,u.chain)([be,(0,u.chain)("(",be,")")(function(e){return e[1]})],_e)(function(e){return j()(j()({},e[0]),{},{alias:e[1]})})])(function(e){return e[0]})},Ea=function(){return(0,u.chain)(["join","straight_join",(0,u.chain)(["inner","cross","full"],"join")(),(0,u.chain)(["left","right"],(0,u.optional)("outer"),"join")(),(0,u.chain)("natural",(0,u.optional)(["left","right"],(0,u.optional)("outer")),"join")()],qe,(0,u.optional)("on",oe))(function(e){return{type:"statement",variant:"join",join:e[1],conditions:e[2]}})},_e=function(){return(0,u.chain)([(0,u.chain)("as",ve)(function(e){return e[1]}),ve])(function(e){return e[0]})},ka=function(){return(0,u.chain)("create","table",ve,"(",ja,")",(0,u.optional)(wa))()},wa=function(){return(0,u.chain)("with","(",Ta,")")()},Ta=function(){return(0,u.chain)(jn,(0,u.many)(",",jn))()},jn=function(){return(0,u.chain)(x,"=",J)()},ja=function(){return(0,u.chain)(Nn,(0,u.many)(",",Nn))()},Nn=function(){return(0,u.chain)(ve,yn)()},Xi=function o(){return chain(wordSym,optional(",",o))()},On=function(){return(0,u.chain)([(0,u.chain)(ve)(),(0,u.chain)(ve,".",ve)(function(e){return[e[0],e[2]]})])(function(e){if(e[0].length===1)return Sn({namespace:"",tableName:e[0][0]});if(e[0].length===2)return Sn({namespace:e[0][0],tableName:e[0][1]})})},Na=function(){return(0,u.chain)("having",oe)()},Oa=function(){return(0,u.chain)("create","view",x,"as",be)()},Fa=function(){return(0,u.chain)("insert",(0,u.optional)("ignore"),"into",On,(0,u.optional)(Pa),[be])(function(e){return{type:"statement",variant:"insert",into:{type:"indentifier",variant:"table",name:e[3]},result:e[5]}})},Pa=function(){return(0,u.chain)("(",Ma,")")()},Ma=function(){return(0,u.chain)(x,(0,u.many)(",",x))()},Ia=function(){return(0,u.chain)("group","by",wn)()},Fn=function(){return(0,u.chain)("order","by",La)()},La=function(){return(0,u.chain)(Pn,(0,u.many)(",",Pn))()},Pn=function(){return(0,u.chain)(oe,(0,u.optional)(["asc","desc"]))()},$a=function(){return(0,u.chain)([x,(0,u.chain)("partition","by",oe)()])(function(e){return e})},Aa=function(){return(0,u.chain)("over","(",Ra,")")()},Ra=function o(){return(0,u.chain)([$a,(0,u.chain)(Y,Fn)()],(0,u.many)(",",o))()},Za=function(){return(0,u.chain)("limit",[ne,(0,u.chain)(ne,",",ne)(),(0,u.chain)(ne,"offset",ne)()])()},Da=function(){return(0,u.chain)([Ha,Mn,za])(function(e){return e[0]})},za=function(){return(0,u.chain)("if","(",Me,",",Y,",",Y,")")(function(e){return{type:"function",name:"if",args:[e[2],e[4],e[6]]}})},Ha=function(){return(0,u.chain)("cast","(",Y,"as",yn,")")(function(e){return{type:"function",name:"cast",args:[e[2],e[4]]}})},Mn=function(){return(0,u.chain)(x,"(",(0,u.optional)(Va),")",(0,u.optional)("filter","(",Pe,")"))(function(e){return{type:"function",name:e[0],args:e[2]}})},Va=function(){return(0,u.chain)(In,(0,u.many)(",",In))()},In=function(){return(0,u.chain)((0,u.many)(ma),[ue,Ln])(function(e){return e})},Ln=function(){return(0,u.chain)("case",(0,u.plus)(xa),(0,u.optional)("else",[ue,"null"]),["end",(0,u.chain)("end","as",x)()])()},xa=function(){return(0,u.chain)("when",oe,"then",Rn)()},Wa=function(){return(0,u.chain)("set",Qa)()},Qa=function(){return(0,u.chain)($n,(0,u.many)(",",$n))()},$n=function(){return(0,u.chain)(Ua,"=",["true","false",J,ne])()},Ua=function(){return(0,u.chain)(x,(0,u.many)(".",x))()},oe=function o(){return(0,u.chain)(Ba,(0,u.many)(la,o))(Se)},Ba=function(){return(0,u.chain)([(0,u.chain)("(",oe,")")(),(0,u.chain)(fa,oe)(),(0,u.chain)(Ja)],(0,u.optional)((0,u.chain)("is",(0,u.optional)("not"),["true","false","unknown"])()))(function(e){return e[0]})},Ja=function(){return(0,u.chain)(Me,(0,u.many)(["isnull",(0,u.chain)([(0,u.chain)("is","not")(),"is","not"],["null",ue])()]))(Se)},Me=function o(){return(0,u.chain)([(0,u.chain)(ue,An)(),(0,u.chain)("(",o,")",An)()])()},An=function(){return(0,u.chain)((0,u.optional)([(0,u.chain)(da,ue)(),(0,u.chain)("sounds","like",ue)(),Ya]),(0,u.optional)(["or",Me]))()},ue=function(){return(0,u.chain)(Y)(function(e){return{type:"identifier",variant:"column",name:e[0]}})},Ya=function(){return(0,u.chain)((0,u.optional)("is"),(0,u.optional)("not"),[(0,u.chain)("in","(",[be,wn],")")(),(0,u.chain)("between",Y,"and",Me)(),(0,u.chain)("like",Y,(0,u.optional)("escape",Y))(),(0,u.chain)("regexp",Y)(),"null"])()},Rn=function(){return(0,u.chain)(Zn,(0,u.many)(ca,Zn))(function(e){return e[1]?[e[0],e[1]]:e[0]})},Zn=function(){return(0,u.chain)([Da,Ln,(0,u.chain)(ua,(0,u.optional)([(0,u.chain)(".","*")(function(e){return{type:"identifier",variant:"groupAll"}}),(0,u.chain)(":",Mn)(),Ga]))(function(e){return e[1]?j()(j()({},e[1]),{},{groupName:e[0]}):e[0]}),"*"])(function(e){return e[0]})},Ga=function(){return(0,u.chain)(".",[J,ne,(0,u.chain)(x)(function(e){return{type:"identifier",variant:"columnAfterGroup",name:e[0]}})])(function(e){return e[1]})},Y=function(){return aa(Rn)()},Ka=function(){return(0,u.chain)("create","index",Xa,qa,Pe)()},Xa=function(){return(0,u.chain)(J,(0,u.many)(".",J))()},qa=function(){return(0,u.chain)("ON",J,"(",_a,")")()},Dn=function(){return(0,u.chain)(J,(0,u.optional)(["ASC","DESC"]))()},_a=function(){return(0,u.chain)(Dn,(0,u.many)(",",Dn))()},ei=function(){return(0,u.chain)("create","function",x,"as",J)()},ni=function(){return(0,u.chain)("UPDATE",qe,"SET",oa,(0,u.optional)(Pe))()},ti=(0,u.createParser)(pa,ra,{cursorTokenExcludes:function(e){return(e==null?void 0:e.value)==="."||(e==null?void 0:e.value)===":"}}),zn="sql",ri=" $.:{}=abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),en=function(e,t){return ti(e.getValue(),e.getOffsetAt(t))},ai=function(){return{suggestions:[]}},ii=function(e){return e.filter(function(t){return t.type==="string"}).map(function(t){var r=/[a-zA-Z]+/.test(t.value.toString())?Yr.Z(t.value.toString()):t.value.toString();return{label:r,insertText:r,documentation:"documentation",detail:"detail",kind:R.Mj.CompletionItemKind.Keyword,sortText:"W".concat(t.value)}})};R.Mj.registerCompletionItemProvider(zn,{triggerCharacters:ri,provideCompletionItems:function(){var o=y()(f()().mark(function e(t,r){var n,i,a,s,c,l,p,d;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(n=en(t,r),n){v.next=3;break}return v.abrupt("return",ai());case 3:return v.next=5,xe(n.ast,n.cursorKeyPath);case 5:if(i=v.sent,a=ii(n.nextMatchings),i){v.next=9;break}return v.abrupt("return",{suggestions:a});case 9:v.t0=i.type,v.next=v.t0==="tableField"?12:v.t0==="tableFieldAfterGroup"?20:v.t0==="tableName"?24:v.t0==="functionName"?28:29;break;case 12:return v.next=14,Ue(n.ast,n.cursorKeyPath,Oe);case 14:return s=v.sent,c=Gr.Z(s.filter(function(T){return T.groupPickerName!==null}),"groupPickerName"),v.next=18,pn(i.token.value);case 18:return l=v.sent,v.abrupt("return",{suggestions:s.concat(a).concat(l).concat(c?Object.keys(c).map(function(T){return Xr(T)}):[])});case 20:return v.next=22,Ue(n.ast,n.cursorKeyPath,Oe);case 22:return p=v.sent,v.abrupt("return",{suggestions:p.filter(function(T){return T.groupPickerName===i.groupName}).concat(a)});case 24:return v.next=26,Kr(i);case 26:return d=v.sent,v.abrupt("return",{suggestions:d.concat(a)});case 28:return v.abrupt("return",{suggestions:pn(i.token.value)});case 29:return v.abrupt("return",{suggestions:a});case 30:case"end":return v.stop()}},e)}));return function(t,r){return o.apply(this,arguments)}}()}),R.Mj.registerHoverProvider(zn,{provideHover:function(){var o=y()(f()().mark(function t(r,n){var i,a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(i=en(r,n),i){d.next=3;break}return d.abrupt("return",null);case 3:return d.next=5,xe(i.ast,i.cursorKeyPath);case 5:if(a=d.sent,a){d.next=8;break}return d.abrupt("return",null);case 8:s=[],d.t0=a.type,d.next=d.t0==="tableField"?12:d.t0==="tableFieldAfterGroup"?19:d.t0==="tableName"?26:d.t0==="functionName"?30:34;break;case 12:return d.next=14,bn(i.ast,a,Oe,i.cursorKeyPath);case 14:return c=d.sent,d.next=17,hn(a.token.value,c);case 17:return s=d.sent,d.abrupt("break",34);case 19:return d.next=21,bn(i.ast,a,Oe,i.cursorKeyPath);case 21:return l=d.sent,d.next=24,hn(a.token.value,l);case 24:return s=d.sent,d.abrupt("break",34);case 26:return d.next=28,qr(a);case 28:return s=d.sent,d.abrupt("break",34);case 30:return d.next=32,_r(a.token.value);case 32:return s=d.sent,d.abrupt("break",34);case 34:return d.abrupt("return",{range:R.e6.fromPositions(r.getPositionAt(a.token.position[0]),r.getPositionAt(a.token.position[1]+1)),contents:s});case 35:case"end":return d.stop()}},t)}));function e(t,r){return o.apply(this,arguments)}return e}()});var Hn=m(98609);R.Mj.registerDocumentFormattingEditProvider("sql",{provideDocumentFormattingEdits:function(e){var t=(0,Hn.WU)(e.getValue());return[{range:e.getFullModelRange(),text:t}]}}),R.Mj.registerDocumentRangeFormattingEditProvider("sql",{provideDocumentRangeFormattingEdits:function(e,t){var r=(0,Hn.WU)(e.getValueInRange(t));return[{range:t,text:r}]}});var oi=function(){function o(e){var t=this;D()(this,o),h()(this,"editorReadyDeferred",new Br.B),h()(this,"editorReady",this.editorReadyDeferred.promise),h()(this,"editorHost",void 0),h()(this,"_model",void 0),h()(this,"_uuid",""),h()(this,"_config",void 0),h()(this,"_isDisposed",!1),h()(this,"toDispose",new Jr.K),h()(this,"oldDeltaDecorations",[]),h()(this,"modalChangeEmitter",new fn.Q5),h()(this,"monacoEditor",void 0),h()(this,"host",void 0),h()(this,"editorState",void 0),h()(this,"setOption",function(r,n){if(n!=null){var i=["fontFamily","fontSize","lineHeight","wordWrapColumn","lineWrap"],a=i.concat(["readOnly","insertSpaces","tabSize"]);if(a.includes(r)){var s;t._config=j()(j()({},t._config),{},h()({},r,n)),(s=t.monacoEditor)===null||s===void 0||s.updateOptions(t.toMonacoOptions(t._config))}i.includes(r)&&t.updateEditorSize()}}),h()(this,"getLine",function(r){var n;return(n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getLineContent(r)}),h()(this,"getOffsetAt",function(r){var n;return((n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getOffsetAt({lineNumber:r.line,column:r.column}))||0}),h()(this,"undo",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.trigger("source","undo",{})}),h()(this,"redo",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.trigger("source","redo",{})}),h()(this,"focus",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.focus()}),h()(this,"hasFocus",function(){var r,n;return(r=(n=t.monacoEditor)===null||n===void 0?void 0:n.hasWidgetFocus())!==null&&r!==void 0?r:!1}),h()(this,"blur",function(){document.documentElement.focus()}),h()(this,"resizeToFit",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.layout()}),h()(this,"getPositionForCoordinate",function(r){return null}),h()(this,"getCursorPosition",function(){var r,n,i={line:((r=t.monacoEditor)===null||r===void 0||(r=r.getPosition())===null||r===void 0?void 0:r.lineNumber)||1,column:((n=t.monacoEditor)===null||n===void 0||(n=n.getPosition())===null||n===void 0?void 0:n.column)||1};return i}),h()(this,"setCursorPosition",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.setPosition({column:r.column,lineNumber:r.line})}),h()(this,"getSelection",function(){var r,n,i,a,s={start:{line:((r=t.monacoEditor)===null||r===void 0||(r=r.getSelection())===null||r===void 0?void 0:r.startLineNumber)||1,column:((n=t.monacoEditor)===null||n===void 0||(n=n.getSelection())===null||n===void 0?void 0:n.startColumn)||1},end:{line:((i=t.monacoEditor)===null||i===void 0||(i=i.getSelection())===null||i===void 0?void 0:i.endLineNumber)||1,column:((a=t.monacoEditor)===null||a===void 0||(a=a.getSelection())===null||a===void 0?void 0:a.endColumn)||1}};return s}),h()(this,"setSelection",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.setSelection(t.toMonacoRange(r))}),h()(this,"getSelections",function(){var r,n=[];return(r=t.monacoEditor)===null||r===void 0||(r=r.getSelections())===null||r===void 0||r.map(function(i){return n.push({start:{line:i.startLineNumber||1,column:i.startColumn||1},end:{line:i.endLineNumber||1,column:i.endColumn||1}})}),n}),h()(this,"setSelections",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.setSelections(r.map(function(i){return new R.Y1(i.start.line,i.start.column,i.end.line,i.end.column)}))}),h()(this,"revealSelection",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.revealRange(t.toMonacoRange(r))}),h()(this,"getSelectionValue",function(r){var n,i=r!=null?r:t.getSelection();return(n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getValueInRange(t.toMonacoRange(i))}),h()(this,"replaceSelection",function(r,n){var i,a;(i=t.monacoEditor)===null||i===void 0||i.executeEdits(void 0,[{range:t.toMonacoRange(n),text:r}]),(a=t.monacoEditor)===null||a===void 0||a.pushUndoStop()}),h()(this,"replaceSelections",function(r){var n,i;(n=t.monacoEditor)===null||n===void 0||n.executeEdits(void 0,r.map(function(a){return{range:t.toMonacoRange(a.range),text:a.text}})),(i=t.monacoEditor)===null||i===void 0||i.pushUndoStop()}),h()(this,"getPositionAt",function(r){var n,i=(n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getPositionAt(r);return i&&{line:i.lineNumber,column:i.column}}),h()(this,"highlightMatches",function(r,n){var i,a,s=r.map(function(p,d){return d===n?(a=p,{range:p,options:{className:"currentFindMatch"}}):{range:p,options:{className:"findMatch"}}}).map(function(p){return j()(j()({},p),{},{range:t.toMonacoMatch(p.range).range})});if(t.oldDeltaDecorations=((i=t.monacoEditor)===null||i===void 0?void 0:i.deltaDecorations(t.oldDeltaDecorations,s))||[],a){var c=t.getPositionAt(a.position),l=t.getPositionAt(a.position+a.text.length);c&&l&&t.revealSelection({end:l,start:c})}}),this.host=e.host,this._model=e.model,this._uuid=e.uuid||(0,F.Vj)(),this._config=j()({},e.config),this.editorHost=document.createElement("div"),this.host.append(this.editorHost),this.createEditor(this.editorHost),this.checkSyntaxError(),this.toDispose.push((0,$.YP)(this._model,"selections",this.onSelectionChange))}return z()(o,[{key:"uuid",get:function(){return this._uuid},set:function(t){this._uuid=t}},{key:"model",get:function(){return this._model}},{key:"config",get:function(){return this._config}},{key:"lineCount",get:function(){var t;return((t=this.monacoEditor)===null||t===void 0||(t=t.getModel())===null||t===void 0?void 0:t.getLineCount())||0}},{key:"disposed",get:function(){return this._isDisposed}},{key:"onModalChange",get:function(){return this.modalChangeEmitter.event}},{key:"createEditor",value:function(){var e=y()(f()().mark(function r(n){var i,a,s=this,c,l,p,d;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:this.monacoEditor=R.j6.create(n,j()({value:this.model.value,language:"sql"},this.toMonacoOptions(this._config))),this.toDispose.push((i=(a=this.monacoEditor)===null||a===void 0?void 0:a.onDidChangeModelContent(function(){var T,k=(T=s.monacoEditor)===null||T===void 0?void 0:T.getValue();k&&(s.model.value=k,s.updateEditorSize())}))!==null&&i!==void 0?i:ze.J.NONE),this.toDispose.push((c=(l=this.monacoEditor)===null||l===void 0?void 0:l.onDidContentSizeChange(function(){s.updateEditorSize()}))!==null&&c!==void 0?c:ze.J.NONE),this.toDispose.push((p=(d=this.monacoEditor)===null||d===void 0?void 0:d.onDidBlurEditorText(function(){s.blur()}))!==null&&p!==void 0?p:ze.J.NONE),this.updateEditorSize(),this.editorReadyDeferred.resolve();case 6:case"end":return v.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"checkSyntaxError",value:function(){var t,r=this;(t=this.monacoEditor)===null||t===void 0||t.onDidChangeModelContent(function(){var n,i,a=(n=r.monacoEditor)===null||n===void 0?void 0:n.getModel(),s=(i=r.monacoEditor)===null||i===void 0?void 0:i.getPosition();if(!(!a||!s)){var c=en(a,s);if(c)if(c.error){var l=c.error.reason==="incomplete"?`Incomplete, expect next input: 
`.concat(c.error.suggestions.map(function(d){return d.value}).join(`
`)):`Wrong input, expect: 
`.concat(c.error.suggestions.map(function(d){return d.value}).join(`
`)),p=c.error.token?{startLineNumber:a.getPositionAt(c.error.token.position[0]).lineNumber,startColumn:a.getPositionAt(c.error.token.position[0]).column,endLineNumber:a.getPositionAt(c.error.token.position[1]).lineNumber,endColumn:a.getPositionAt(c.error.token.position[1]).column+1}:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0};R.j6.setModelMarkers(a,"sql",[j()(j()({},p),{},{message:l,severity:R.ZL.Error})])}else R.j6.setModelMarkers(a,"sql",[])}})}},{key:"toMonacoOptions",value:function(t){var r,n,i,a,s,c,l;return{minimap:{enabled:!1},lineHeight:(r=t.lineHeight)!==null&&r!==void 0?r:20,fontSize:(n=t.fontSize)!==null&&n!==void 0?n:13,lineNumbers:t.lineNumbers?"on":"off",folding:(i=t.codeFolding)!==null&&i!==void 0?i:!0,wordWrap:(a=t.lineWrap)!==null&&a!==void 0?a:"off",lineDecorationsWidth:15,lineNumbersMinChars:3,suggestSelection:"first",wordBasedSuggestions:"currentDocument",scrollBeyondLastLine:!1,fixedOverflowWidgets:!0,suggest:{snippetsPreventQuickSuggestions:!1},autoClosingQuotes:t.autoClosingBrackets?"always":"never",autoDetectHighContrast:!1,scrollbar:{alwaysConsumeMouseWheel:!1,verticalScrollbarSize:0},extraEditorClassName:"sql-editor",renderLineHighlight:"all",renderLineHighlightOnlyWhenFocus:!0,readOnly:t.readOnly,cursorWidth:1,tabSize:(s=t.tabSize)!==null&&s!==void 0?s:4,insertSpaces:(c=t.insertSpaces)!==null&&c!==void 0?c:!0,matchBrackets:t.matchBrackets?"always":"never",rulers:(l=t.rulers)!==null&&l!==void 0?l:[],wordWrapColumn:t.wordWrapColumn||80}}},{key:"getState",value:function(){var t=this.getCursorPosition(),r=this.getSelections();return j()(j()({},this.editorState),{},{cursorPosition:t,selections:r})}},{key:"updateEditorSize",value:function(){var t,r,n=(t=(r=this.monacoEditor)===null||r===void 0?void 0:r.getContentHeight())!==null&&t!==void 0?t:20;this.host.style.height="".concat(n+30,"px");try{var i;(i=this.monacoEditor)===null||i===void 0||i.layout({width:this.host.offsetWidth,height:n})}catch(a){}}},{key:"toMonacoRange",value:function(t){var r=t!=null?t:this.getSelection(),n={startLineNumber:r.start.line||1,startColumn:r.start.column||1,endLineNumber:r.end.line||1,endColumn:r.end.column||1};return n}},{key:"onSelectionChange",value:function(){this.setSelections(this.model.selections)}},{key:"toMonacoMatch",value:function(t){var r,n,i,a,s=this.getPositionAt(t.position),c=this.getPositionAt(t.position+t.text.length);return{range:new R.e6((r=s==null?void 0:s.line)!==null&&r!==void 0?r:1,(n=s==null?void 0:s.column)!==null&&n!==void 0?n:1,(i=c==null?void 0:c.line)!==null&&i!==void 0?i:1,(a=c==null?void 0:c.column)!==null&&a!==void 0?a:1),matches:[t.text],_findMatchBrand:void 0}}},{key:"getOption",value:function(t){return this._config[t]}},{key:"dispose",value:function(){this.disposed||(this.toDispose.dispose(),this._isDisposed=!0)}}]),o}(),Vn,xn,Wn,Qn,Un,G,Bn=(Vn=(0,O.H3)(),xn=(0,ie.ei)("libro-sql-output-area"),Wn=function(e,t){return(0,O.f3)(me.Hj)(e,void 0,0)},Qn=Reflect.metadata("design:type",Function),Un=Reflect.metadata("design:paramtypes",[typeof IOutputAreaOption=="undefined"?Object:IOutputAreaOption]),Vn(G=xn(G=Wn(G=Qn(G=Un(G=function(o){de()(t,o);var e=fe()(t);function t(r){var n;return D()(this,t),n=e.call(this,r),n.handleMsg(),n}return z()(t,[{key:"handleMsg",value:function(){var n=this,i=this.cell.model;i.msgChange(function(a){if(a.header.msg_type!=="status"&&((0,E.t3d)(a)||(0,E.HXF)(a)||(0,E.aL4)(a)||(0,E.fkE)(a))){var s=j()(j()({},a.content),{},{output_type:a.header.msg_type});n.add(s)}})}}]),t}(E.fZS))||G)||G)||G)||G)||G),g=m(31549),ui=function(e){var t=e.model,r=t.data["application/vnd.libro.sql+json"];return r?(0,g.jsxs)("div",{className:"sql-output-render libro-html-common-render",children:[(0,g.jsxs)("table",{border:1,className:"dataframe",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{style:{textAlign:"right"},children:[(0,g.jsx)("th",{}),r.columns.map(function(n){return(0,g.jsx)("th",{children:n},n)})]})}),(0,g.jsx)("tbody",{children:r.rows.map(function(n,i){return(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:i}),n.map(function(a){return(0,g.jsx)("td",{children:a},a)})]},i)})})]}),(0,g.jsxs)("p",{children:[r.rows.length," rows \xD7 ",r.columns.length," columns"]})]}):null},Jn,Yn,si=(Jn=(0,O.ri)({contrib:E.VCh}),Jn(Yn=z()(function o(){D()(this,o),h()(this,"canHandle",function(){return 100}),h()(this,"renderType","SQLOutputRender"),h()(this,"safe",!0),h()(this,"mimeTypes",["application/vnd.libro.sql+json"]),h()(this,"render",ui)}))||Yn),Ie=m(3988),Gn,Kn,Le=(Gn=(0,O.ri)(),Gn(Kn=function(){function o(){D()(this,o)}return z()(o,[{key:"query",value:function(){var e=y()(f()().mark(function r(n){var i=this,a,s,c;return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"query",project_id:this.getProjectId(),query:n})});case 2:if(a=p.sent,s=[],c=[],!a){p.next=8;break}return a.forEach(function(d){s.push(d.name),c.push(i.getRowValue(d))}),p.abrupt("return",{columns:s,rows:(0,F.p4)(c)});case 8:return p.abrupt("return",{columns:s,rows:c});case 9:case"end":return p.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getRowValue",value:function(t){for(var r=["int32_data","int64_data","float_data","double_data","bool_data","string_data"],n=0;n<r.length;n++){var i=r[n];if(t[i]&&t[i].length>0)return t[i]}return[]}},{key:"getProjectId",value:function(){var t=Ie.m8.location.pathname.split("/");return t[t.length-1]}}]),o}())||Kn),Xn,qn,_n,et,nt,tt,rt,at,it,ot,ut,st,lt,L,$e,ct,dt,ft=(0,ee.forwardRef)(function(o,e){var t=(0,$.oC)(me.yd);return(0,g.jsx)("div",{tabIndex:10,ref:e,className:t.className,onFocus:function(){t.focus(!0)},onBlur:function(n){var i;typeof e!="function"&&!(e!=null&&(i=e.current)!==null&&i!==void 0&&i.contains(n.relatedTarget))&&t.blur()},children:(0,g.jsx)(E.sUT,{})})});ft.displayName="SqlCellComponent";var mt=(Xn=(0,O.H3)(),qn=(0,ie.ei)("sql-cell-view"),_n=function(e,t){return(0,O.f3)(me.Hj)(e,void 0,0)},et=function(e,t){return(0,O.f3)(E.xxA)(e,void 0,1)},nt=function(e,t){return(0,O.f3)(De.v)(e,void 0,2)},tt=function(e,t){return(0,O.f3)(Le)(e,void 0,3)},rt=function(e,t){return(0,O.f3)(ge.H)(e,void 0,4)},at=Reflect.metadata("design:type",Function),it=Reflect.metadata("design:paramtypes",[typeof CellViewOptions=="undefined"?Object:CellViewOptions,typeof E.xxA=="undefined"?Object:E.xxA,typeof De.v=="undefined"?Object:De.v,typeof Le=="undefined"?Object:Le,typeof ge.H=="undefined"?Object:ge.H]),ot=(0,$.vg)(),ut=Reflect.metadata("design:type",Array),st=(0,$.vg)(),lt=Reflect.metadata("design:type",typeof E.a7s=="undefined"?Object:E.a7s),Xn(L=qn(L=_n(L=et(L=nt(L=tt(L=rt(L=at(L=it(L=($e=function(o){de()(t,o);var e=fe()(t);function t(r,n,i,a,s){var c,l;return D()(this,t),l=e.call(this,r,n),h()(C()(l),"view",ft),h()(C()(l),"queryService",void 0),h()(C()(l),"viewManager",void 0),h()(C()(l),"commandRegistry",void 0),q()(C()(l),"outputs",ct,C()(l)),q()(C()(l),"editorView",dt,C()(l)),h()(C()(l),"onViewMount",y()(f()().mark(function p(){return f()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,l.createEditor();case 2:case"end":return b.stop()}},p)}))),h()(C()(l),"clearExecution",function(){l.cellModel.clearExecution(),Promise.resolve().then(function(){l.outputArea.clear()}).catch(console.error)}),l.options=r,l.queryService=a,l.viewManager=i,l.commandRegistry=s,l.outputs=((c=r.cell)===null||c===void 0?void 0:c.outputs)||[],l.className=l.className+" sql-editor-container",l.viewManager.getOrCreateView(Bn,{outputAreaId:l.id,cellId:l.id,cell:C()(l)}).then(function(){var p=y()(f()().mark(function d(b){var v;return f()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(l.outputArea=b,v=l.outputs,!(0,E.RWJ)(v)){k.next=5;break}return k.next=5,l.outputArea.fromJSON(v);case 5:return l.outputWatch(),k.abrupt("return");case 7:case"end":return k.stop()}},d)}));return function(d){return p.apply(this,arguments)}}()).catch(function(){}),l}return z()(t,[{key:"cellModel",get:function(){return this.model}},{key:"toJSON",value:function(){var n,i,a=cn()(dn()(t.prototype),"toJSON",this).call(this);return j()(j()({},a),{},{outputs:(n=(i=this.outputArea)===null||i===void 0?void 0:i.toJSON())!==null&&n!==void 0?n:this.outputs})}},{key:"createEditor",value:function(){var n=this,i={uuid:this.options.uuid,factory:function(s){return new oi(s)},model:this.cellModel,config:{readOnly:this.parent.model.readOnly,editable:!this.parent.model.readOnly}};return this.viewManager.getOrCreateView(E.a7s,i).then(function(){var a=y()(f()().mark(function s(c){return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n.editorView=c,p.next=3,c.editor.editorReady;case 3:return n.handleCommand(),p.abrupt("return");case 5:case"end":return p.stop()}},s)}));return function(s){return a.apply(this,arguments)}}()).catch(function(){})}},{key:"handleCommand",value:function(){var n,i=this,a=(n=this.editorView)===null||n===void 0||(n=n.editor)===null||n===void 0?void 0:n.monacoEditor;a&&(a.addCommand(9,function(){i.commandRegistry.executeCommand(E.NzD.EnterCommandMode.id)},"!editorHasSelection && !editorHasSelection && !editorHasMultipleSelections"),a.addCommand(2051,function(){i.commandRegistry.executeCommand(E.NzD.RunCell.id)},"!findWidgetVisible && !referenceSearchVisible"),a.addCommand(1027,function(){i.commandRegistry.executeCommand(E.NzD.RunCellAndSelectNext.id)},"!findInputFocussed"),a.addCommand(515,function(){i.commandRegistry.executeCommand(E.NzD.RunCellAndInsertBelow.id)},"!findWidgetVisible"),a.addCommand(3155,function(){i.commandRegistry.executeCommand(E.NzD.SplitCellAntCursor.id)}),a.addCommand(2084,function(){i.commandRegistry.executeCommand("libro-search:toggle")}))}},{key:"run",value:function(){var r=y()(f()().mark(function i(){var a,s,c,l,p,d;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=new Date().toISOString(),this.clearExecution(),this.setExecutionStatus(!0,!0),this.setExecutionTime(a,""),this.cellModel.executeCount=1,v.prev=5,v.next=8,this.queryService.query(this.cellModel.value);case 8:s=v.sent,c={header:{msg_type:"execute_result",date:"",msg_id:"",session:"",username:"",version:""},metadata:{},content:{data:{"application/vnd.libro.sql+json":s},metadata:{},execution_count:1},buffers:[],channel:"iopub",parent_header:{}},this.cellModel.msgChangeEmitter.fire(c),v.next=16;break;case 13:v.prev=13,v.t0=v.catch(5),v.t0 instanceof Error&&(l=v.t0.message,p=l.split(`
`),p.length>0&&(d={header:{msg_type:"error",date:"",msg_id:"",session:"",username:"",version:""},metadata:{},content:{traceback:p.slice(1),ename:"ExecuteQueryException",evalue:p[0]},buffers:[],channel:"iopub",parent_header:{}},this.cellModel.msgChangeEmitter.fire(d)));case 16:return this.setExecutionStatus(!1,!1),this.setExecutionTime(a,new Date().toISOString()),v.abrupt("return",!0);case 19:case"end":return v.stop()}},i,this,[[5,13]])}));function n(){return r.apply(this,arguments)}return n}()},{key:"setExecutionStatus",value:function(n,i){this.cellModel.executing=n,this.cellModel.kernelExecuting=i}},{key:"setExecutionTime",value:function(n,i){var a=this.cellModel.metadata.execution;a&&(a["shell.execute_reply.started"]=n,a.to_execute=n,a["shell.execute_reply.end"]=i)}},{key:"calcEditorAreaHeight",value:function(){return 0}},{key:"focus",value:function(n){n&&(this.cellModel.isEdit=!0)}},{key:"blur",value:function(){this.cellModel.isEdit=!1}},{key:"shouldEnterEditorMode",value:function(){return this.cellModel.isEdit}}]),t}(E.XCr),ct=_()($e.prototype,"outputs",[ot,ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dt=_()($e.prototype,"editorView",[st,lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e))||L)||L)||L)||L)||L)||L)||L)||L)||L),vt,pt,ht,gt,se,li=(vt=(0,O.ri)({contrib:[E.SqL,E.GDy]}),pt=function(e,t){return(0,O.f3)(Te)(e,void 0,0)},ht=Reflect.metadata("design:type",Function),gt=Reflect.metadata("design:paramtypes",[typeof Te=="undefined"?Object:Te]),vt(se=pt(se=ht(se=gt(se=function(){function o(e){D()(this,o),h()(this,"modelFactory",void 0),h()(this,"cellMeta",{type:"code",name:"SQL",nbformatType:"code",order:"a"}),h()(this,"view",mt),this.modelFactory=e}return z()(o,[{key:"canHandle",value:function(t,r){return r===this.cellMeta.type?3e3:-1}},{key:"createModel",value:function(){var e=y()(f()().mark(function r(n){var i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=this.modelFactory(n),s.abrupt("return",i);case 2:case"end":return s.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()}]),o}())||se)||se)||se)||se),bt,yt,Ct,St,Et,kt,wt,Tt,jt,Nt,Ot,le,pe,Ft,Pt,Mt,It,Lt,$t=(bt=(0,O.H3)(),yt=function(e,t){return(0,O.f3)(E.seq)(e,void 0,0)},Ct=Reflect.metadata("design:type",Function),St=Reflect.metadata("design:paramtypes",[typeof E.seq=="undefined"?Object:E.seq]),Et=(0,$.vg)(),kt=Reflect.metadata("design:type",typeof Partial=="undefined"?Object:Partial),wt=(0,$.vg)(),Tt=(0,$.vg)(),jt=(0,$.vg)(),Nt=Reflect.metadata("design:type",typeof ExecutionCount=="undefined"?Object:ExecutionCount),Ot=(0,$.vg)(),bt(le=yt(le=Ct(le=St(le=(pe=function(o){de()(t,o);var e=fe()(t);function t(r){var n;return D()(this,t),n=e.call(this,r),h()(C()(n),"mimeType","application/vnd.libro.sql+json"),h()(C()(n),"hasOutputHidden",!1),h()(C()(n),"hasOutputsScrolled",!1),q()(C()(n),"metadata",Ft,C()(n)),q()(C()(n),"executing",Pt,C()(n)),q()(C()(n),"kernelExecuting",Mt,C()(n)),q()(C()(n),"executeCount",It,C()(n)),q()(C()(n),"isEdit",Lt,C()(n)),h()(C()(n),"msgChangeEmitter",new fn.Q5),h()(C()(n),"msgChange",n.msgChangeEmitter.event),h()(C()(n),"clearExecution",function(){n.executeCount=null,n.executing=!1,n.kernelExecuting=!1,n.clearExecutionMetadata()}),h()(C()(n),"clearExecutionMetadata",function(){n.metadata.execution={"shell.execute_reply.started":"","shell.execute_reply.end":"",to_execute:""}}),n.metadata=r.cell.metadata||{},n}return z()(t,[{key:"dispose",value:function(){cn()(dn()(t.prototype),"dispose",this).call(this),this.msgChangeEmitter.dispose()}}]),t}(E.KZ9),Ft=_()(pe.prototype,"metadata",[Et,kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt=_()(pe.prototype,"executing",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt=_()(pe.prototype,"kernelExecuting",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It=_()(pe.prototype,"executeCount",[jt,Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lt=_()(pe.prototype,"isEdit",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pe))||le)||le)||le)||le),ci=m(63011),At,Rt,di=(At=(0,O.ri)({contrib:E.Vij}),At(Rt=function(){function o(){D()(this,o),h()(this,"canHandle",function(){return 3})}return z()(o,[{key:"loadContent",value:function(){var e=y()(f()().mark(function r(n,i){var a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return a=i,s=new ci.o(n.resource),c=s.path.toString(),d.next=5,a.contentsManager.get(c);case 5:if(l=d.sent,!l){d.next=10;break}return l.content.nbformat_minor=5,a.currentFileContents=l,d.abrupt("return",a.currentFileContents.content);case 10:case"end":return d.stop()}},r)}));function t(r,n){return e.apply(this,arguments)}return t}()}]),o}())||Rt),ye=m(15306),fi=m(7146),Zt,Dt,zt,Ht,Vt,xt,U,mi=(Zt=(0,O.H3)(),Dt=function(e,t){return(0,O.f3)(E.QY6)(e,void 0,0)},zt=function(e,t){return(0,O.f3)(ye.Z)(e,void 0,1)},Ht=function(e,t){return(0,O.f3)(ge.H)(e,void 0,2)},Vt=Reflect.metadata("design:type",Function),xt=Reflect.metadata("design:paramtypes",[typeof E.QY6=="undefined"?Object:E.QY6,typeof ye.Z=="undefined"?Object:ye.Z,typeof ge.H=="undefined"?Object:ge.H]),Zt(U=Dt(U=zt(U=Ht(U=Vt(U=xt(U=function(o){de()(t,o);var e=fe()(t);function t(r,n,i){var a;return D()(this,t),a=e.call(this),h()(C()(a),"modalService",void 0),h()(C()(a),"commandRegistry",void 0),h()(C()(a),"currentFileContents",void 0),h()(C()(a),"contentsManager",void 0),h()(C()(a),"kernelConnection",!0),h()(C()(a),"kernelConnecting",!1),h()(C()(a),"lspEnabled",!1),h()(C()(a),"autoSave",(0,fi.Z)(function(){a.commandRegistry.executeCommand(E.Xa6.Save.id)},500)),a.contentsManager=r,a.modalService=n,a.commandRegistry=i,a.onChanged(a.autoSave.bind(C()(a))),a}return z()(t,[{key:"isKernelIdle",get:function(){return!0}},{key:"saveNotebookContent",value:function(){var r=y()(f()().mark(function i(){var a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(a=this.toJSON(),this.currentFileContents){d.next=3;break}throw new Error("currentFileContents is undefined");case 3:return d.prev=3,d.next=6,this.contentsManager.save(this.currentFileContents.path,{type:this.currentFileContents.type,content:a,format:this.currentFileContents.format,baseUrl:(0,F.Ue)()});case 6:if(s=d.sent,s){d.next=9;break}return d.abrupt("return");case 9:if(!(s.last_modified===this.currentFileContents.last_modified||s.size===0)){d.next=13;break}throw l="File Save Error: ".concat((c=s)===null||c===void 0?void 0:c.message),this.modalService.openModal(E.l6J),new Error(l);case 13:d.next=21;break;case 15:if(d.prev=15,d.t0=d.catch(3),s){d.next=19;break}return d.abrupt("return");case 19:throw this.modalService.openModal(E.l6J),new Error("File Save Error");case 21:return d.next=23,this.createCheckpoint();case 23:case"end":return d.stop()}},i,this,[[3,15]])}));function n(){return r.apply(this,arguments)}return n}()},{key:"canRun",value:function(){return!0}},{key:"interrupt",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"shutdown",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"restart",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"reconnect",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"findRunningCell",value:function(){var n=this.cells.findIndex(function(i){return E.lPh.is(i.model)?i.model.kernelExecuting===!0:!1});n>-1&&(this.selectCell(this.cells[n]),this.scrollToView(this.cells[n]))}},{key:"createCheckpoint",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this.currentFileContents){s.next=3;break}return s.next=3,this.contentsManager.createCheckpoint(this.currentFileContents.path,{baseUrl:(0,F.Ue)()});case 3:case"end":return s.stop()}},i,this)}));function n(){return r.apply(this,arguments)}return n}()},{key:"listCheckpoints",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this.currentFileContents){s.next=3;break}return s.next=3,this.contentsManager.listCheckpoints(this.currentFileContents.path,{baseUrl:(0,F.Ue)()});case 3:case"end":return s.stop()}},i,this)}));function n(){return r.apply(this,arguments)}return n}()},{key:"restoreCheckpoint",value:function(){var r=y()(f()().mark(function i(a){return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!this.currentFileContents){c.next=3;break}return c.next=3,this.contentsManager.restoreCheckpoint(this.currentFileContents.path,a,{baseUrl:(0,F.Ue)()});case 3:case"end":return c.stop()}},i,this)}));function n(i){return r.apply(this,arguments)}return n}()},{key:"deleteCheckpoint",value:function(){var r=y()(f()().mark(function i(a){return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!this.currentFileContents){c.next=3;break}return c.next=3,this.contentsManager.deleteCheckpoint(this.currentFileContents.path,a,{baseUrl:(0,F.Ue)()});case 3:case"end":return c.stop()}},i,this)}));function n(i){return r.apply(this,arguments)}return n}()}]),t}(E.ero))||U)||U)||U)||U)||U)||U),vi=we.R.create().register(di,li,mt,$t,Bn,Le,si,{token:E.ero,useClass:mi},{token:Te,useFactory:function(e){return function(t){var r=e.container.createChild();r.register({token:E.seq,useValue:t});var n=r.get($t);return n}}}).dependOn(E.MDs),Wt,Qt,Ut,Bt,nn,Jt,Ae=(Wt=(0,O.ri)(),Qt=(0,$.vg)(),Ut=Reflect.metadata("design:type",Array),Wt(Bt=(nn=function(){function o(){D()(this,o),q()(this,"members",Jt,this)}return z()(o,[{key:"getMemberList",value:function(){var e=y()(f()().mark(function r(){var n,i,a;return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.getPlatformInfo();case 2:return n=c.sent,i=n.party,c.next=6,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getProjectInfo",project_id:this.getProjectId()})});case 6:return a=c.sent,a&&(this.members=a.members.map(function(l){return{name:l===i?"".concat(l," (you)"):l,creator:l===a.creator,color:(0,F.Q4)()}})),c.abrupt("return",this.members);case 9:case"end":return c.stop()}},r,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"inviteMember",value:function(){var e=y()(f()().mark(function r(n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"inviteMember",project_id:this.getProjectId(),invitee:n})});case 2:case"end":return a.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getPlatformInfo",value:function(){var e=y()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getPlatformInfo"})});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},r)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getProjectId",value:function(){var t=Ie.m8.location.pathname.split("/");return t[t.length-1]}}]),o}(),Jt=_()(nn.prototype,"members",[Qt,Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nn))||Bt),pi=m(45332),ce=m.n(pi),tn=m(89864),Ee=m(56257),H=m(65596),te=m(71340),ke=m(14412),rn=m(41570),an=m(44288),Yt=m(29800),Gt=m(84125),Kt=m(18252),Xt=m(37951),qt,_t,er,nr,tr,K,hi=function(){var e=H.Z.useForm(),t=ce()(e,1),r=t[0],n=(0,ee.useState)(!1),i=ce()(n,2),a=i[0],s=i[1],c=(0,ee.useState)(!1),l=ce()(c,2),p=l[0],d=l[1],b=(0,$.oC)(me.yd),v=H.Z.useWatch([],r),T=function(){r.validateFields().then(function(){var W=y()(f()().mark(function A(Q){return f()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return d(!0),N.prev=1,N.next=4,b.service.inviteMember(Q.name);case 4:s(!1),r.resetFields(),te.ZP.success("Invitations have been sent out."),N.next=12;break;case 9:N.prev=9,N.t0=N.catch(1),N.t0 instanceof Error&&te.ZP.error(N.t0.message);case 12:return N.prev=12,d(!1),N.finish(12);case 15:return N.abrupt("return");case 16:case"end":return N.stop()}},A,null,[[1,9,12,15]])}));return function(A){return W.apply(this,arguments)}}()).catch(function(){})},k=(0,g.jsx)("div",{className:"secretnote-add-member",children:(0,g.jsxs)(H.Z,{form:r,autoComplete:"off",requiredMark:!1,labelCol:{span:4},wrapperCol:{span:20},style:{display:"flex"},children:[(0,g.jsx)(H.Z.Item,{label:"",name:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u9080\u8BF7\u8005\u540D\u79F0"},{max:16,message:Ee.U6.t("\u540D\u79F0\u8FC7\u957F")}],children:(0,g.jsx)(ke.Z,{style:{width:256},maxLength:16,placeholder:"Add name to add member"})}),(0,g.jsx)(H.Z.Item,{wrapperCol:{offset:4,span:20},style:{marginBottom:0},children:(0,g.jsx)(rn.Z,{children:(0,g.jsx)(an.ZP,{htmlType:"submit",onClick:function(){T()},disabled:v&&!v.name,loading:p,children:"Invite"})})})]})});return(0,g.jsxs)("div",{className:"secretnote-scql-member",children:[(0,g.jsx)(Yt.C.Group,{children:b.service.members.map(function(S){return(0,g.jsx)(Gt.Z,{title:"".concat(S.name),children:(0,g.jsx)(Yt.C,{shape:"square",style:{backgroundColor:S.color,cursor:"pointer"},children:(0,g.jsx)("span",{style:{color:(0,F.U_)(S.color)},children:S.name.slice(0,1).toUpperCase()})})},S.name)})}),(0,g.jsx)(Kt.Z,{content:k,title:"",overlayStyle:{width:372},trigger:"click",placement:"bottomLeft",open:a,onOpenChange:function(W){r.resetFields(),s(W)},arrow:!1,children:(0,g.jsx)(an.ZP,{icon:(0,g.jsx)(Xt.Z,{size:16}),className:"btn",onClick:function(){return s(!0)}})})]})},rr=(qt=(0,O.ri)(),_t=(0,ie.ei)("secretnote-scql-member-view"),er=function(e,t){return(0,O.f3)(Ae)(e,void 0,0)},nr=Reflect.metadata("design:type",Function),tr=Reflect.metadata("design:paramtypes",[typeof Ae=="undefined"?Object:Ae]),qt(K=_t(K=er(K=nr(K=tr(K=function(o){de()(t,o);var e=fe()(t);function t(r){var n;return D()(this,t),n=e.call(this),h()(C()(n),"view",hi),h()(C()(n),"service",void 0),n.service=r,n}return z()(t,[{key:"onViewMount",value:function(){this.service.getMemberList()}}]),t}(tn.P))||K)||K)||K)||K)||K),gi=we.R.create().register(rr,Ae,(0,ie.bQ)({slot:Ze.Mx.right,view:rr,autoCreate:!0})),bi=m(48893),Re=m(54073),ar,ir,or,ur,on,sr,re=function(o){return o.UNDEFINED="",o.UNKNOWN="UNKNOWN",o.PLAINTEXT="PLAINTEXT",o.ENCRYPTED_ONLY="ENCRYPTED_ONLY",o.PLAINTEXT_AFTER_JOIN="PLAINTEXT_AFTER_JOIN",o.PLAINTEXT_AFTER_GROUP_BY="PLAINTEXT_AFTER_GROUP_BY",o.PLAINTEXT_AFTER_COMPARE="PLAINTEXT_AFTER_COMPARE",o.PLAINTEXT_AFTER_AGGREGATE="PLAINTEXT_AFTER_AGGREGATE",o}({}),yi=[re.UNKNOWN,re.PLAINTEXT,re.ENCRYPTED_ONLY,re.PLAINTEXT_AFTER_JOIN,re.PLAINTEXT_AFTER_GROUP_BY,re.PLAINTEXT_AFTER_COMPARE,re.PLAINTEXT_AFTER_AGGREGATE],ae=(ar=(0,O.ri)(),ir=(0,$.vg)(),or=Reflect.metadata("design:type",Array),ar(ur=(on=function(){function o(){D()(this,o),q()(this,"dataTables",sr,this)}return z()(o,[{key:"getDataTables",value:function(){var e=y()(f()().mark(function r(){var n,i,a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=[],d.next=3,this.getProjectInfo();case 3:if(i=d.sent,i){d.next=6;break}return d.abrupt("return");case 6:return d.next=8,this.getPlatformInfo();case 8:if(a=d.sent,a){d.next=11;break}return d.abrupt("return");case 11:return d.next=13,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getDataTables",project_id:this.getProjectId()})});case 13:s=d.sent,c=i.members,l=a.party,s&&c.forEach(function(b){var v=l===b,T={key:b,title:b,isLeaf:!1,belongToMe:v,children:[]};s.forEach(function(k){k.table_owner===b&&T.children.push({key:k.table_name,title:k.table_name,isLeaf:!0,data:{tableName:k.table_name,refTable:k.ref_table,dbType:k.db_type,tableOwner:k.table_owner,columns:k.columns},children:[],belongToMe:v})}),n.push(T)}),this.dataTables=n;case 18:case"end":return d.stop()}},r,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"addDataTable",value:function(){var e=y()(f()().mark(function r(n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"createTable",project_id:this.getProjectId(),table_name:n.tableName,ref_table:n.refTable,db_type:n.dbType,columns:n.columns})});case 2:this.getDataTables();case 3:case"end":return a.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"deleteDataTable",value:function(){var e=y()(f()().mark(function r(n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n.isLeaf){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"deleteTable",project_id:this.getProjectId(),table_name:n.title})});case 4:this.getDataTables();case 5:case"end":return a.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getTableCCL",value:function(){var e=y()(f()().mark(function r(n){var i,a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return i={owner:"",ccl:[]},d.next=3,this.getTableInfo(n);case 3:if(a=d.sent,a){d.next=6;break}return d.abrupt("return",i);case 6:return i.owner=a.table_owner,d.next=9,this.getProjectInfo();case 9:if(s=d.sent,s){d.next=12;break}return d.abrupt("return",i);case 12:return d.next=14,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getTableCCL",project_id:this.getProjectId(),table_name:n})});case 14:if(c=d.sent,c){d.next=17;break}return d.abrupt("return",i);case 17:return l=s.members,a.columns.forEach(function(b){var v={column:b.name};l.forEach(function(T){v[T]=re.UNDEFINED}),c.forEach(function(T){var k=T.col,S=k.column_name,W=k.table_name;S===b.name&&W===n&&(v[T.party_code]=T.constraint)}),i.ccl.push(v)}),d.abrupt("return",i);case 20:case"end":return d.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"grantTableCCL",value:function(){var e=y()(f()().mark(function r(n,i){var a;return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=[],i.forEach(function(l){Object.keys(l).forEach(function(p){p!=="column"&&l[p]!==re.UNDEFINED&&a.push({col:{column_name:l.column,table_name:n},party_code:p,constraint:l[p]})})}),c.next=4,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"grantCCL",project_id:this.getProjectId(),ccl_list:a})});case 4:case"end":return c.stop()}},r,this)}));function t(r,n){return e.apply(this,arguments)}return t}()},{key:"getPlatformInfo",value:function(){var e=y()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getPlatformInfo"})});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},r)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getProjectInfo",value:function(){var e=y()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getProjectInfo",project_id:this.getProjectId()})});case 2:if(n=a.sent,n){a.next=6;break}return Re.Z.info({title:"Info",content:"You were not involved in the project.",okText:"Back to project list",onOk:function(){Ie.m8.push("/scql/project")}}),a.abrupt("return");case 6:return a.abrupt("return",n);case 7:case"end":return a.stop()}},r,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getTableInfo",value:function(){var e=y()(f()().mark(function r(n){var i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,F.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getTableInfo",project_id:this.getProjectId(),table_name:n})});case 2:return i=s.sent,s.abrupt("return",i);case 4:case"end":return s.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getProjectId",value:function(){var t=Ie.m8.location.pathname.split("/");return t[t.length-1]}}]),o}(),sr=_()(on.prototype,"dataTables",[ir,or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),on))||ur),lr,cr,dr,fr,mr,X,Ci=function(){var e=(0,$.oC)(me.yd);return(0,g.jsx)(Gt.Z,{title:Ee.U6.t("\u5237\u65B0"),children:(0,g.jsx)(bi.Z,{size:14,onClick:function(r){r.stopPropagation(),e.service.getDataTables(),te.ZP.success(Ee.U6.t("\u6570\u636E\u8868\u5DF2\u5237\u65B0"))}})})},vr=(lr=(0,O.ri)(),cr=(0,ie.ei)("data-table-extra-view"),dr=function(e,t){return(0,O.f3)(ae)(e,void 0,0)},fr=Reflect.metadata("design:type",Function),mr=Reflect.metadata("design:paramtypes",[typeof ae=="undefined"?Object:ae]),lr(X=cr(X=dr(X=fr(X=mr(X=function(o){de()(t,o);var e=fe()(t);function t(r){var n;return D()(this,t),n=e.call(this),h()(C()(n),"service",void 0),h()(C()(n),"view",Ci),n.service=r,n}return z()(t)}(tn.P))||X)||X)||X)||X)||X),Si=m(64239),Ei=m(56047),Ce=m(42088),pr=m(1155),ki=m(69072),wi=m(91280),Ti=m(31592),ji=m(84350),Ni=m(69251),Oi=m(69524),Fi=m(84176),Pi=m.n(Fi),hr=m(75992),Mi=m(82058),Ii=["key","name"],Li=function(e){var t=e.visible,r=e.close,n=e.data,i=H.Z.useForm(),a=ce()(i,1),s=a[0],c=(0,$.oC)(ae),l=!!(n&&n.tableName);(0,ee.useEffect)(function(){s&&n&&s.setFieldsValue(n)},[n,s]);var p=function(){s.validateFields().then(function(){var b=y()(f()().mark(function v(T){return f()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,c.addDataTable(T);case 3:te.ZP.success("Add table successfully."),r(),S.next=10;break;case 7:S.prev=7,S.t0=S.catch(0),S.t0 instanceof Error&&te.ZP.error(S.t0.message);case 10:return S.abrupt("return");case 11:case"end":return S.stop()}},v,null,[[0,7]])}));return function(v){return b.apply(this,arguments)}}()).catch(function(){})};return(0,g.jsx)(Re.Z,{open:t,destroyOnClose:!0,title:"New Table",onOk:function(){return p()},onCancel:function(){r()},children:(0,g.jsxs)(H.Z,{form:s,autoComplete:"off",requiredMark:!0,labelCol:{span:6},wrapperCol:{span:18},style:{marginTop:24,maxHeight:500,overflowY:"auto"},initialValues:{dbType:"mysql"},children:[(0,g.jsx)(H.Z.Item,{label:"\u6570\u636E\u5E93\u7C7B\u578B",name:"dbType",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u7C7B\u578B"}],children:(0,g.jsx)(ke.Z,{maxLength:16,disabled:l,placeholder:"mysql"})}),(0,g.jsx)(H.Z.Item,{label:"\u8868\u540D\u79F0",name:"tableName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8868\u540D\u79F0"}],children:(0,g.jsx)(ke.Z,{maxLength:16,disabled:l})}),(0,g.jsx)(H.Z.Item,{label:"\u5173\u8054\u8868",name:"refTable",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5173\u8054\u8868"}],children:(0,g.jsx)(ke.Z,{maxLength:32,disabled:l})}),(0,g.jsx)(H.Z.Item,{label:"\u6570\u636E\u5217",className:"secretnote-table-columns",required:!0,children:(0,g.jsx)(H.Z.List,{name:"columns",children:function(b,v){var T=v.add,k=v.remove;return(0,g.jsxs)(g.Fragment,{children:[b.map(function(S){var W=S.key,A=S.name,Q=Pi()(S,Ii);return(0,g.jsxs)(rn.Z,{style:{display:"flex",marginBottom:8},align:"baseline",children:[(0,g.jsx)(H.Z.Item,j()(j()({},Q),{},{name:[A,"name"],rules:[{required:!0,message:""}],children:(0,g.jsx)(ke.Z,{placeholder:"Column Name"})})),(0,g.jsx)(H.Z.Item,j()(j()({},Q),{},{name:[A,"dtype"],rules:[{required:!0,message:""}],children:(0,g.jsx)(hr.Z,{style:{width:140},placeholder:"Data Type",options:[{label:"int",value:"int"},{label:"string",value:"string"},{label:"double",value:"double"}]})})),(0,g.jsx)(Mi.Z,{size:14,color:"#182431",cursor:"pointer",onClick:function(){return k(A)}})]},W)}),(0,g.jsx)(H.Z.Item,{children:(0,g.jsx)(an.ZP,{type:"dashed",onClick:function(){return T()},block:!0,icon:(0,g.jsx)(Xt.Z,{size:16,color:"#182431"}),children:"Add Columns"})})]})}})})]})})},gr={id:"data-table-config-modal",component:Li},$i=function(e){var t=e.visible,r=e.close,n=e.data,i=(0,ee.useState)([]),a=ce()(i,2),s=a[0],c=a[1],l=(0,ee.useState)(!1),p=ce()(l,2),d=p[0],b=p[1],v=(0,$.oC)(ae),T=(0,ee.useState)(""),k=ce()(T,2),S=k[0],W=k[1],A=function(){var N=y()(f()().mark(function w(){var M,P,V;return f()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.prev=0,b(!0),Z.next=4,v.getTableCCL(n.tableName);case 4:M=Z.sent,P=M.ccl,V=M.owner,W(V),c(P),Z.next=14;break;case 11:Z.prev=11,Z.t0=Z.catch(0),Z.t0 instanceof Error&&te.ZP.error(Z.t0.message);case 14:return Z.prev=14,b(!1),Z.finish(14);case 17:case"end":return Z.stop()}},w,null,[[0,11,14,17]])}));return function(){return N.apply(this,arguments)}}(),Q=function(){var N=y()(f()().mark(function w(){return f()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,v.grantTableCCL(n.tableName,s);case 3:te.ZP.success("Ccl config successfully."),r(),P.next=10;break;case 7:P.prev=7,P.t0=P.catch(0),P.t0 instanceof Error&&te.ZP.error(P.t0.message);case 10:case"end":return P.stop()}},w,null,[[0,7]])}));return function(){return N.apply(this,arguments)}}(),he=s.length>0?Object.keys(s[0]).map(function(N){return N==="column"?{title:"Column",dataIndex:"column",key:"column"}:{title:"Grant to ".concat(N===S?N+"(you)":N),dataIndex:N,key:N,render:function(M,P){return(0,g.jsx)(hr.Z,{options:yi.map(function(V){return{label:V,value:V}}),value:M,size:"small",style:{width:260},popupClassName:"secret-note-ccl-select",onChange:function(Or){var Z=s.map(function(sn){return sn.column===P.column?j()(j()({},sn),{},h()({},N,Or)):sn});c(Z)}})}}}):[];return(0,g.jsxs)(Re.Z,{width:720,open:t,destroyOnClose:!0,title:"CCL Config",onOk:function(){return Q()},onCancel:function(){r()},afterOpenChange:function(w){w&&A()},children:[(0,g.jsx)("a",{className:"secretnote-ccl-doc-link",href:"https://www.secretflow.org.cn/docs/scql/latest/zh-Hans/topics/ccl/intro",target:"_blank",rel:"noreferrer",children:"CCL configuration Guide"}),(0,g.jsx)(pr.Z,{className:"secretnote-ccl-table",dataSource:s,rowKey:"column",pagination:!1,columns:he,size:"small",loading:d})]})},br={id:"data-table-ccl-modal",component:$i},yr,Cr,Sr,Er,kr,wr,B,Ai=Ei.Z.DirectoryTree,Ri=function(e){var t=e.data,r=(0,ee.useState)([]),n=ce()(r,2),i=n[0],a=n[1],s=(0,$.oC)(me.yd),c=function(){var p=y()(f()().mark(function d(b){var v,T;return f()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,s.service.getTableCCL(b);case 2:v=S.sent,T=v.ccl,a(T);case 5:case"end":return S.stop()}},d)}));return function(b){return p.apply(this,arguments)}}();if((0,ee.useEffect)(function(){t&&c(t.tableName)},[t]),!t)return null;var l=i.length>0?Object.keys(i[0]).map(function(p){return p==="column"?{title:"Column",dataIndex:"column",key:"column"}:{title:"Grant to ".concat(p),dataIndex:p,key:p,render:function(b){return b||"-"}}}):[];return(0,g.jsx)("div",{className:"secretnote-node-description",children:(0,g.jsxs)(Ce.Z,{title:"\u8868\u4FE1\u606F",column:1,children:[(0,g.jsx)(Ce.Z.Item,{label:"\u6570\u636E\u5E93\u7C7B\u578B",children:t.dbType}),(0,g.jsx)(Ce.Z.Item,{label:"\u8868\u540D\u79F0",children:t.tableName}),(0,g.jsx)(Ce.Z.Item,{label:"\u5173\u8054\u8868",children:t.refTable}),(0,g.jsx)(Ce.Z.Item,{label:"\u6570\u636E\u5217",children:t.columns.map(function(p){return p.name}).join(", ")}),(0,g.jsx)(Ce.Z.Item,{label:"CCL",children:(0,g.jsx)(pr.Z,{className:"secretnote-ccl-view-table",dataSource:i,rowKey:"column",pagination:!1,columns:l,size:"small"})})]})})},Zi=function(){var e=(0,$.oC)(me.yd),t=e.service,r=function(a,s){switch(a){case"add":e.modalService.openModal(gr);break;case"configCCL":e.modalService.openModal(br,s.data);break;case"delete":Re.Z.confirm({title:"\u5220\u9664\u6570\u636E\u8868",centered:!0,content:"\u6570\u636E\u8868 ".concat(s.title," \u5C06\u88AB\u5220\u9664"),okText:"\u5220\u9664\u6570\u636E\u8868",cancelText:Ee.U6.t("\u53D6\u6D88"),okType:"danger",onOk:function(l){return y()(f()().mark(function p(){return f()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,t.deleteDataTable(s);case 2:return te.ZP.success("\u6570\u636E\u8868\u5DF2\u5220\u9664"),b.abrupt("return",l(Promise.resolve));case 4:case"end":return b.stop()}},p)}))()}});break;default:break}},n=function(a){var s=a.isLeaf,c=a.belongToMe,l=c?[{key:"add",label:"\u6DFB\u52A0\u6570\u636E\u8868",icon:(0,g.jsx)(ki.Z,{size:12})}]:[],p=c?[{key:"configCCL",label:"\u914D\u7F6E CCL",icon:(0,g.jsx)(wi.Z,{size:12})},{type:"divider"},{key:"delete",label:Ee.U6.t("\u5220\u9664"),icon:(0,g.jsx)(Ti.Z,{size:12}),danger:!0}]:[],d=(0,g.jsxs)("div",{className:"ant-tree-title-content",children:[(0,g.jsx)("span",{className:"title",children:(0,g.jsxs)(rn.Z,{children:[s&&(0,g.jsx)(ji.Z,{size:16}),(0,g.jsx)("span",{children:a.title})]})}),(0,g.jsx)(Oi.h,{items:s?p:l,onClick:function(v){r(v,a)}})]});return s?(0,g.jsx)(Kt.Z,{placement:"rightTop",align:{offset:[10,0]},arrow:!1,overlayStyle:{maxWidth:520},content:(0,g.jsx)(Ri,{data:a.data}),trigger:"hover",destroyTooltipOnHide:!0,children:d}):d};return(0,g.jsx)(Ai,{blockNode:!0,onSelect:function(){},treeData:t.dataTables,className:"secretnote-data-table-tree",switcherIcon:(0,g.jsx)(Ni.Z,{size:12}),icon:null,titleRender:n})},un="data-table",Tr=(yr=(0,O.ri)({contrib:[Ze.cI,Si.l]}),Cr=(0,ie.ei)("secretnote-data-table-view"),Sr=function(e,t){return(0,O.f3)(ae)(e,void 0,0)},Er=function(e,t){return(0,O.f3)(ye.Z)(e,void 0,1)},kr=Reflect.metadata("design:type",Function),wr=Reflect.metadata("design:paramtypes",[typeof ae=="undefined"?Object:ae,typeof ye.Z=="undefined"?Object:ye.Z]),yr(B=Cr(B=Sr(B=Er(B=kr(B=wr(B=function(o){de()(t,o);var e=fe()(t);function t(r,n){var i;return D()(this,t),i=e.call(this),h()(C()(i),"service",void 0),h()(C()(i),"modalService",void 0),h()(C()(i),"key",un),h()(C()(i),"label","\u6570\u636E\u8868"),h()(C()(i),"order",2),h()(C()(i),"defaultOpen",!0),h()(C()(i),"view",Zi),i.service=r,i.modalService=n,i}return z()(t,[{key:"onViewMount",value:function(){this.service.getDataTables()}},{key:"registerModals",value:function(){return[gr,br]}}]),t}(tn.P))||B)||B)||B)||B)||B)||B),Di=we.R.create().register(ae,Tr,vr,(0,ie.bQ)({slot:un,view:Tr,autoCreate:!0}),(0,ie.bQ)({slot:"".concat(un,"Extra"),view:vr,autoCreate:!0})),zi=m(24185),jr,Nr,Hi=(jr=(0,O.ri)({contrib:zi.H}),jr(Nr=function(){function o(){D()(this,o)}return z()(o,[{key:"registerToolbarItems",value:function(t){t.unregisterItem(E.NzD.Interrupt.id),t.unregisterItem(E.NzD.RestartClearOutput.id)}}]),o}())||Nr),Vi=we.R.create().register(Hi),xi=m(27275),Wi=m(36752),Qi=m(39930),Ui=m(50013),Bi=function(){return(0,g.jsx)(Fr.rF.Application,{asChild:!0,modules:[Pr.n6L,Ze.xu,Wi.O,xi.F,Ir.qi,gi,Di,vi,Qi.V,Mr.p,Ui.u,Vi]},"libro-app")},Ji=Bi}}]);
