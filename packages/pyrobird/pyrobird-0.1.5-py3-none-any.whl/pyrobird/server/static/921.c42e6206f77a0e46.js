"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[921],{921:(pt,Q,C)=>{C.r(Q),C.d(Q,{TGraph2DPainter:()=>G});var J=C(467),w=C(6998),F=C(357),Nt=C(9041),ct=C(675),dt=C(5284),Xt=C(4149),Yt=C(4571),b=C(1069),V=C(9407);function tt(O){let i=O[0];for(let h=1;h<O.length;++h)i=Math.max(i,O[h]);return i}function it(O){let i=O[0];for(let h=1;h<O.length;++h)i=Math.min(i,O[h]);return i}class ut{constructor(i){this.fGraph2D=i,this.fX=i.fX,this.fY=i.fY,this.fZ=i.fZ,this.fNpoints=i.fNpoints,this.fZout=0,this.fNdt=0,this.fNhull=0,this.fHullPoints=null,this.fXN=null,this.fYN=null,this.fOrder=null,this.fDist=null,this.fPTried=null,this.fNTried=null,this.fMTried=null,this.fInit=!1,this.fXNmin=0,this.fXNmax=0,this.fYNmin=0,this.fYNmax=0,this.fXoffset=0,this.fYoffset=0,this.fXScaleFactor=0,this.fYScaleFactor=0,this.SetMaxIter()}Initialize(){this.fInit||(this.CreateTrianglesDataStructure(),this.FindHull(),this.fInit=!0)}ComputeZ(i,h){this.Initialize();const s=(i+this.fXoffset)*this.fXScaleFactor,t=(h+this.fYoffset)*this.fYScaleFactor;let r=this.Interpolate(s,t);return 0===r&&(r=this.Interpolate(s+1e-4,t)),r}CreateTrianglesDataStructure(){const i=tt(this.fGraph2D.fX),h=tt(this.fGraph2D.fY),s=it(this.fGraph2D.fX),t=it(this.fGraph2D.fY);this.fXoffset=-(i+s)/2,this.fYoffset=-(h+t)/2,this.fXScaleFactor=1/(i-s),this.fYScaleFactor=1/(h-t),this.fXNmax=(i+this.fXoffset)*this.fXScaleFactor,this.fXNmin=(s+this.fXoffset)*this.fXScaleFactor,this.fYNmax=(h+this.fYoffset)*this.fYScaleFactor,this.fYNmin=(t+this.fYoffset)*this.fYScaleFactor,this.fXN=new Array(this.fNpoints+1),this.fYN=new Array(this.fNpoints+1);for(let r=0;r<this.fNpoints;r++)this.fXN[r+1]=(this.fX[r]+this.fXoffset)*this.fXScaleFactor,this.fYN[r+1]=(this.fY[r]+this.fYoffset)*this.fYScaleFactor;this.fPTried=[],this.fNTried=[],this.fMTried=[]}Enclose(i,h,s,t){const r=[this.fXN[i],this.fXN[h],this.fXN[s],this.fXN[i]],n=[this.fYN[i],this.fYN[h],this.fYN[s],this.fYN[i]],a=this.fXN[t],o=this.fYN[t];let d=0,Y=r.length-1,m=!1;for(;d<r.length;++d)(n[d]<o&&n[Y]>=o||n[Y]<o&&n[d]>=o)&&r[d]+(o-n[d])/(n[Y]-n[d])*(r[Y]-r[d])<a&&(m=!m),Y=d;return m}FileIt(i,h,s){let t,r,n=i,a=h,o=s;do{t=!1,a>n&&(r=n,n=a,a=r,t=!0),o>a&&(r=a,a=o,o=r,t=!0)}while(t);this.fNdt++,this.fPTried.push(n),this.fNTried.push(a),this.fMTried.push(o)}FindAllTriangles(){if(this.fAllTri)return;this.fAllTri=!0;let i,h,s,t,r,n,a,o,d,Y,m,N,f,l,u,e,c,T,P,X,x,g,M,y,_,E=0,p=0,I=0;const z=[!1,!1,!1],D=1e-4;for(this.Initialize(),i=0,h=0,_=1;_<=this.fNhull;_++)i+=this.fXN[this.fHullPoints[_-1]],h+=this.fYN[this.fHullPoints[_-1]];for(i=i/this.fNhull+D,h=h/this.fNhull+D,this.Interpolate(i,h),e=1;e<=this.fNdt;){for(T=this.fPTried[e-1],P=this.fNTried[e-1],X=this.fMTried[e-1],z[0]=!1,z[1]=!1,z[2]=!1,c=1;c<=this.fNdt;c++)c!==e&&(x=this.fPTried[c-1],g=this.fNTried[c-1],M=this.fMTried[c-1],T===x&&P===g||T===x&&P===M||T===g&&P===M?z[0]=!0:T===x&&X===g||T===x&&X===M||T===g&&X===M?z[1]=!0:(P===x&&X===g||P===x&&X===M||P===g&&X===M)&&(z[2]=!0));for(y=1;y<=3;y++)z[y-1]||(1===y?(E=T,p=P,I=X):2===y?(E=T,p=X,I=P):3===y&&(E=P,p=X,I=T),s=(this.fXN[E]+this.fXN[p])/2,t=(this.fYN[E]+this.fYN[p])/2,a=this.fXN[E]-this.fXN[p],o=this.fYN[E]-this.fYN[p],d=o,Y=-a,l=Math.sqrt(d*d+Y*Y),d/=l,Y/=l,m=this.fXN[I]-s,N=this.fYN[I]-t,f=m*d+N*Y,f>0&&(d=-d,Y=-Y),u=Math.abs(Math.max(D*s,D*t)),r=s+d*u,n=t+Y*u,this.Interpolate(r,n));e++}}FindHull(){this.fHullPoints||(this.fHullPoints=new Array(this.fNpoints));let i=0;for(let h=1;h<=this.fNpoints;h++)this.InHull(h,h)||(i++,this.fHullPoints[i-1]=h);this.fNhull=i}InHull(i,h){let s,t,r,n,a,o,d,Y,m,N,f,l,u,e,c,T,P,X,x,g,M,E=!1;const p=this.fXN[i],y=this.fYN[i];for(a=this.fNhull>0?this.fNhull:this.fNpoints,s=1,t=2,s===h?(s=t,t++):t===h&&t++,m=p-this.fXN[s],l=y-this.fYN[s],N=p-this.fXN[t],u=y-this.fYN[t],x=Math.atan2(l,m),g=Math.atan2(u,N),M=x-g-Math.floor((x-g)/(2*Math.PI))*Math.PI*2,M<0&&(M+=2*Math.PI),o=M,r=1;r<=a;r++)if(n=this.fNhull>0?this.fHullPoints[r-1]:r,n!==s&&n!==t&&n!==h&&(m=p-this.fXN[s],l=y-this.fYN[s],N=p-this.fXN[t],u=y-this.fYN[t],f=p-this.fXN[n],e=y-this.fYN[n],d=N*l-m*u,Y=m*u-N*l,d*Y!=0&&(c=(N*e-f*u)/d,T=(m*e-f*l)/Y,c<0||T<0))){if(P=(m*f+l*e)/Math.sqrt(m*m+l*l),X=(N*f+u*e)/Math.sqrt(N*N+u*u),P>X?(s=n,x=Math.atan2(e,f),g=Math.atan2(u,N)):(t=n,x=Math.atan2(l,m),g=Math.atan2(e,f)),M=x-g-Math.floor((x-g)/(2*Math.PI))*Math.PI*2,M<0&&(M+=2*Math.PI),(M-Math.PI)*(o-Math.PI)<0)return E=!0,E;o=M}return E}InterpolateOnPlane(i,h,s,t){let r,n,a=i,o=h,d=s;do{n=!1,o>a&&(r=a,a=o,o=r,n=!0),d>o&&(r=o,o=d,d=r,n=!0)}while(n);const Y=this.fXN[a],m=this.fXN[o],N=this.fXN[d],f=this.fYN[a],l=this.fYN[o],u=this.fYN[d],e=this.fZ[a-1],c=this.fZ[o-1],T=this.fZ[d-1],P=(e*(l-u)+c*(u-f)+T*(f-l))/(Y*(l-u)+m*(u-f)+N*(f-l)),X=(e*(m-N)+c*(N-Y)+T*(Y-m))/(f*(m-N)+l*(N-Y)+u*(Y-m));return P*this.fXN[t]+X*this.fYN[t]+(e-P*Y-X*f)}Interpolate(i,h){let s,t,r,n,a,o,d,Y,m,N,f,l,u,e,c,T,P,X,x,g,I,z,D,A,H,L,S,st,ft,et,ht,K,U,rt,nt,j,B,$,R,W,q,lt,at,M=0,E=0,p=0,y=0,_=0;const Z=[0,0,0],k=[0,0,0];if(this.Initialize(),this.fOrder||(this.fOrder=new Array(this.fNpoints),this.fDist=new Array(this.fNpoints)),this.fXN[0]=i,this.fYN[0]=h,s=this.fZout,r=0,i>this.fXNmax||i<this.fXNmin||h>this.fYNmax||h<this.fYNmin)return s;for(t=1;t<=this.fNdt;t++)if(n=this.fPTried[t-1],a=this.fNTried[t-1],o=this.fMTried[t-1],this.Enclose(n,a,o,0))return s=this.InterpolateOnPlane(n,a,o,0),s;const ot=this.InHull(0,-1);if(!ot)return s;for(t=1;t<=this.fNpoints;t++)I=this.fXN[t],z=this.fYN[t],this.fDist[t-1]=Math.sqrt((i-I)*(i-I)+(h-z)*(h-z));for(function mt(O,i,h,s){const t=new Array(O);for(let r=0;r<O;++r)t[r]={v:i[r],i:r};t.sort((r,n)=>r.v<n.v?-1:r.v>n.v?1:0);for(let r=0;r<O;++r)h[r]=t[r].i}(this.fNpoints,this.fDist,this.fOrder),t=0;t<this.fNpoints;t++)this.fOrder[t]++;for(m=3;m<=this.fNpoints;m++)for(o=this.fOrder[m-1],Y=2;Y<=m-1;Y++)for(a=this.fOrder[Y-1],d=1;d<=Y-1;d++){let v=!1;if(n=this.fOrder[d-1],r>this.fMaxIter)return s;if(r++,D=Math.sqrt((this.fXN[n]-this.fXN[a])**2+(this.fYN[n]-this.fYN[a])**2),A=Math.sqrt((this.fXN[n]-this.fXN[o])**2+(this.fYN[n]-this.fYN[o])**2),H=Math.sqrt((this.fXN[a]-this.fXN[o])**2+(this.fYN[a]-this.fYN[o])**2),!(D+A<=H||D+H<=A||A+H<=D)&&this.Enclose(n,a,o,0)){for(M=0,f=1;f<=this.fNpoints;f++)if(f!==n&&f!==a&&f!==o){for(N=1;N<=this.fNpoints;N++)if(this.fOrder[N-1]===f){if(!(N<d||N<Y||N<m))break;if(this.Enclose(n,a,o,f)){v=!0;break}}if(v)break;if((this.fXN[n]-this.fXN[f])*(this.fYN[n]-this.fYN[a])==(this.fYN[n]-this.fYN[f])*(this.fXN[n]-this.fXN[a])?(T=n,P=a):(this.fXN[n]-this.fXN[f])*(this.fYN[n]-this.fYN[o])==(this.fYN[n]-this.fYN[f])*(this.fXN[n]-this.fXN[o])?(T=n,P=o):(this.fXN[a]-this.fXN[f])*(this.fYN[a]-this.fYN[o])==(this.fYN[a]-this.fYN[f])*(this.fXN[a]-this.fXN[o])?(T=a,P=o):(T=0,P=0),0!==T){if(this.fXN[T]!==this.fXN[P]){if((this.fXN[f]-this.fXN[T])*(this.fXN[f]-this.fXN[P])<0){v=!0;break}(this.fXN[f]-this.fXN[T])*(this.fXN[f]-this.fXN[P])==0&&console.warn(`Interpolate Two of these three points are coincident ${T} ${P} ${f}`)}else{if((this.fYN[f]-this.fYN[T])*(this.fYN[f]-this.fYN[P])<0){v=!0;break}(this.fYN[f]-this.fYN[T])*(this.fYN[f]-this.fYN[P])==0&&console.warn(`Interpolate Two of these three points are coincident ${T} ${P} ${f}`)}continue}if(v)break;for(l=o,e=n,c=a,Z[0]=this.fXN[n]-this.fXN[f],k[0]=this.fYN[n]-this.fYN[f],Z[1]=this.fXN[a]-this.fXN[f],k[1]=this.fYN[a]-this.fYN[f],Z[2]=this.fXN[o]-this.fXN[f],k[2]=this.fYN[o]-this.fYN[f],N=1;N<=3;N++)if(j=Z[N-1],B=Z[N%3],$=Z[(N+1)%3],R=k[N-1],W=k[N%3],q=k[(N+1)%3],lt=(q*B-$*W)*(R*B-j*W),at=(q*j-$*R)*(W*j-B*R),lt>=0&&at>=0){1===N?(l=o,e=n,c=a):2===N?(l=n,e=a,c=o):(l=a,e=o,c=n);break}if(U=((this.fXN[l]-this.fXN[e])*(this.fXN[f]-this.fXN[e])+(this.fYN[l]-this.fYN[e])*(this.fYN[f]-this.fYN[e]))/Math.sqrt(((this.fXN[l]-this.fXN[e])*(this.fXN[l]-this.fXN[e])+(this.fYN[l]-this.fYN[e])*(this.fYN[l]-this.fYN[e]))*((this.fXN[f]-this.fXN[e])*(this.fXN[f]-this.fXN[e])+(this.fYN[f]-this.fYN[e])*(this.fYN[f]-this.fYN[e]))),rt=((this.fXN[c]-this.fXN[e])*(this.fXN[f]-this.fXN[e])+(this.fYN[c]-this.fYN[e])*(this.fYN[f]-this.fYN[e]))/Math.sqrt(((this.fXN[c]-this.fXN[e])*(this.fXN[c]-this.fXN[e])+(this.fYN[c]-this.fYN[e])*(this.fYN[c]-this.fYN[e]))*((this.fXN[f]-this.fXN[e])*(this.fXN[f]-this.fXN[e])+(this.fYN[f]-this.fYN[e])*(this.fYN[f]-this.fYN[e]))),nt=((this.fXN[c]-this.fXN[e])*(this.fXN[l]-this.fXN[e])+(this.fYN[c]-this.fYN[e])*(this.fYN[l]-this.fYN[e]))/Math.sqrt(((this.fXN[c]-this.fXN[e])*(this.fXN[c]-this.fXN[e])+(this.fYN[c]-this.fYN[e])*(this.fYN[c]-this.fYN[e]))*((this.fXN[l]-this.fXN[e])*(this.fXN[l]-this.fXN[e])+(this.fYN[l]-this.fYN[e])*(this.fYN[l]-this.fYN[e]))),!(U>rt||U>nt)){if(st=Math.sqrt((this.fXN[f]-this.fXN[e])*(this.fXN[f]-this.fXN[e])+(this.fYN[f]-this.fYN[e])*(this.fYN[f]-this.fYN[e])),ft=Math.sqrt((this.fXN[f]-this.fXN[c])*(this.fXN[f]-this.fXN[c])+(this.fYN[f]-this.fYN[c])*(this.fYN[f]-this.fYN[c])),et=Math.sqrt((this.fXN[l]-this.fXN[e])*(this.fXN[l]-this.fXN[e])+(this.fYN[l]-this.fYN[e])*(this.fYN[l]-this.fYN[e])),ht=Math.sqrt((this.fXN[l]-this.fXN[c])*(this.fXN[l]-this.fXN[c])+(this.fYN[l]-this.fYN[c])*(this.fYN[l]-this.fYN[c])),L=((this.fXN[f]-this.fXN[e])*(this.fXN[f]-this.fXN[c])+(this.fYN[f]-this.fYN[e])*(this.fYN[f]-this.fYN[c]))/st/ft,S=((this.fXN[l]-this.fXN[e])*(this.fXN[l]-this.fXN[c])+(this.fYN[l]-this.fYN[e])*(this.fYN[l]-this.fYN[c]))/et/ht,K=L*Math.sqrt(1-S*S)+S*Math.sqrt(1-L*L),K<-1e-6){v=!0;break}Math.abs(K)<=1e-6&&(M++,E=f,p=l,y=e,_=c)}}if(!v)return M>0?(u=E,l=p,e=y,c=_,this.fZ[e-1]+this.fZ[c-1]>this.fZ[u-1]+this.fZ[l-1]?(X=n,x=a,g=o,this.FileIt(n,a,o),this.FileIt(u,e,c)):(X=l,x=u,g=this.Enclose(l,u,e,0)?e:c,this.FileIt(l,u,e),this.FileIt(l,u,c))):(this.FileIt(n,a,o),X=n,x=a,g=o),s=this.InterpolateOnPlane(X,x,g,0),s}}return ot&&console.error(`Interpolate Point outside hull when expected inside: this point could be dodgy ${i}  ${h} ${r}`),s}SetMaxIter(i=1e5){this.fAllTri=!1,this.fMaxIter=i}SetMarginBinsContent(i){this.fZout=i}}class G extends ct.JW{decodeOptions(i,h){const s=new Nt.nC(i);this.options||(this.options={});const t=this.options;t.Triangles=s.check("TRI1")?11:s.check("TRI2")?10:s.check("TRIW")?1:s.check("TRI")?2:0,t.Line=s.check("LINE"),t.Error=s.check("ERR")&&(this.matchObjectType(w.clTGraph2DErrors)||this.matchObjectType(w.clTGraph2DAsymmErrors)),s.check("P0COL")?t.Color=t.Circles=t.Markers=!0:(t.Color=s.check("COL"),t.Circles=s.check("P0"),t.Markers=s.check("P")),t.Markers||t.Error||t.Circles||t.Line||t.Triangles||(1===h.fMarkerSize&&1===h.fMarkerStyle?t.Circles=!0:t.Markers=!0),t.Markers||(t.Color=!1),(t.Color||t.Triangles>=10)&&(t.Zscale=s.check("Z")),this.storeDrawOpt(i)}createHistogram(){const i=this.getObject(),h=this.matchObjectType(w.clTGraph2DAsymmErrors);let s=i.fX[0],t=s,r=i.fY[0],n=r,a=i.fZ[0],o=a;for(let x=0;x<i.fNpoints;++x){const g=i.fX[x],M=i.fY[x],E=i.fZ[x];this.options.Error?(s=Math.min(s,g-(h?i.fEXlow[x]:i.fEX[x])),t=Math.max(t,g+(h?i.fEXhigh[x]:i.fEX[x])),r=Math.min(r,M-(h?i.fEYlow[x]:i.fEY[x])),n=Math.max(n,M+(h?i.fEYhigh[x]:i.fEY[x])),a=Math.min(a,E-(h?i.fEZlow[x]:i.fEZ[x])),o=Math.max(o,E+(h?i.fEZhigh[x]:i.fEZ[x]))):(s=Math.min(s,g),t=Math.max(t,g),r=Math.min(r,M),n=Math.max(n,M),a=Math.min(a,E),o=Math.max(o,E))}function d(x,g){return x<g?.02*(g-x):Math.abs(x)<1e5?.02:.02*Math.abs(x)}const Y=d(s,t),m=d(r,n),N=d(a,o);let f=s-Y,l=t+Y,u=r-m,e=n+m,c=a-N,T=o+N;f<0&&s>=0&&(f=.98*s),l>0&&t<=0&&(l=0),u<0&&r>=0&&(u=.98*r),e>0&&n<=0&&(e=0),c<0&&a>=0&&(c=.98*a),T>0&&o<=0&&(T=0);const P=this.getObject();P.fMinimum!==w.kNoZoom&&(c=P.fMinimum),P.fMaximum!==w.kNoZoom&&(T=P.fMaximum);const X=(0,w.createHistogram)(w.clTH2I,10,10);return X.fName=P.fName+"_h",(0,w.setHistogramTitle)(X,P.fTitle),X.fXaxis.fXmin=f,X.fXaxis.fXmax=l,X.fYaxis.fXmin=u,X.fYaxis.fXmax=e,X.fZaxis.fXmin=c,X.fZaxis.fXmax=T,X.fMinimum=c,X.fMaximum=T,X.fBits|=w.kNoStats,X}graph2DTooltip(i){let h=Math.floor(i.index/this.nvertex);if(h<0||h>=this.index.length)return null;const s=d=>d*d;h=this.index[h];const t=this.painter,r=this.graph;let n=t.grx(r.fX[h]),a=t.gry(r.fY[h]),o=t.grz(r.fZ[h]);if(this.check_next&&h+1<r.fX.length){const d=i.point,Y=t.grx(r.fX[h+1]),m=t.gry(r.fY[h+1]),N=t.grz(r.fZ[h+1]);s(d.x-Y)+s(d.y-m)+s(d.z-N)<s(d.x-n)+s(d.y-a)+s(d.z-o)&&(n=Y,a=m,o=N,h++)}return{x1:n-this.scale0,x2:n+this.scale0,y1:a-this.scale0,y2:a+this.scale0,z1:o-this.scale0,z2:o+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+h,"x: "+t.axisAsText("x",r.fX[h]),"y: "+t.axisAsText("y",r.fY[h]),"z: "+t.axisAsText("z",r.fZ[h])]}}drawTriangles(i,h,s,t){const r=new ut(h);if(r.FindAllTriangles(),!r.fNdt)return;const n=i.logz?m=>m<i.scale_zmin?-.1:i.grz(m):i.grz,a=2===this.options.Triangles,o=this.options.Triangles>=10||a,d=this.options.Triangles%10==1||a&&h.fLineColor!==h.fFillColor,Y=new Yt.N7(s,n,0,2*i.size_z3d,d);for(Y.loop=0;Y.loop<2;++Y.loop){Y.createBuffers();for(let m=0;m<r.fNdt;++m){const N=[r.fPTried[m],r.fNTried[m],r.fMTried[m]],f=[];let l=!0;for(let u=0;u<3;++u){const e=N[u]-1;f.push(i.grx(h.fX[e]),i.gry(h.fY[e]),n(h.fZ[e])),(h.fX[e]<i.scale_xmin||h.fX[e]>i.scale_xmax||h.fY[e]<i.scale_ymin||h.fY[e]>i.scale_ymax)&&(l=!1)}o&&l&&Y.addMainTriangle(...f),d&&l&&(Y.addLineSegment(f[0],f[1],f[2],f[3],f[4],f[5]),Y.addLineSegment(f[3],f[4],f[5],f[6],f[7],f[8]),Y.addLineSegment(f[6],f[7],f[8],f[0],f[1],f[2]))}}Y.callFuncs((m,N)=>{const f=(0,V.cD)(this.getMainPainter(),N,null,100,100),l=a?this.getColor(h.fFillColor):t.calcColor(m,s.length),u=new F.V9B((0,b.Bx)(l,{side:F.$EB,vertexColors:!1})),e=new F.eaF(f,u);i.toplevel.add(e),e.painter=this},(m,N)=>{const f=this.getColor(h.fLineColor),l=new F.mrM({color:new F.Q1f(f),linewidth:h.fLineWidth}),u=(0,b.Fc)((0,V.QK)(this.getMainPainter(),N,100,100),l);i.toplevel.add(u)})}redraw(){var i=this;return(0,J.A)(function*(){const h=i.getMainPainter(),s=i.getFramePainter(),t=i.getObject();if(!(t&&h&&s&&s.mode3d))return i;const r=(N,f)=>{let l=0;for(let u=0;u<t.fNpoints;++u)t.fX[u]<s.scale_xmin||t.fX[u]>s.scale_xmax||t.fY[u]<s.scale_ymin||t.fY[u]>s.scale_ymax||t.fZ[u]<N||t.fZ[u]>=f||++l;return l};let n=1;if(w.settings.OptimizeDraw>0&&!s.webgl){const N=r(s.scale_zmin,s.scale_zmax),f=5e4;N>f&&(n=Math.floor(N/f),n<=2&&(n=2))}const a=new dt.e(t),o=[];let d=null,Y=[s.scale_zmin,s.scale_zmax],m=s.size_x3d/100*a.getFullSize();i.options.Circles&&(m=.06*s.size_x3d),s.usesvg&&(m*=.3),(i.options.Color||i.options.Triangles>=10)&&(Y=h.getContourLevels(!0),d=h.getHistPalette()),i.options.Triangles&&i.drawTriangles(s,t,Y,d);for(let N=0;N<Y.length-1;++N){const f=Math.max(Y[N],s.scale_zmin),l=Math.min(Y[N+1],s.scale_zmax);if(f>=l)continue;const u=Math.floor(r(f,l)/n),e=new Int32Array(u);let c=null,T=0,P=0,X=null,x=!1,g=null,M=0,E=0;(i.options.Markers||i.options.Circles)&&(c=new b._l(u,s.webgl,m/3)),i.options.Error&&(X=new Float32Array(6*u*3),x=i.matchObjectType(w.clTGraph2DAsymmErrors)),i.options.Line&&(g=new Float32Array(6*(u-1)));for(let p=0;p<t.fNpoints;++p){if(t.fX[p]<s.scale_xmin||t.fX[p]>s.scale_xmax||t.fY[p]<s.scale_ymin||t.fY[p]>s.scale_ymax||t.fZ[p]<f||t.fZ[p]>=l||n>1&&(T=(T+1)%n,0!==T))continue;e[P++]=p;const y=s.grx(t.fX[p]),_=s.gry(t.fY[p]),I=s.grz(t.fZ[p]);c&&c.addPoint(y,_,I),X&&(X[M]=s.grx(t.fX[p]-(x?t.fEXlow[p]:t.fEX[p])),X[M+1]=_,X[M+2]=I,X[M+3]=s.grx(t.fX[p]+(x?t.fEXhigh[p]:t.fEX[p])),X[M+4]=_,X[M+5]=I,M+=6,X[M]=y,X[M+1]=s.gry(t.fY[p]-(x?t.fEYlow[p]:t.fEY[p])),X[M+2]=I,X[M+3]=y,X[M+4]=s.gry(t.fY[p]+(x?t.fEYhigh[p]:t.fEY[p])),X[M+5]=I,M+=6,X[M]=y,X[M+1]=_,X[M+2]=s.grz(t.fZ[p]-(x?t.fEZlow[p]:t.fEZ[p])),X[M+3]=y,X[M+4]=_,X[M+5]=s.grz(t.fZ[p]+(x?t.fEZhigh[p]:t.fEZ[p])),M+=6),g&&(E>=6&&(g[E]=g[E-3],g[E+1]=g[E-2],g[E+2]=g[E-1],E+=3),g[E]=y,g[E+1]=_,g[E+2]=I,E+=3)}if(g&&E>3&&g.length===E){const p=i.getColor(t.fLineColor),y=new F.mrM({color:new F.Q1f(p),linewidth:t.fLineWidth}),_=(0,b.Fc)(g,y);s.toplevel.add(_),_.graph=t,_.index=e,_.painter=s,_.scale0=.7*m,_.tip_name=i.getObjectHint(),_.tip_color=3===t.fMarkerColor?16711680:65280,_.nvertex=2,_.check_next=!0,_.tooltip=i.graph2DTooltip}if(X){const p=i.getColor(t.fLineColor),y=new F.mrM({color:new F.Q1f(p),linewidth:t.fLineWidth}),_=(0,b.Fc)(X,y);s.toplevel.add(_),_.graph=t,_.index=e,_.painter=s,_.scale0=.7*m,_.tip_name=i.getObjectHint(),_.tip_color=3===t.fMarkerColor?16711680:65280,_.nvertex=6,_.tooltip=i.graph2DTooltip}if(c){let p="blue";(!i.options.Circles||i.options.Color)&&(p=d?d.calcColor(N,Y.length):i.getColor(t.fMarkerColor));const y=c.createPoints({color:p,style:i.options.Circles?4:t.fMarkerStyle}).then(_=>{_.graph=t,_.painter=s,_.tip_color=3===t.fMarkerColor?16711680:65280,_.scale0=.3*m,_.index=e,_.tip_name=i.getObjectHint(),_.tooltip=i.graph2DTooltip,s.toplevel.add(_)});o.push(y)}}return Promise.all(o).then(()=>{if(i.options.Zscale&&i.ownhisto){const N=i.getMainPainter()?.findFunction(w.clTPaletteAxis);return i.getPadPainter()?.findPainterFor(N)?.drawPave()}}).then(()=>(s.render3D(100),i))})()}static draw(i,h,s){return(0,J.A)(function*(){const t=new G(i,h);t.decodeOptions(s,h);let r=Promise.resolve(null);return t.getMainPainter()||(h.fHistogram||(h.fHistogram=t.createHistogram()),r=Xt.TH2Painter.draw(i,h.fHistogram,t.options.Zscale?"lego2z":"lego2"),t.ownhisto=!0),r.then(()=>(t.addToPadPrimitives(),t.redraw()))})()}}}}]);