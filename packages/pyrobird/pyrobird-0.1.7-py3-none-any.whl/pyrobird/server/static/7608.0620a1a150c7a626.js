"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[7608],{7608:(Dt,xt,k)=>{k.r(xt),k.d(xt,{RH3Painter:()=>q,drawHistDisplayItem:()=>Mt});var ft=k(467),X=k(6998),K=k(357),ct=k(9041),bt=k(4797),zt=k(9274),Bt=k(6563),L=k(1069),At=k(3050),wt=k(9484),Ct=k(9407);class q extends Bt.G{getDimension(){return 3}scanContent(t){if(t&&this.nbinsx&&this.nbinsy&&this.nbinsz)return;const e=this.getHisto();if(e){if(this.extractAxesProperties(3),this.isDisplayItem())this.gminbin=e.fContMin,this.gminposbin=e.fContMinPos>0?e.fContMinPos:null,this.gmaxbin=e.fContMax;else{this.gminbin=this.gmaxbin=e.getBinContent(1,1,1);for(let i=0;i<this.nbinsx;++i)for(let n=0;n<this.nbinsy;++n)for(let x=0;x<this.nbinsz;++x){const a=e.getBinContent(i+1,n+1,x+1);a<this.gminbin?this.gminbin=a:a>this.gmaxbin&&(this.gmaxbin=a)}}this.draw_content=0!==this.gmaxbin||0!==this.gminbin}}countStat(){const t=this.getHisto(),e=this.getAxis("x"),i=this.getAxis("y"),n=this.getAxis("z"),x=this.getSelectIndex("x","left"),a=this.getSelectIndex("x","right"),m=this.getSelectIndex("y","left"),f=this.getSelectIndex("y","right"),g=this.getSelectIndex("z","left"),h=this.getSelectIndex("z","right"),l={name:t.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0};let y,z,E,j,G,I,Z,W,$,S,d=0,D=0,A=0,w=0,u=0,c=0,p=0;for(y=1;y<=this.nbinsx;++y)for(j=e.GetBinCoord(y-.5),G=y<=x+1?0:y>a+1?2:1,z=1;z<=this.nbinsy;++z)for(I=i.GetBinCoord(z-.5),Z=z<=m+1?0:z>f+1?2:1,E=1;E<=this.nbinsz;++E)W=n.GetBinCoord(E-.5),$=E<=g+1?0:E>h+1?2:1,S=t.getBinContent(y,z,E),l.entries+=S,1===G&&1===Z&&1===$&&(d+=S,D+=j*S,A+=I*S,w+=W*S,u+=j**2*S,c+=I**2*S,p+=W**2*S);return Math.abs(d)>1e-300&&(l.meanx=D/d,l.meany=A/d,l.meanz=w/d,l.rmsx=Math.sqrt(Math.abs(u/d-l.meanx**2)),l.rmsy=Math.sqrt(Math.abs(c/d-l.meany**2)),l.rmsz=Math.sqrt(Math.abs(p/d-l.meanz**2))),l.integral=d,t.fEntries>1&&(l.entries=t.fEntries),l}fillStatistic(t,e){const i=this.countStat(),n=e%10,x=Math.floor(e/10)%10,a=Math.floor(e/100)%10,m=Math.floor(e/1e3)%10,f=Math.floor(e/1e6)%10;return t.clearStat(),n>0&&t.addText(i.name),x>0&&t.addText("Entries = "+t.format(i.entries,"entries")),a>0&&(t.addText("Mean x = "+t.format(i.meanx)),t.addText("Mean y = "+t.format(i.meany)),t.addText("Mean z = "+t.format(i.meanz))),m>0&&(t.addText("Std Dev x = "+t.format(i.rmsx)),t.addText("Std Dev y = "+t.format(i.rmsy)),t.addText("Std Dev z = "+t.format(i.rmsz))),f>0&&t.addText("Integral = "+t.format(i.integral,"entries")),!0}getBinTooltips(t,e,i){const n=[],x=this.getHisto();let a=1,m=1,f=1;this.isDisplayItem()&&(a=x.stepx||1,m=x.stepy||1,f=x.stepz||1),n.push(this.getObjectHint(),`x = ${this.getAxisBinTip("x",t,a)}  xbin=${t+1}`,`y = ${this.getAxisBinTip("y",e,m)}  ybin=${e+1}`,`z = ${this.getAxisBinTip("z",i,f)}  zbin=${i+1}`);const g=x.getBinContent(t+1,e+1,i+1),h="entries = "+(a>1||m>1||f>1?"~":"");return g===Math.round(g)?n.push(h+g):n.push(h+(0,ct.lg)(g,X.gStyle.fStatFormat)),n}draw3DScatter(t){var e=this;return(0,ft.A)(function*(){const i=e.getHisto(),n=e.getFramePainter(),x=t.i1,a=t.i2,m=t.stepi,f=t.j1,g=t.j2,h=t.stepj,l=t.k1,d=t.k2,D=t.stepk;if(a<=x||g<=f||d<=l)return!0;const A=e.gmaxbin>1e3?1e3/e.gmaxbin:1,w=Math.max(0,e.gminbin);let u,c,p,y,z=0,E=0;for(u=x;u<a;u+=m)for(c=f;c<g;c+=h)for(p=l;p<d;p+=D)y=i.getBinContent(u+1,c+1,p+1),E+=y,!(y<=w)&&(z+=Math.round(y*A));if(z>(n.webgl?1e5:3e4))return!1;const j=new L._l(z,n.webgl,n.size_x3d/200),G=new Int32Array(z),I=e.getAxis("x"),Z=e.getAxis("y"),W=e.getAxis("z"),$=new ct.YF(E);let S=0;for(u=x;u<a;u+=m)for(c=f;c<g;c+=h)for(p=l;p<d;p+=D){if(y=i.getBinContent(u+1,c+1,p+1),y<=w)continue;const H=Math.round(y*A);for(let T=0;T<H;++T){const b=I.GetBinCoord(u+$.random()),B=Z.GetBinCoord(c+$.random()),P=W.GetBinCoord(p+$.random());G[S++]=i.getBin(u+1,c+1,p+1),j.addPoint(n.grx(b),n.gry(B),n.grz(P))}}return j.createPoints({color:e.v7EvalColor("fill_color","red")}).then(H=>(n.toplevel.add(H),H.bins=G,H.painter=e,H.tip_color=65280,H.tooltip=function(T){const b=Math.floor(T.index/this.nvertex);if(b<0||b>=this.bins.length)return null;const B=this.painter,P=B.getFramePainter(),_=B.get3DToolTip(this.bins[b]);return _.x1=P.grx(B.getAxis("x").GetBinLowEdge(_.ix)),_.x2=P.grx(B.getAxis("x").GetBinLowEdge(_.ix+m)),_.y1=P.gry(B.getAxis("y").GetBinLowEdge(_.iy)),_.y2=P.gry(B.getAxis("y").GetBinLowEdge(_.iy+h)),_.z1=P.grz(B.getAxis("z").GetBinLowEdge(_.iz)),_.z2=P.grz(B.getAxis("z").GetBinLowEdge(_.iz+D)),_.color=this.tip_color,_.opacity=.3,_},!0))})()}draw3DBins(t){const e=this.getFramePainter();let h,l,i=this.v7EvalColor("fill_color","red"),n=0,x=!1,a=!1,m=!1,f=1,g=!0,d=.5;if(this.options.Sphere){d=.4,x=!0,11===this.options.Sphere&&(m=!0);const o=e.webgl?new K.Gu$(.5,16,12):new K.Gu$(.5,8,6);o.applyMatrix4((new K.kn4).makeRotationX(Math.PI/2)),o.computeVertexNormals();const r=o.getIndex().array,F=o.getAttribute("position").array,C=o.getAttribute("normal").array;n=3*r.length,h=new Float32Array(n),l=new Float32Array(n);for(let s=0;s<r.length;++s){const M=3*r[s];h[3*s]=F[M],h[3*s+1]=F[M+1],h[3*s+2]=F[M+2],l[3*s]=C[M],l[3*s+1]=C[M+1],l[3*s+2]=C[M+2]}}else{const o=L.DJ.Indexes,r=L.DJ.Normals,F=L.DJ.Vertices;n=3*o.length,h=new Float32Array(n),l=new Float32Array(n);for(let C=0,s=-3;C<o.length;++C){const M=F[o[C]];h[3*C]=M.x-.5,h[3*C+1]=M.y-.5,h[3*C+2]=M.z-.5,C%6==0&&(s+=3),l[3*C]=r[s],l[3*C+1]=r[s+1],l[3*C+2]=r[s+2]}a=!0,11===this.options.Box?m=!0:12===this.options.Box?(m=!0,a=!1):this.options.Color&&(m=!0,f=.5,g=!1,a=!1,x=!0)}g&&(g=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);const D=this.getHisto(),A=t.i1,w=t.i2,u=t.stepi,c=t.j1,p=t.j2,y=t.stepj,z=t.k1,E=t.k2,j=t.stepk;let G=null;if(m&&(G=e.getHistPalette(),this.createContour(e,G)),w<=A||p<=c||E<=z)return!0;let I=this.getAxis("x"),Z=this.getAxis("y"),W=this.getAxis("z");const $=(e.grx(I.GetBinCoord(w))-e.grx(I.GetBinCoord(A)))/(w-A)*u,S=(e.gry(Z.GetBinCoord(p))-e.gry(Z.GetBinCoord(c)))/(p-c)*y,H=(e.grz(W.GetBinCoord(E))-e.grz(W.GetBinCoord(z)))/(E-z)*j,T=[];let B,P,_,J,U,b=0,N=0,Q=[];for(B=A;B<w;B+=u)for(P=c;P<p;P+=y)for(_=z;_<E;_+=j){if(U=D.getBinContent(B+1,P+1,_+1),!this.options.Color&&(0===U||U<this.gminbin)||(J=g?Math.pow(Math.abs(U*g),.3333):1,J<.001)||(b++,!m))continue;const o=G.getContourIndex(U);o>=0?(void 0===T[o]&&(T[o]=0,Q[o]=N++),T[o]+=1):console.error(`not found color for value = ${U}`)}m||(T.push(b),N=1,Q=[0]);const it=new Array(N),tt=new Array(N),nt=new Array(N),st=new Array(N),V=new Array(N),rt=new Array(N),ot=new Array(N);for(let o=0;o<T.length;++o){if(!T[o])continue;b=T[o];const r=Q[o];it[r]=0,V[r]=0,a&&(V[r]=b*n/3>65520?2:1),tt[r]=new Float32Array(b*n),nt[r]=new Float32Array(b*n),st[r]=new Int32Array(b),1===V[r]&&(rt[r]=new Uint16Array(b*L.DJ.MeshSegments.length)),2===V[r]&&(ot[r]=new Float32Array(b*L.DJ.Segments.length*3))}let dt,at,mt,lt,ut,ht;for(I=this.getAxis("x"),Z=this.getAxis("y"),W=this.getAxis("z"),B=A;B<w;B+=u)for(dt=I.GetBinCenter(B+1),at=e.grx(dt),P=c;P<p;P+=y)for(mt=Z.GetBinCenter(P+1),lt=e.gry(mt),_=z;_<E;_+=j){if(U=D.getBinContent(B+1,P+1,_+1),!this.options.Color&&(0===U||U<this.gminbin)||(J=g?Math.pow(Math.abs(U*g),.3333):1,J<.001))continue;let o=0;if(m){const s=G.getContourIndex(U);if(s<0)continue;o=Q[s]}b=it[o],ut=W.GetBinCenter(_+1),ht=e.grz(ut),st[o][b]=D.getBin(B+1,P+1,_+1);let r=b*n;const F=tt[o],C=nt[o];for(let s=0;s<n;s+=3,r+=3)F[r]=at+h[s]*$*J,F[r+1]=lt+h[s+1]*S*J,F[r+2]=ht+h[s+2]*H*J,C[r]=l[s],C[r+1]=l[s+1],C[r+2]=l[s+2];if(1===V[o]){const s=L.DJ.MeshSegments;r=b*s.length;const M=Math.round(b*n/3),O=rt[o];for(let v=0;v<s.length;++v)O[r+v]=M+s[v]}if(2===V[o]){const s=L.DJ.Segments,M=ot[o];r=b*s.length*3;for(let O=0;O<s.length;++O,r+=3){const v=L.DJ.Vertices[s[O]];M[r]=at+(v.x-.5)*$*J,M[r+1]=lt+(v.y-.5)*S*J,M[r+2]=ht+(v.z-.5)*H*J}}it[o]=b+1}for(let o=0;o<T.length;++o){if(!T[o])continue;const r=Q[o],F=new K.LoY;F.setAttribute("position",new K.THS(tt[r],3)),F.setAttribute("normal",new K.THS(nt[r],3)),m&&(i=G.getColor(o));const C=x?new K.G_z({color:i,opacity:f,transparent:f<1,vertexColors:!1}):new K.V9B({color:i,opacity:f,transparent:f<1,vertexColors:!1}),s=new K.eaF(F,C);if(s.bins=st[r],s.bins_faces=n/9,s.painter=this,s.scalex=d*$,s.scaley=d*S,s.scalez=d*H,s.tip_color=65280,s.use_scale=g,s.tooltip=function(M){const O=Math.floor(M.faceIndex/this.bins_faces);if(O<0||O>=this.bins.length)return null;const v=this.painter,gt=v.getFramePainter(),R=v.get3DToolTip(this.bins[O]),_t=gt.grx(v.getAxis("x").GetBinCoord(R.ix-.5)),pt=gt.gry(v.getAxis("y").GetBinCoord(R.iy-.5)),yt=gt.grz(v.getAxis("z").GetBinCoord(R.iz-.5)),Y=this.use_scale?Math.pow(Math.abs(R.value*this.use_scale),.3333):1;return R.x1=_t-this.scalex*Y,R.x2=_t+this.scalex*Y,R.y1=pt-this.scaley*Y,R.y2=pt+this.scaley*Y,R.z1=yt-this.scalez*Y,R.z2=yt+this.scalez*Y,R.color=this.tip_color,R},e.toplevel.add(s),V[r]>0){const M=this.v7EvalColor("line_color","lightblue"),O=new K.mrM({color:M}),v=1===V[r]?(0,L.Fc)(tt[r],O,rt[r]):(0,L.Fc)(ot[r],O);e.toplevel.add(v)}}m&&this.updatePaletteDraw()}draw3D(){if(!this.draw_content)return!1;const t=this.prepareDraw({only_indexes:!0,extra:-.5,right_extra:-1});return(this.options.Scatter?this.draw3DScatter(t):Promise.resolve(!1)).then(i=>i||this.draw3DBins(t))}redraw(t){const e=this.getFramePainter();return"resize"===t?(e.resize3D()&&e.render3D(),this):((0,Ct.wx)(e),e.create3DScene(this.options.Render3D).then(()=>(e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,zt.R,{zoom:X.settings.Zooming,ndim:3,draw:!0,v7:!0}),this.drawingBins(t))).then(()=>this.draw3D()).then(()=>(e.render3D(),e.addKeysHandler(),this)))}fillToolbar(){const t=this.getPadPainter();t&&(t.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&t.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t.showPadButtons())}canZoomInside(t,e,i){let n=this.getHisto();return n&&(n=n["f"+t.toUpperCase()+"axis"]),!n||n.FindBin(i,.5)-n.FindBin(e,0)>1}autoZoom(){const t=this.getSelectIndex("x","left"),e=this.getSelectIndex("x","right"),i=this.getSelectIndex("y","left"),n=this.getSelectIndex("y","right"),x=this.getSelectIndex("z","left"),a=this.getSelectIndex("z","right"),m=this.getHisto();let f,g,h;if(t===e||i===n||x===a)return;let l=m.getBinContent(t+1,i+1,x+1);for(f=t;f<e;++f)for(g=i;g<n;++g)for(h=x;h<a;++h)l=Math.min(l,m.getBinContent(f+1,g+1,h+1));if(l>0)return;let d=e,D=t,A=n,w=i,u=a,c=x;for(f=t;f<e;++f)for(g=i;g<n;++g)for(h=x;h<a;++h)m.getBinContent(f+1,g+1,h+1)>l&&(f<d&&(d=f),f>=D&&(D=f+1),g<A&&(A=g),g>=w&&(w=g+1),h<u&&(u=h),h>=c&&(c=h+1));let p,y,z,E,j,G,I=!1;return d===D-1&&d>t+1&&D<e-1&&(d--,D++),A===w-1&&A>i+1&&w<n-1&&(A--,w++),u===c-1&&u>x+1&&c<a-1&&(u--,c++),(d>t||D<e)&&d<D-1&&(p=this.getAxis("x").GetBinLowEdge(d+1),y=this.getAxis("x").GetBinLowEdge(D+1),I=!0),(A>i||w<n)&&A<w-1&&(z=this.getAxis("y").GetBinLowEdge(A+1),E=this.getAxis("y").GetBinLowEdge(w+1),I=!0),(u>x||c<a)&&u<c-1&&(j=this.getAxis("z").GetBinLowEdge(u+1),G=this.getAxis("z").GetBinLowEdge(c+1),I=!0),I?this.getFramePainter().zoom(p,y,z,E,j,G):void 0}fillHistContextMenu(t){const e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,i=>{if(0===i.indexOf(X.kInspect))return this.showInspector(i);this.decodeOptions(i),this.interactiveRedraw(!0,"drawopt")})}static draw(t,e){return(0,ft.A)(function*(){const i=new q(t,e);return i.mode3d=!0,(0,bt.ensureRCanvas)(i,"3d").then(()=>{i.setAsMainPainter(),i.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:X.kNoZoom,maximum:X.kNoZoom,FrontBox:!1,BackBox:!1};const n=i.v7EvalAttr("kind",""),x=i.v7EvalAttr("sub",0),a=i.options;switch(n){case"box":a.Box=10+x;break;case"sphere":a.Sphere=10+x;break;case"col":a.Color=!0;break;case"scat":a.Scatter=!0;break;default:a.Box=10}return i.scanContent(),i.redraw()})})()}}function Mt(et,t,e){return t?1===t.fAxes.length?At.RH1Painter.draw(et,t,e):2===t.fAxes.length?wt.RH2Painter.draw(et,t,e):3===t.fAxes.length?q.draw(et,t,e):null:null}}}]);